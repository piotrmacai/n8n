{
  "name": "360MarketingReports",
  "nodes": [
    {
      "parameters": {},
      "id": "2449b1be-0ba8-41ae-9ea5-86028da736f0",
      "name": "Calculator",
      "type": "@n8n/n8n-nodes-langchain.toolCalculator",
      "position": [
        2016,
        1168
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "content": "## Sub-Workflow: Google Analytics Data",
        "height": 460,
        "width": 2900,
        "color": 6
      },
      "id": "e8b884f1-2013-4c25-a641-8181528db173",
      "name": "Sticky Note",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        832,
        880
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "content": "## Sub-Workflow: Meta Ads Data",
        "height": 1004,
        "width": 3172,
        "color": 5
      },
      "id": "f7d290eb-07d1-413d-ba12-184229e519c0",
      "name": "Sticky Note2",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        7392,
        3040
      ],
      "typeVersion": 1,
      "disabled": true
    },
    {
      "parameters": {
        "content": "## Main Workflow: Weekly Report Assistant",
        "height": 540,
        "width": 1252,
        "color": 7
      },
      "id": "c78da3ec-fb47-4373-8850-e1af89d7330e",
      "name": "Sticky Note3",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        1328,
        304
      ],
      "typeVersion": 1
    },
    {
      "parameters": {},
      "id": "79ae6b22-0067-4d51-bc64-e0360d2096f3",
      "name": "Calculator1",
      "type": "@n8n/n8n-nodes-langchain.toolCalculator",
      "position": [
        3024,
        1728
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "content": "## Sub-Workflow: Google Ads Data",
        "height": 500,
        "width": 2900,
        "color": 6
      },
      "id": "d7608c67-4b10-4860-b683-de265b95cb03",
      "name": "Sticky Note4",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        832,
        1408
      ],
      "typeVersion": 1
    },
    {
      "parameters": {},
      "id": "c047cc54-1598-4294-a398-cdb23ea8be4d",
      "name": "Calculator3",
      "type": "@n8n/n8n-nodes-langchain.toolCalculator",
      "position": [
        -288,
        4688
      ],
      "typeVersion": 1,
      "disabled": true
    },
    {
      "parameters": {
        "propertyId": {
          "__rl": true,
          "value": "496500444",
          "mode": "id"
        },
        "metricsGA4": {
          "metricValues": [
            {
              "listName": "screenPageViews"
            },
            {},
            {
              "listName": "sessions"
            },
            {
              "listName": "sessionsPerUser"
            },
            {
              "listName": "eventCount"
            },
            {
              "listName": "active7DayUsers"
            }
          ]
        },
        "dimensionsGA4": {
          "dimensionValues": [
            {}
          ]
        },
        "additionalFields": {}
      },
      "id": "165717a8-b215-4e0e-a5e9-586feaec261e",
      "name": "Call Google Analytics data: Last 7 days",
      "type": "n8n-nodes-base.googleAnalytics",
      "position": [
        976,
        1008
      ],
      "typeVersion": 2,
      "credentials": {
        "googleAnalyticsOAuth2": {
          "id": "nDVnksBtyvj6OfR3",
          "name": "GA_macaipiotr@gmail.com"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const inputData = items[0].json.results;\nconst totals = {\n    impressions: 0,\n    clicks: 0,\n    conversions: 0,\n    costMicros: 0,\n    conversionsValue: 0\n};\n\ninputData.forEach(campaign => {\n    totals.impressions += parseInt(campaign.metrics.impressions) || 0;\n    totals.clicks += parseInt(campaign.metrics.clicks) || 0; \n    totals.conversions += parseFloat(campaign.metrics.conversions) || 0;\n    totals.costMicros += parseInt(campaign.metrics.costMicros) || 0;\n    totals.conversionsValue += parseFloat(campaign.metrics.conversionsValue) || 0;\n});\n\nconst results = {\n    impressions: totals.impressions,\n    clicks: totals.clicks,\n    conversions: totals.conversions, \n    cost_micros: totals.costMicros,\n    ctr: totals.clicks / totals.impressions,\n    cost_per_conversion: totals.costMicros / totals.conversions,\n    cpm: (totals.costMicros / (totals.impressions / 1000)),\n    roas: totals.conversionsValue / (totals.costMicros / 1000000)\n};\n\nreturn results;"
      },
      "id": "5b9dbc30-4a92-43d2-b9bf-477141aa4024",
      "name": "Format data input (current year)",
      "type": "n8n-nodes-base.code",
      "position": [
        1504,
        1712
      ],
      "typeVersion": 2
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "9c2f8b9a-e964-49a0-8837-efb0dfd7bcae",
              "name": "Impressions",
              "type": "number",
              "value": "={{ $json.impressions }}"
            },
            {
              "id": "8b524518-1268-4971-b5c9-ae7da09d94f9",
              "name": "CPM",
              "type": "number",
              "value": "={{ $json.cpm }}"
            },
            {
              "id": "ca7279b9-c643-425f-aa99-cb17146e9994",
              "name": "Clicks",
              "type": "number",
              "value": "={{ $json.clicks }}"
            },
            {
              "id": "591288f7-e8cf-445e-872a-5b83f997b825",
              "name": "CTR",
              "type": "number",
              "value": "={{ $json.ctr }}"
            },
            {
              "id": "dc1a43da-3f3a-4dca-bbde-904222d7f693",
              "name": "Conversions",
              "type": "number",
              "value": "={{ $json.conversions }}"
            },
            {
              "id": "eac0b53e-c452-40b8-92bc-8af8ea349984",
              "name": "=Cost per Conversion",
              "type": "number",
              "value": "={{ $json.cost_per_conversion }}"
            },
            {
              "id": "4b5d569a-26c9-4a2f-be48-6814860d33c1",
              "name": "ROAS",
              "type": "number",
              "value": "={{ $json.roas }}"
            },
            {
              "id": "b96439be-189d-4ebe-b49e-d5c31fefe9f0",
              "name": "Spend",
              "type": "number",
              "value": "={{ $json.cost_micros }}"
            }
          ]
        },
        "options": {}
      },
      "id": "fdb70b1a-8891-469f-9920-3623cb40760e",
      "name": "Assign data from input (current year)",
      "type": "n8n-nodes-base.set",
      "position": [
        1760,
        1712
      ],
      "typeVersion": 3.4
    },
    {
      "parameters": {
        "fieldsToSummarize": {
          "values": [
            {
              "aggregation": "sum",
              "field": "Impressions"
            },
            {
              "aggregation": "average",
              "field": "CPM"
            },
            {
              "aggregation": "sum",
              "field": "Clicks"
            },
            {
              "aggregation": "average",
              "field": "CTR"
            },
            {
              "aggregation": "sum",
              "field": "Conversions"
            },
            {
              "aggregation": "average",
              "field": "Cost per Conversion"
            },
            {
              "aggregation": "sum",
              "field": "Spend"
            },
            {
              "aggregation": "average",
              "field": "ROAS"
            }
          ]
        },
        "options": {}
      },
      "id": "bef77ef4-b6ef-48c3-b0b7-5a12a3f75b05",
      "name": "Summarize input (current year)",
      "type": "n8n-nodes-base.summarize",
      "position": [
        2000,
        1712
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "jsCode": "// Aktuelles Datum\nconst today = new Date();\n\n// Berechnung des Enddatums (letzter Tag vor dem aktuellen Datum)\nconst end = new Date(today);\nend.setDate(today.getDate() - 1);\n\n// Berechnung des Startdatums (7 Tage vor dem Enddatum)\nconst start = new Date(end);\nstart.setDate(end.getDate() - 6);\n\n// Formatierung zu YYYYMMDD\nfunction formatDate(date) {\n    const year = date.getFullYear();\n    const month = String(date.getMonth() + 1).padStart(2, '0');\n    const day = String(date.getDate()).padStart(2, '0');\n    return `${year}${month}${day}`;\n}\n\n// Ausgabe\nconst startDate = formatDate(start);\nconst endDate = formatDate(end);\n\nreturn { startDate, endDate };"
      },
      "id": "000507e0-7806-4686-b157-56e9d58bd9db",
      "name": "Calculate date format for Google Ads request (last 7 days)",
      "type": "n8n-nodes-base.code",
      "position": [
        992,
        1712
      ],
      "typeVersion": 2
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://googleads.googleapis.com/v17/customers/3300525230/googleAds:search",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "googleAdsOAuth2Api",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "developer-token",
              "value": "fzQ2U5IcU4ZH0vBDn4Slww"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "query",
              "value": "=SELECT\n   campaign.name,\n   metrics.impressions,\n   metrics.average_cpm,\n   metrics.clicks, \n   metrics.ctr,\n   metrics.conversions,\n   metrics.cost_per_conversion,\n   metrics.cost_micros,\n   metrics.conversions_value\nFROM campaign\nWHERE segments.date >= '{{ $json.startDate }}' AND segments.date <= '{{ $json.endDate }}'"
            }
          ]
        },
        "options": {}
      },
      "id": "a1b4d36a-c322-4771-bcf3-226870fcf000",
      "name": "Call Google Ads Data: Last 7 days",
      "type": "n8n-nodes-base.httpRequest",
      "position": [
        1264,
        1712
      ],
      "typeVersion": 4.2,
      "credentials": {
        "googleAdsOAuth2Api": {
          "id": "sbvx00Y9bJ3MrIbd",
          "name": "Google Ads account"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "graphApiVersion": "v20.0",
        "node": "act_54337533",
        "edge": "insights",
        "options": {
          "queryParametersJson": "={\n \"fields\": \"impressions,cpm,inline_link_clicks,inline_link_click_ctr,conversions,cost_per_conversion,spend,action_values,purchase_roas\",\n \"time_range\": {\n   \"since\": \"{{ $json.currentPeriod.since }}\",\n   \"until\": \"{{ $json.currentPeriod.until }}\"\n }\n}"
        }
      },
      "id": "13074a3d-6cf4-4ad7-9e26-002f8120e640",
      "name": "Call Meta Ads Data: Last 7 days",
      "type": "n8n-nodes-base.facebookGraphApi",
      "position": [
        -1168,
        4400
      ],
      "typeVersion": 1,
      "credentials": {
        "facebookGraphApi": {
          "id": "qyqXK2BX1VsAfqgn",
          "name": "Facebook Graph account"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "fieldsToSummarize": {
          "values": [
            {
              "aggregation": "sum",
              "field": "Impressions"
            },
            {
              "aggregation": "average",
              "field": "CPM"
            },
            {
              "aggregation": "sum",
              "field": "Clicks"
            },
            {
              "aggregation": "average",
              "field": "CTR"
            },
            {
              "aggregation": "sum",
              "field": "Conversions"
            },
            {
              "aggregation": "average",
              "field": "Cost per conversion"
            },
            {
              "aggregation": "sum",
              "field": "Spend"
            },
            {
              "aggregation": "average",
              "field": "ROAS"
            }
          ]
        },
        "options": {}
      },
      "id": "a13919d1-5680-44ea-826b-44afc0034702",
      "name": "Summarize Meta input (current year)",
      "type": "n8n-nodes-base.summarize",
      "position": [
        -752,
        4400
      ],
      "typeVersion": 1,
      "disabled": true
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "9c2f8b9a-e964-49a0-8837-efb0dfd7bcae",
              "name": "Impressions",
              "type": "number",
              "value": "={{ $json.data[0].impressions }}"
            },
            {
              "id": "8b524518-1268-4971-b5c9-ae7da09d94f9",
              "name": "CPM",
              "type": "number",
              "value": "={{ $json.data[0].cpm }}"
            },
            {
              "id": "ca7279b9-c643-425f-aa99-cb17146e9994",
              "name": "Clicks",
              "type": "number",
              "value": "={{ $json.data[0].inline_link_clicks }}"
            },
            {
              "id": "591288f7-e8cf-445e-872a-5b83f997b825",
              "name": "CTR",
              "type": "number",
              "value": "={{ $json.data[0].inline_link_click_ctr }}"
            },
            {
              "id": "dc1a43da-3f3a-4dca-bbde-904222d7f693",
              "name": "Conversions",
              "type": "number",
              "value": "={{ $json.data[0].conversions[0].value }}"
            },
            {
              "id": "eac0b53e-c452-40b8-92bc-8af8ea349984",
              "name": "=Cost per conversion",
              "type": "number",
              "value": "={{ $json.data[0].cost_per_conversion[0].value }}"
            },
            {
              "id": "c6cac2d8-b8f8-4b2a-9bcc-1c325db78799",
              "name": "ROAS",
              "type": "number",
              "value": "={{ $json.data[0].purchase_roas[0].value }}"
            },
            {
              "id": "b96439be-189d-4ebe-b49e-d5c31fefe9f0",
              "name": "Spend",
              "type": "number",
              "value": "={{ $json.data[0].spend }}"
            }
          ]
        },
        "options": {}
      },
      "id": "1afce576-0d2a-41bb-a94b-5d6eaae1fe3e",
      "name": "Assign Meta data from input (current year)",
      "type": "n8n-nodes-base.set",
      "position": [
        -960,
        4400
      ],
      "typeVersion": 3.4,
      "disabled": true
    },
    {
      "parameters": {
        "modelId": {
          "__rl": true,
          "mode": "list",
          "value": "gpt-4o",
          "cachedResultName": "GPT-4O"
        },
        "messages": {
          "values": [
            {
              "content": "=Please analyze the following data and output the results in table form:\n\n| Metric | Last 7 Days | Previous Year | Percentage Change |\n|--------|-------------|---------------|-------------------|\n| Total Impressions | {{$json.current_impressions}} | {{$json.previous_impressions}} | Percentage Change |\n| CPM | {{$json.current_cpm}} | {{$json.previous_cpm}} | Percentage Change |\n| Total Clicks | {{$json.current_clicks}} | {{$json.previous_clicks}} | Percentage Change |\n| CTR | {{$json.current_ctr}} | {{$json.previous_ctr}} | Percentage Change |\n| Conversions | {{$json.current_conversions}} | {{$json.previous_conversions}} | Percentage Change |\n| Cost per Conversion | {{$json.current_cost_per_conversion}} | {{$json.previous_cost_per_conversion}} | Percentage Change |\n| ROAS | {{ $json.current_roas }} | {{ $json.previous_roas }} | Percentage Change |\n| Costs | {{$json.current_cost}} | {{$json.previous_cost}} | Percentage Change |\n\nNumber format:\n- Period (.) for thousands (e.g. 4.000)\n- Comma (,) for decimal numbers (e.g. 3,4)\n- Display CPM, Cost per Conversion, ROAS and Costs in €\n- CTR in percent\n\nPlease write a brief summary of the analyzed data above the table (in max 3 sentences!)\n\nIMPORTANT:\nWrite nothing except the summary and the table below it!\nNO INTRODUCTION, NO CONCLUSION!"
            }
          ]
        },
        "options": {}
      },
      "id": "146d6907-66af-41ff-ab32-b2a3ec5787b6",
      "name": "Processing for Google Ads report",
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "position": [
        3184,
        1760
      ],
      "typeVersion": 1.7,
      "credentials": {
        "openAiApi": {
          "id": "8zt0lkXSJzfIV1lh",
          "name": "OpenAi account"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "jsCode": "const currentData = $('Summarize input (current year)').first().json;\nconst previousData = $('Summarize input (previous year)').first().json;\n\nfunction formatNumber(number, decimals = 0) {\n   if (number === 0) return \"0\";\n   return number.toLocaleString('de-DE', {\n       minimumFractionDigits: decimals,\n       maximumFractionDigits: decimals\n   });\n}\n\nfunction calculateCPM(costMicros, impressions) {\n   if (impressions === 0) return 0;\n   return (costMicros / 1000000 / impressions) * 1000;\n}\n\nreturn [{\n   current_impressions: formatNumber(currentData.sum_Impressions),\n   current_cpm: formatNumber(calculateCPM(currentData.sum_Spend, currentData.sum_Impressions), 2),\n   current_clicks: formatNumber(currentData.sum_Clicks),\n   current_ctr: formatNumber(currentData.average_CTR * 100, 2),\n   current_conversions: formatNumber(currentData.sum_Conversions, 2),\n   current_cost_per_conversion: formatNumber(currentData.average_Cost_per_Conversion / 1000000, 2),\n   current_cost: formatNumber(currentData.sum_Spend / 1000000, 2),\n   current_roas: formatNumber(currentData.average_ROAS, 2),\n   \n   previous_impressions: formatNumber(previousData.sum_Impressions),\n   previous_cpm: formatNumber(calculateCPM(previousData.sum_Spend, previousData.sum_Impressions), 2),\n   previous_clicks: formatNumber(previousData.sum_Clicks),\n   previous_ctr: formatNumber(previousData.average_CTR * 100, 2),\n   previous_conversions: formatNumber(previousData.sum_Conversions, 2),\n   previous_cost_per_conversion: formatNumber(previousData.average_Cost_per_conversion / 1000000, 2),\n   previous_cost: formatNumber(previousData.sum_Spend / 1000000, 2),\n   previous_roas: formatNumber(previousData.average_ROAS, 2)\n}];"
      },
      "id": "2fd2a795-caa4-4194-8049-4955c1d54dd9",
      "name": "Format all Google data for LLM",
      "type": "n8n-nodes-base.code",
      "position": [
        2224,
        1712
      ],
      "typeVersion": 2
    },
    {
      "parameters": {
        "jsCode": "// Aktuelles Datum\nconst now = new Date();\n\n// Gestern als Ende-Datum\nconst yesterday = new Date(now);\nyesterday.setDate(now.getDate() - 1);\n\n// Start-Datum (7 Tage vor gestern)\nconst weekStart = new Date(yesterday);\nweekStart.setDate(yesterday.getDate() - 6);\n\n// Vorjahreszeitraum\nconst lastYearStart = new Date(weekStart);\nlastYearStart.setFullYear(weekStart.getFullYear() - 1);\n\nconst lastYearEnd = new Date(yesterday);\nlastYearEnd.setFullYear(yesterday.getFullYear() - 1);\n\n// Formatierung YYYY-MM-DD\nfunction formatDate(date) {\n    return date.toISOString().split('T')[0];\n}\n\n// Ausgabe\nitems[0] = {\n  json: {\n    currentPeriod: {\n      since: formatDate(weekStart),\n      until: formatDate(yesterday)\n    },\n    lastYear: {\n      since: formatDate(lastYearStart),\n      until: formatDate(lastYearEnd)\n    }\n  }\n};\n\nreturn items;"
      },
      "id": "9355325f-35c2-4663-922e-d7ccec873fea",
      "name": "Calculate date format for meta ads request s",
      "type": "n8n-nodes-base.code",
      "position": [
        -1424,
        4400
      ],
      "typeVersion": 2,
      "disabled": true
    },
    {
      "parameters": {
        "modelId": {
          "__rl": true,
          "mode": "list",
          "value": "gpt-4o",
          "cachedResultName": "GPT-4O"
        },
        "messages": {
          "values": [
            {
              "content": "=Please analyze the following data and output the results in table form:\n\n| Metric | Last 7 Days | Previous Year | Percentage Change |\n|--------|-------------|---------------|-------------------|\n| Total Impressions | {{$json.current_impressions}} | {{$json.previous_impressions}} | Percentage Change |\n| CPM | {{$json.current_cpm}} | {{$json.previous_cpm}} | Percentage Change |\n| Total Clicks | {{$json.current_clicks}} | {{$json.previous_clicks}} | Percentage Change |\n| CTR | {{$json.current_ctr}} | {{$json.previous_ctr}} | Percentage Change |\n| Conversions | {{$json.current_conversions}} | {{$json.previous_conversions}} | Percentage Change |\n| Cost per Conversion | {{$json.current_cost_per_conversion}} | {{$json.previous_cost_per_conversion}} | Percentage Change |\n| ROAS | {{ $json.current_roas }} | {{ $json.previous_roas }} | Percentage Change |\n| Costs | {{$json.current_cost}} | {{$json.previous_cost}} | Percentage Change |\n\nNumber format:\n- Period (.) for thousands (e.g. 4.000)\n- Comma (,) for decimal numbers (e.g. 3,4)\n- Display CPM, Cost per Conversion, ROAS and Costs in €\n- CTR in percent\n\nPlease write a brief summary of the analyzed data above the table (in max 3 sentences!)\n\nIMPORTANT:\nWrite nothing except the summary and the table below it!\nNO INTRODUCTION, NO CONCLUSION!"
            }
          ]
        },
        "options": {}
      },
      "id": "928d15f2-141c-4e88-abcc-60799793bde7",
      "name": "Processing for Meta Ads Report",
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "position": [
        2320,
        4112
      ],
      "typeVersion": 1.7,
      "credentials": {
        "openAiApi": {
          "id": "8zt0lkXSJzfIV1lh",
          "name": "OpenAi account"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "modelId": {
          "__rl": true,
          "mode": "list",
          "value": "gpt-4o",
          "cachedResultName": "GPT-4O"
        },
        "messages": {
          "values": [
            {
              "content": "=Please analyze the following data and output the results in table form:\n| Metric                        | Last 7 Days | Previous Year | Percentage Change |\n|-------------------------------|-------------|---------------|-------------------|\n| Total Page Views              | {{ $('Summarize Google Analytics input (current year)').item.json.sum_Page_views }} | {{ $json.sum_Page_views }} | Percentage Change |\n| Total Users                   | {{ $('Summarize Google Analytics input (current year)').item.json.sum_Users }} | {{ $json.sum_Users }} | Percentage Change |\n| Total Sessions                | {{ $('Summarize Google Analytics input (current year)').item.json.sum_Sessions }} | {{ $json.sum_Sessions }} | Percentage Change |\n| Average Sessions per User     | {{ $('Summarize Google Analytics input (current year)').item.json.average_Sessions_per_user }} | {{ $json.average_Sessions_per_user }} | Percentage Change |\n| Average Session Duration      | {{ $('Summarize Google Analytics input (current year)').item.json.average_Session_duration }} | {{ $json.average_Session_duration }} | Percentage Change |\n| Total Purchases               | {{ $('Summarize Google Analytics input (current year)').item.json.sum_Conversions }} | {{ $json.sum_Conversions }} | Percentage Change |\n| Average Revenue per Purchase  | {{ $('Summarize Google Analytics input (current year)').item.json.average_Value_per_Conversion }} | {{ $json.average_Value_per_conversion }} | Percentage Change |\n| Total Revenue                 | {{ $('Summarize Google Analytics input (current year)').item.json.sum_Revenue }} | {{ $('Summarize Google Analytics input (previous year)').item.json.sum_Revenue }} | Percentage Change |\n\nNumber format:\n- Period (.) for thousands (e.g. 4.000)\n- Comma (,) for decimal numbers (e.g. 3,4)\n- Convert Average Session Duration to minutes instead of seconds\n- Average Revenue per Purchase and Total Revenue in €\n\nPlease write a brief summary of the analyzed data above the table (in max 3 sentences!)\n\nIMPORTANT:\nWrite nothing except the summary and the table below it!\nNO INTRODUCTION, NO CONCLUSION!"
            }
          ]
        },
        "options": {}
      },
      "id": "ce9175bd-b355-47eb-8dd8-dd26292e0061",
      "name": "Processing for Google Analytics Report",
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "position": [
        2864,
        1200
      ],
      "typeVersion": 1.7,
      "credentials": {
        "openAiApi": {
          "id": "8zt0lkXSJzfIV1lh",
          "name": "OpenAi account"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Analyze and answer, using all our connected tools, knowledge and data to that query: {{ $json.chatInput }}  ",
        "options": {
          "systemMessage": "# ROLE\nYou are an elite Marketing Data Analyst and Strategic Advisor with world-class expertise in digital marketing analytics, campaign performance optimization, and data-driven decision making.\n\n## TASK\n1. **Answer ad-hoc questions** about campaign performance using live data from sheets\n2. **Generate weekly summaries** when requested or scheduled\n3. **Investigate performance issues** by analyzing trends and correlations\n4. **Provide optimization recommendations** based on data insights\n5. **Retrieve historical reports** from Google Drive when needed\n6. **Compare channel performance** to guide budget allocation decisions\n\n## YOUR CONNECTED TOOLS (CRITICAL - YOU MUST USE THESE)\n\nYou have access to the following tools in your workflow. **You MUST actively use these tools to retrieve data before answering any question:**\n\n#### 1. **SearchGoogleDrive** (search: fileFolder)\n**When to use:** Any time the user asks about reports, documents, or historical data\n**How to use:** Search for files in Google Drive by keywords, dates, or file names\n**Examples:**\n- \"Find the weekly report from December 15\"\n- \"Search for campaign performance reports\"\n- \"Locate Q4 marketing summary\"\n\n**Usage pattern:**\n```\nWhen user asks: \"Show me last week's report\"\nYou do: SearchGoogleDrive(query: \"weekly report December\")\nThen: Read the file and analyze the content\n```\n\n#### 2. **GoogleAdsData** (read: sheet)\n**When to use:** Questions about Google Ads campaign performance, spend, conversions\n**How to use:** Read the GoogleAdsData sheet to get current Google Ads metrics\n**Contains:** Campaign names, spend, clicks, conversions, CPC, CTR, ROAS from Google Ads\n\n**Usage pattern:**\n```\nWhen user asks: \"How are Google Ads performing?\"\nYou do: Read GoogleAdsData sheet\nThen: Analyze campaigns, calculate totals, identify trends\n```\n\n#### 3. **MetaAdsData** (read: sheet)\n**When to use:** Questions about Facebook/Instagram campaign performance\n**How to use:** Read the MetaAdsData sheet to get current Meta Ads metrics\n**Contains:** Campaign names, spend, impressions, clicks, conversions, CPC, CTR, ROAS from Facebook/Instagram\n\n**Usage pattern:**\n```\nWhen user asks: \"What's our Meta ROAS?\"\nYou do: Read MetaAdsData sheet\nThen: Calculate ROAS, compare campaigns, provide insights\n```\n\n#### 4. **GoogleAnalyticData** (read: sheet)\n**When to use:** Questions about website traffic, user behavior, conversion paths\n**How to use:** Read the GoogleAnalyticData sheet to get website analytics\n**Contains:** Sessions, users, pageviews, bounce rate, conversion rate, traffic sources, landing pages\n\n**Usage pattern:**\n```\nWhen user asks: \"How's our website traffic?\"\nYou do: Read GoogleAnalyticData sheet\nThen: Analyze traffic trends, top sources, conversion funnel\n```\n\n---\n\n## DATA RETRIEVAL PROTOCOL (MANDATORY)\n\n**BEFORE answering ANY question, you MUST follow this workflow:**\n\n### STEP 1: Identify Required Data Source(s)\nDetermine which tool(s) contain the data needed:\n- Historical reports or documents → **SearchGoogleDrive**\n- Google Ads performance → **GoogleAdsData** sheet\n- Facebook/Instagram performance → **MetaAdsData** sheet\n- Website analytics → **GoogleAnalyticData** sheet\n- Cross-channel comparison → Multiple sheets\n\n### STEP 2: Retrieve the Data\n**Execute the appropriate tool(s):**\n- If user mentions \"report\", \"document\", or specific dates → SearchGoogleDrive first\n- If user asks about current campaigns → Read relevant sheet(s)\n- If user wants comparison → Read all relevant sheets\n\n**CRITICAL RULES:**\n- ✅ ALWAYS use tools to get fresh data\n- ✅ Read the ENTIRE sheet to understand structure\n- ✅ Confirm you have the data before analyzing\n- ❌ NEVER make up data\n- ❌ NEVER answer without retrieving data first\n- ❌ NEVER assume what's in the sheets\n\n### STEP 3: Analyze the Data\nOnce you have the data:\n1. Calculate key metrics (CTR, CPC, CPA, ROAS, etc.)\n2. Identify trends (increasing, decreasing, stable)\n3. Compare across campaigns, channels, or time periods\n4. Spot anomalies or notable patterns\n5. Correlate metrics (e.g., high spend + low ROAS = problem)\n\n### STEP 4: Deliver Insights Conversationally\nStructure your response naturally:\n\n**a) Direct Answer** \nStart with the key finding that answers their question\nExample: \"Your Google Ads performed really well last week - ROAS hit 4.2, which is 15% above target!\"\n\n**b) Supporting Data**\nProvide specific numbers with context\nExample: \"Total spend was $12,450, generating 287 conversions at a CPA of $43.38\"\n\n**c) Comparison & Context**\nCompare to benchmarks or previous periods\nExample: \"That's a 28% improvement from the previous week when ROAS was 3.3\"\n\n**d) Why It Matters**\nExplain the business impact\nExample: \"This means your ad spend is now highly efficient - you're making $4.20 for every $1 spent\"\n\n**e) Actionable Recommendations**\nGive 2-4 specific next steps with priority\nExample: \"I'd recommend: 1) Scale the 'Holiday Sale' campaign budget by 30% since it's your top performer at 5.8 ROAS, 2) Pause the 'Brand Awareness' campaign that's at 1.2 ROAS and burning budget\"\n\n**f) Follow-up Offer**\nInvite deeper analysis\nExample: \"Want me to dig into which specific ad sets are driving that strong performance?\"\n\n---\n\n## COMMUNICATION STYLE\n\n### Be Conversational\n- Write like you're talking to a marketing colleague, not writing a report\n- Use \"I analyzed...\", \"I found...\", \"I noticed...\" to make it personal\n- Show enthusiasm for good news: \"Great news!\", \"Impressive!\", \"This is looking strong!\"\n- Show concern for issues: \"We need to address this\", \"This is worth investigating\"\n- Ask follow-up questions naturally: \"Want me to break that down further?\"\n\n### Be Precise with Data\n- Always cite specific numbers: \"ROAS of 4.2\" not \"good ROAS\"\n- Include comparisons: \"up 15% from last week\" \n- Reference exact date ranges: \"December 22-28, 2025\"\n- Show calculations: \"287 conversions ÷ $12,450 spend = $43.38 CPA\"\n- Flag data quality issues: \"Note: Data is incomplete for December 25\"\n\n---\n\n## TOOL USAGE EXAMPLES\n\n### Using SearchGoogleDrive\n```\nUser query: \"Show me last week's report\"\n\nYour internal process:\n1. Determine date range: last week = Dec 22-28, 2025\n2. Call SearchGoogleDrive(query: \"weekly report December 22 OR December 28\")\n3. Receive list of files\n4. Identify the correct report file\n5. Read the file content\n6. Summarize key findings for the user\n```\n\n### Using GoogleAdsData Sheet\n```\nUser query: \"What's our best performing Google Ads campaign?\"\n\nYour internal process:\n1. Call GoogleAdsData (read entire sheet)\n2. Parse all campaigns with their metrics\n3. Calculate ROAS for each campaign\n4. Sort by ROAS (highest to lowest)\n5. Identify top performer\n6. Respond: \"Your 'Shopping - High Intent' campaign is crushing it at 6.2 ROAS...\"\n```\n\n### Using Multiple Sheets\n```\nUser query: \"Compare all our channels\"\n\nYour internal process:\n1. Call GoogleAdsData sheet\n2. Call MetaAdsData sheet\n3. Call GoogleAnalyticData sheet\n4. Aggregate metrics from each\n5. Calculate totals and efficiency metrics\n6. Create comparison showing which channel performs best\n7. Provide recommendation on budget allocation\n```\n\n---\n\n## FINAL REMINDERS\n\n**Your Purpose:** Help marketers make data-driven decisions by analyzing their campaign performance and providing clear, actionable insights.\n\n**Your Strength:** You have direct access to live data through connected tools - USE THEM!\n\n**Your Style:** Conversational expert colleague, not a robotic report generator.\n\n**Your Value:** Turn raw data into strategic insights that drive business results.\n\nAlways remember: **Retrieve data FIRST, analyze SECOND, respond THIRD.**\n\nNever skip the data retrieval step!"
        }
      },
      "id": "542bad2f-fad2-4e6d-b7af-499c7cd2b35c",
      "name": "Weekly Report Agent",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "position": [
        1872,
        432
      ],
      "typeVersion": 1.7
    },
    {
      "parameters": {
        "content": "## The following accesses are required for the workflow:\n- Google Analytics (via Google Analytics API): [Documentation](https://docs.n8n.io/integrations/builtin/credentials/google/)\n- Google Ads (via HTTP Request -&gt; Google Ads API):[Documentation](https://docs.n8n.io/integrations/builtin/credentials/google/)\n- Meta Ads (via Facebook Graph API): [Documentation](https://docs.n8n.io/integrations/builtin/credentials/facebookgraph/)\n- AI API access (e.g. via OpenAI, Anthropic, Google or Ollama)\n\n",
        "height": 356,
        "width": 440
      },
      "id": "eb8e59fe-2dbd-49e6-a055-a01f7419d8f3",
      "name": "Sticky Note1",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        0,
        496
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "height": 1520,
        "width": 816,
        "color": 4
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -32,
        880
      ],
      "typeVersion": 1,
      "id": "4f1be070-c936-4515-8990-03f7baef636e",
      "name": "Sticky Note5"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.manualTrigger",
      "typeVersion": 1,
      "position": [
        48,
        1440
      ],
      "id": "2c39491c-ecb8-45c3-9bc4-3699ea459984",
      "name": "When clicking ‘Execute workflow’"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.dateTime",
      "typeVersion": 2,
      "position": [
        208,
        1440
      ],
      "id": "c2443284-ac5e-470b-982a-757c28fd3c1b",
      "name": "Date & Time"
    },
    {
      "parameters": {
        "resource": "folder",
        "name": "NewMarketingReport",
        "driveId": {
          "__rl": true,
          "mode": "list",
          "value": "My Drive"
        },
        "folderId": {
          "__rl": true,
          "value": "1IQU1Aqws1sTyM8sdUwjnvGDCYWpIgYxe",
          "mode": "list",
          "cachedResultName": "n8n-workflows-data",
          "cachedResultUrl": "https://drive.google.com/drive/folders/1IQU1Aqws1sTyM8sdUwjnvGDCYWpIgYxe"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        400,
        1440
      ],
      "id": "addc3009-8992-464b-844f-d6c1e4d92839",
      "name": "Create folder",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "IYt9e9Ocdig5ushn",
          "name": "Drive-macaipiotr@gmail.com"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "operation": "createFromText",
        "content": "={{ $json.output }}",
        "name": "=GA-Report:  {{ $('Call Google Analytics data: Last 7 days').item.json.date }}",
        "driveId": {
          "__rl": true,
          "mode": "list",
          "value": "My Drive"
        },
        "folderId": {
          "__rl": true,
          "value": "https://drive.google.com/drive/folders/1476-X51qFV_qyQ2AobvAcnd1WDX4-nRB",
          "mode": "url"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        2368,
        1008
      ],
      "id": "c91a7358-10c3-4cc6-9df9-ffbfe30a3f61",
      "name": "Create file from text",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "IYt9e9Ocdig5ushn",
          "name": "Drive-macaipiotr@gmail.com"
        }
      }
    },
    {
      "parameters": {
        "operation": "createFromText",
        "name": "Google Ads Report: ",
        "driveId": {
          "__rl": true,
          "mode": "list",
          "value": "My Drive"
        },
        "folderId": {
          "__rl": true,
          "value": "https://drive.google.com/drive/folders/1Q_vTLR8y7InyYxtLjY9isS7VdOqC8hdB",
          "mode": "url"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        3488,
        1536
      ],
      "id": "22e613f0-39e6-48ed-b6ac-4720e6423c7b",
      "name": "Create file from text1",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "IYt9e9Ocdig5ushn",
          "name": "Drive-macaipiotr@gmail.com"
        }
      }
    },
    {
      "parameters": {
        "operation": "createFromText",
        "name": "Meta Report: ",
        "driveId": {
          "__rl": true,
          "mode": "list",
          "value": "My Drive"
        },
        "folderId": {
          "__rl": true,
          "value": "https://drive.google.com/drive/folders/1Q_vTLR8y7InyYxtLjY9isS7VdOqC8hdB",
          "mode": "url"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        3584,
        2288
      ],
      "id": "13ec0afc-c193-49d0-86d0-bbb7423fd7ae",
      "name": "Create file from text2",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "IYt9e9Ocdig5ushn",
          "name": "Drive-macaipiotr@gmail.com"
        }
      }
    },
    {
      "parameters": {
        "numberInputs": 3
      },
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        4672,
        1536
      ],
      "id": "eab82307-7ab7-4ddd-9f75-31aacfd97147",
      "name": "Merge"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3,
      "position": [
        4880,
        1552
      ],
      "id": "abcf4338-2661-4bc6-bca9-dc1c7fae4e62",
      "name": "AI Agent"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        4784,
        1792
      ],
      "id": "bb52084b-59fc-44c3-92b3-b797148ff4d3",
      "name": "Google Gemini Chat Model",
      "credentials": {
        "googlePalmApi": {
          "id": "lumSp9bfirbMB8Vi",
          "name": "GeminiAPI"
        }
      }
    },
    {
      "parameters": {
        "propertyId": {
          "__rl": true,
          "mode": "id",
          "value": "={{ $json['GA4 Property ID'] }}"
        },
        "dateRange": "custom",
        "startDate": "={{ $json.startDate }}",
        "endDate": "={{ $json.endDate }}",
        "metricsGA4": {
          "metricValues": [
            {
              "listName": "sessions"
            },
            {},
            {
              "listName": "other",
              "name": "=newUsers"
            },
            {
              "listName": "other",
              "name": "=ecommercePurchases"
            },
            {
              "listName": "other",
              "name": "=purchaseRevenue"
            }
          ]
        },
        "dimensionsGA4": {
          "dimensionValues": [
            {},
            {
              "listName": "other",
              "name": "=sessionDefaultChannelGroup"
            }
          ]
        },
        "returnAll": true,
        "simple": false,
        "additionalFields": {}
      },
      "id": "16300f6d-f004-421e-84ce-47e715dbeeed",
      "name": "GA4 - Session Channel Group",
      "type": "n8n-nodes-base.googleAnalytics",
      "position": [
        1376,
        5360
      ],
      "typeVersion": 2,
      "credentials": {
        "googleAnalyticsOAuth2": {
          "id": "nDVnksBtyvj6OfR3",
          "name": "GA_macaipiotr@gmail.com"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "projectId": {
          "__rl": true,
          "mode": "id",
          "value": "={{ $('Backfill Config').item.json.project_id }}"
        },
        "sqlQuery": "-- This query creates a table for session data by channel group for the specified date range.\n-- It then inserts the aggregated data from the corresponding GA4 node.\nCREATE OR REPLACE TABLE `{{ $('Backfill Config').item.json.project_id }}`.`{{ $('Backfill Config').item.json.dataset_id }}`.ga4_data_session_channel_group_{{ $('Backfill Config').item.json.startDate.replaceAll('-', '') }} (\n  date DATE,\n  sessionDefaultChannelGroup STRING,\n  sessions INT64,\n  totalUsers INT64,\n  newUsers INT64,\n  ecommercePurchases INT64,\n  purchaseRevenue FLOAT64\n);\n\n-- Insert data from the GA4 node.\nINSERT INTO `{{ $('Backfill Config').item.json.project_id }}`.`{{ $('Backfill Config').item.json.dataset_id }}`.ga4_data_session_channel_group_{{ $('Backfill Config').item.json.startDate.replaceAll('-', '') }} (date, sessionDefaultChannelGroup, sessions, totalUsers, newUsers, ecommercePurchases, purchaseRevenue)\nVALUES\n{{ $items()[0].json.rows.map(row => `(PARSE_DATE('%Y%m%d', '${row.dimensionValues[0].value}'), '${row.dimensionValues[1].value}', ${row.metricValues[0].value || 'NULL'}, ${row.metricValues[1].value || 'NULL'}, ${row.metricValues[2].value || 'NULL'}, ${row.metricValues[3].value || 'NULL'}, ${row.metricValues[4].value || 'NULL'})`).join(',') }};\n",
        "options": {}
      },
      "id": "4dc64713-63ac-44f0-9f86-4659ff7c293a",
      "name": "BQ - ga4_data_session_channel_group",
      "type": "n8n-nodes-base.googleBigQuery",
      "position": [
        1600,
        5360
      ],
      "typeVersion": 2.1,
      "disabled": true,
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "propertyId": {
          "__rl": true,
          "mode": "id",
          "value": "={{ $json['GA4 Property ID'] }}"
        },
        "dateRange": "custom",
        "startDate": "={{ $json.startDate }}",
        "endDate": "={{ $json.endDate }}",
        "metricsGA4": {
          "metricValues": [
            {
              "listName": "sessions"
            },
            {},
            {
              "listName": "other",
              "name": "=newUsers"
            },
            {
              "listName": "other",
              "name": "=ecommercePurchases"
            },
            {
              "listName": "other",
              "name": "=purchaseRevenue"
            }
          ]
        },
        "dimensionsGA4": {
          "dimensionValues": [
            {},
            {
              "listName": "other",
              "name": "=sessionSource"
            },
            {
              "listName": "other",
              "name": "=sessionCampaignName"
            },
            {
              "listName": "other",
              "name": "=sessionMedium"
            }
          ]
        },
        "returnAll": true,
        "simple": false,
        "additionalFields": {}
      },
      "id": "ac9d222f-ac86-48e4-88c4-1cd92f1667c6",
      "name": "GA4 - Session Source/Campaign/Medium",
      "type": "n8n-nodes-base.googleAnalytics",
      "position": [
        1376,
        5552
      ],
      "typeVersion": 2,
      "credentials": {
        "googleAnalyticsOAuth2": {
          "id": "nDVnksBtyvj6OfR3",
          "name": "GA_macaipiotr@gmail.com"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "projectId": {
          "__rl": true,
          "mode": "id",
          "value": "={{ $('Backfill Config').item.json.project_id }}"
        },
        "sqlQuery": "-- Creates and populates a daily table for session data by source, campaign, and medium.\nCREATE OR REPLACE TABLE `{{ $('Backfill Config').item.json.project_id }}`.`{{ $('Backfill Config').item.json.dataset_id }}`.ga4_data_session_source_campaign_medium_{{ $('Backfill Config').item.json.startDate.replaceAll('-', '') }} (\n  date DATE,\n  sessionSource STRING,\n  sessionCampaignName STRING,\n  sessionMedium STRING,\n  sessions INT64,\n  totalUsers INT64,\n  newUsers INT64,\n  ecommercePurchases INT64,\n  purchaseRevenue FLOAT64\n);\n\n-- Insert data from the GA4 node.\nINSERT INTO `{{ $('Backfill Config').item.json.project_id }}`.`{{ $('Backfill Config').item.json.dataset_id }}`.ga4_data_session_source_campaign_medium_{{ $('Backfill Config').item.json.startDate.replaceAll('-', '') }}(date, sessionSource, sessionCampaignName, sessionMedium, sessions, totalUsers, newUsers, ecommercePurchases, purchaseRevenue)\nVALUES\n{{ $items()[0].json.rows.map(row => `(PARSE_DATE('%Y%m%d', '${row.dimensionValues[0].value}'), '${row.dimensionValues[1].value}', '${row.dimensionValues[2].value}', '${row.dimensionValues[3].value}', ${row.metricValues[0].value || 'NULL'}, ${row.metricValues[1].value || 'NULL'}, ${row.metricValues[2].value || 'NULL'}, ${row.metricValues[3].value || 'NULL'}, ${row.metricValues[4].value || 'NULL'})`).join(',') }};\n",
        "options": {}
      },
      "id": "764b684f-2be3-4ca2-9f6a-5481a4e62d6f",
      "name": "BQ - ga4_data_session_source_campaign_medium",
      "type": "n8n-nodes-base.googleBigQuery",
      "position": [
        1600,
        5552
      ],
      "executeOnce": false,
      "typeVersion": 2.1,
      "disabled": true,
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "propertyId": {
          "__rl": true,
          "mode": "id",
          "value": "={{ $json['GA4 Property ID'] }}"
        },
        "dateRange": "custom",
        "startDate": "={{ $json.startDate }}",
        "endDate": "={{ $json.endDate }}",
        "metricsGA4": {
          "metricValues": [
            {
              "listName": "sessions"
            },
            {
              "listName": "screenPageViews"
            },
            {},
            {
              "listName": "other",
              "name": "=newUsers"
            },
            {
              "listName": "other",
              "name": "=ecommercePurchases"
            },
            {
              "listName": "other",
              "name": "=purchaseRevenue"
            }
          ]
        },
        "dimensionsGA4": {
          "dimensionValues": [
            {},
            {
              "listName": "city"
            },
            {
              "listName": "language"
            },
            {
              "listName": "country"
            }
          ]
        },
        "returnAll": true,
        "simple": false,
        "additionalFields": {}
      },
      "id": "97b7b19f-0bd7-4f23-a742-bb8e9930b56c",
      "name": "GA4 - Country/Language/City",
      "type": "n8n-nodes-base.googleAnalytics",
      "position": [
        1376,
        5744
      ],
      "typeVersion": 2,
      "credentials": {
        "googleAnalyticsOAuth2": {
          "id": "nDVnksBtyvj6OfR3",
          "name": "GA_macaipiotr@gmail.com"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "projectId": {
          "__rl": true,
          "mode": "id",
          "value": "={{ $('Backfill Config').item.json.project_id }}"
        },
        "sqlQuery": "-- Creates and populates a daily table for user data by country, language, and city.\nCREATE OR REPLACE TABLE `{{ $('Backfill Config').item.json.project_id }}`.`{{ $('Backfill Config').item.json.dataset_id }}`.ga4_data_country_language_city_{{ $('Backfill Config').item.json.startDate.replaceAll('-', '') }} (\n  date DATE,\n  country STRING,\n  language STRING,\n  city STRING,\n  sessions INT64,\n  screenPageViews INT64,\n  totalUsers INT64,\n  newUsers INT64,\n  ecommercePurchases INT64,\n  purchaseRevenue FLOAT64\n);\n\n-- Insert data from the GA4 node.\nINSERT INTO `{{ $('Backfill Config').item.json.project_id }}`.`{{ $('Backfill Config').item.json.dataset_id }}`.ga4_data_country_language_city_{{ $('Backfill Config').item.json.startDate.replaceAll('-', '') }} (date, country, language, city, sessions, screenPageViews, totalUsers, newUsers, ecommercePurchases, purchaseRevenue)\nVALUES\n{{ $items()[0].json.rows.map(row => `(PARSE_DATE('%Y%m%d', '${row.dimensionValues[0].value}'), '${row.dimensionValues[1].value}', '${row.dimensionValues[2].value}', '${row.dimensionValues[3].value}', ${row.metricValues[0].value || 'NULL'}, ${row.metricValues[1].value || 'NULL'}, ${row.metricValues[2].value || 'NULL'}, ${row.metricValues[3].value || 'NULL'}, ${row.metricValues[4].value || 'NULL'}, ${row.metricValues[5].value || 'NULL'})`).join(',') }};\n",
        "options": {}
      },
      "id": "d87f2d2a-e589-424b-b871-ec459ed0e8cc",
      "name": "BQ - ga4_data_country_language_city",
      "type": "n8n-nodes-base.googleBigQuery",
      "position": [
        1600,
        5744
      ],
      "typeVersion": 2.1,
      "disabled": true,
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "propertyId": {
          "__rl": true,
          "mode": "id",
          "value": "={{ $json['GA4 Property ID'] }}"
        },
        "dateRange": "custom",
        "startDate": "={{ $json.startDate }}",
        "endDate": "={{ $json.endDate }}",
        "metricsGA4": {
          "metricValues": [
            {
              "listName": "other",
              "name": "=itemPurchaseQuantity"
            },
            {
              "listName": "other",
              "name": "=itemRevenue"
            }
          ]
        },
        "dimensionsGA4": {
          "dimensionValues": [
            {},
            {
              "listName": "itemName"
            }
          ]
        },
        "returnAll": true,
        "simple": false,
        "additionalFields": {}
      },
      "id": "90ef3628-b0cd-4601-9b8b-934f82eb72e6",
      "name": "GA4 - Item Name",
      "type": "n8n-nodes-base.googleAnalytics",
      "position": [
        1376,
        5936
      ],
      "typeVersion": 2,
      "credentials": {
        "googleAnalyticsOAuth2": {
          "id": "nDVnksBtyvj6OfR3",
          "name": "GA_macaipiotr@gmail.com"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "projectId": {
          "__rl": true,
          "mode": "id",
          "value": "={{ $('Backfill Config').item.json.project_id }}"
        },
        "sqlQuery": "-- Creates and populates a daily table for item-specific metrics.\nCREATE OR REPLACE TABLE `{{ $('Backfill Config').item.json.project_id }}`.`{{ $('Backfill Config').item.json.dataset_id }}`.ga4_data_item_name_{{ $('Backfill Config').item.json.startDate.replaceAll('-', '') }} (\n  date DATE,\n  itemName STRING,\n  itemPurchaseQuantity INT64,\n  itemRevenue FLOAT64\n);\n\n-- Insert data from the GA4 node.\nINSERT INTO `{{ $('Backfill Config').item.json.project_id }}`.`{{ $('Backfill Config').item.json.dataset_id }}`.ga4_data_item_name_{{ $('Backfill Config').item.json.startDate.replaceAll('-', '') }}(date, itemName, itemPurchaseQuantity, itemRevenue)\nVALUES\n{{ $items()[0].json.rows.map(row => `(PARSE_DATE('%Y%m%d', '${row.dimensionValues[0].value}'), '${row.dimensionValues[1].value}', ${row.metricValues[0].value || 'NULL'}, ${row.metricValues[1].value || 'NULL'})`).join(',') }};\n",
        "options": {}
      },
      "id": "5319033e-4eee-4737-8ea1-cf7229364d6d",
      "name": "BQ - ga4_data_item_name",
      "type": "n8n-nodes-base.googleBigQuery",
      "position": [
        1600,
        5936
      ],
      "typeVersion": 2.1,
      "disabled": true,
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "propertyId": {
          "__rl": true,
          "mode": "id",
          "value": "={{ $json['GA4 Property ID'] }}"
        },
        "dateRange": "custom",
        "startDate": "={{ $json.startDate }}",
        "endDate": "={{ $json.endDate }}",
        "metricsGA4": {
          "metricValues": [
            {
              "listName": "sessions"
            },
            {},
            {
              "listName": "screenPageViews"
            },
            {
              "listName": "other",
              "name": "=newUsers"
            },
            {
              "listName": "other",
              "name": "=ecommercePurchases"
            },
            {
              "listName": "other",
              "name": "=purchaseRevenue"
            }
          ]
        },
        "dimensionsGA4": {
          "dimensionValues": [
            {},
            {
              "listName": "browser"
            },
            {
              "listName": "other",
              "name": "=operatingSystem"
            },
            {
              "listName": "deviceCategory"
            }
          ]
        },
        "returnAll": true,
        "simple": false,
        "additionalFields": {}
      },
      "id": "65d0a730-8f87-473d-9ffd-1a179bc65d79",
      "name": "GA4 - Browser/OS/Device",
      "type": "n8n-nodes-base.googleAnalytics",
      "position": [
        1376,
        6128
      ],
      "typeVersion": 2,
      "credentials": {
        "googleAnalyticsOAuth2": {
          "id": "nDVnksBtyvj6OfR3",
          "name": "GA_macaipiotr@gmail.com"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "projectId": {
          "__rl": true,
          "mode": "id",
          "value": "={{ $('Backfill Config').item.json.project_id }}"
        },
        "sqlQuery": "-- Creates and populates a daily table for technology data (browser, OS, device).\nCREATE OR REPLACE TABLE `{{ $('Backfill Config').item.json.project_id }}`.`{{ $('Backfill Config').item.json.dataset_id }}`.ga4_data_browser_os_device_{{ $('Backfill Config').item.json.startDate.replaceAll('-', '') }} (\n  date DATE,\n  browser STRING,\n  operatingSystem STRING,\n  deviceCategory STRING,\n  sessions INT64,\n  screenPageViews INT64,\n  totalUsers INT64,\n  newUsers INT64,\n  ecommercePurchases INT64,\n  purchaseRevenue FLOAT64\n);\n\n-- Insert data from the GA4 node.\nINSERT INTO `{{ $('Backfill Config').item.json.project_id }}`.`{{ $('Backfill Config').item.json.dataset_id }}`.ga4_data_browser_os_device_{{ $('Backfill Config').item.json.startDate.replaceAll('-', '') }} (date, browser, operatingSystem, deviceCategory, sessions, screenPageViews, totalUsers, newUsers, ecommercePurchases, purchaseRevenue)\nVALUES\n{{ $items()[0].json.rows.map(row => `(PARSE_DATE('%Y%m%d', '${row.dimensionValues[0].value}'), '${row.dimensionValues[1].value}', '${row.dimensionValues[2].value}', '${row.dimensionValues[3].value}', ${row.metricValues[0].value || 'NULL'}, ${row.metricValues[1].value || 'NULL'}, ${row.metricValues[2].value || 'NULL'}, ${row.metricValues[3].value || 'NULL'}, ${row.metricValues[4].value || 'NULL'}, ${row.metricValues[5].value || 'NULL'})`).join(',') }};\n",
        "options": {}
      },
      "id": "e2edd22f-2fee-4e95-a051-3251f90819f0",
      "name": "BQ - ga4_data_browser_os_device",
      "type": "n8n-nodes-base.googleBigQuery",
      "position": [
        1600,
        6128
      ],
      "retryOnFail": false,
      "typeVersion": 2.1,
      "disabled": true,
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "propertyId": {
          "__rl": true,
          "mode": "id",
          "value": "={{ $json['GA4 Property ID'] }}"
        },
        "dateRange": "custom",
        "startDate": "={{ $json.startDate }}",
        "endDate": "={{ $json.endDate }}",
        "metricsGA4": {
          "metricValues": [
            {},
            {
              "listName": "other",
              "name": "=newUsers"
            },
            {
              "listName": "other",
              "name": "=ecommercePurchases"
            },
            {
              "listName": "other",
              "name": "=purchaseRevenue"
            }
          ]
        },
        "dimensionsGA4": {
          "dimensionValues": [
            {},
            {
              "listName": "other",
              "name": "=firstUserMedium"
            },
            {
              "listName": "other",
              "name": "=firstUserCampaignName"
            },
            {
              "listName": "other",
              "name": "=firstUserSource"
            }
          ]
        },
        "returnAll": true,
        "simple": false,
        "additionalFields": {}
      },
      "id": "cde29608-69c5-468d-92bb-9920d6b99fa0",
      "name": "GA4 - First User Source/Medium",
      "type": "n8n-nodes-base.googleAnalytics",
      "position": [
        1376,
        6320
      ],
      "typeVersion": 2,
      "credentials": {
        "googleAnalyticsOAuth2": {
          "id": "nDVnksBtyvj6OfR3",
          "name": "GA_macaipiotr@gmail.com"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "projectId": {
          "__rl": true,
          "mode": "id",
          "value": "={{ $('Backfill Config').item.json.project_id }}"
        },
        "sqlQuery": "-- Creates and populates a daily table for first-user acquisition source.\nCREATE OR REPLACE TABLE `{{ $('Backfill Config').item.json.project_id }}`.`{{ $('Backfill Config').item.json.dataset_id }}`.ga4_data_first_user_source_medium_{{ $('Backfill Config').item.json.startDate.replaceAll('-', '') }} (\n  date DATE,\n  firstUserMedium STRING,\n  firstUserSource STRING,\n  firstUserCampaignName STRING,\n  totalUsers INT64,\n  newUsers INT64,\n  ecommercePurchases INT64,\n  purchaseRevenue FLOAT64\n);\n\n-- Insert data from the GA4 node.\nINSERT INTO `{{ $('Backfill Config').item.json.project_id }}`.`{{ $('Backfill Config').item.json.dataset_id }}`.ga4_data_first_user_source_medium_{{ $('Backfill Config').item.json.startDate.replaceAll('-', '') }} (date, firstUserMedium, firstUserSource, firstUserCampaignName, totalUsers, newUsers, ecommercePurchases, purchaseRevenue)\nVALUES\n{{ $items()[0].json.rows.map(row => `(PARSE_DATE('%Y%m%d', '${row.dimensionValues[0].value}'), '${row.dimensionValues[1].value}', '${row.dimensionValues[2].value}', '${row.dimensionValues[3].value}', ${row.metricValues[0].value || 'NULL'}, ${row.metricValues[1].value || 'NULL'}, ${row.metricValues[2].value || 'NULL'}, ${row.metricValues[3].value || 'NULL'})`).join(',') }};\n",
        "options": {}
      },
      "id": "245003d6-e24e-48d4-a83d-c8ef36ba128f",
      "name": "BQ - ga4_data_first_user_source_medium",
      "type": "n8n-nodes-base.googleBigQuery",
      "position": [
        1600,
        6320
      ],
      "typeVersion": 2.1,
      "disabled": true,
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "propertyId": {
          "__rl": true,
          "mode": "id",
          "value": "={{ $json['GA4 Property ID'] }}"
        },
        "dateRange": "custom",
        "startDate": "={{ $json.startDate }}",
        "endDate": "={{ $json.endDate }}",
        "metricsGA4": {
          "metricValues": [
            {},
            {
              "listName": "other",
              "name": "=newUsers"
            },
            {
              "listName": "other",
              "name": "=ecommercePurchases"
            },
            {
              "listName": "other",
              "name": "=purchaseRevenue"
            }
          ]
        },
        "dimensionsGA4": {
          "dimensionValues": [
            {},
            {
              "listName": "other",
              "name": "=firstUserDefaultChannelGroup"
            }
          ]
        },
        "returnAll": true,
        "simple": false,
        "additionalFields": {}
      },
      "id": "7754092c-b467-448f-b777-450b7f26c644",
      "name": "GA4 - First User Channel Group",
      "type": "n8n-nodes-base.googleAnalytics",
      "position": [
        1376,
        6512
      ],
      "typeVersion": 2,
      "credentials": {
        "googleAnalyticsOAuth2": {
          "id": "nDVnksBtyvj6OfR3",
          "name": "GA_macaipiotr@gmail.com"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "projectId": {
          "__rl": true,
          "mode": "id",
          "value": "={{ $('Backfill Config').item.json.project_id }}"
        },
        "sqlQuery": "-- Creates and populates a daily table for first-user acquisition by channel group.\nCREATE OR REPLACE TABLE `{{ $('Backfill Config').item.json.project_id }}`.`{{ $('Backfill Config').item.json.dataset_id }}`.ga4_data_first_user_channel_group_{{ $('Backfill Config').item.json.startDate.replaceAll('-', '') }} (\n  date DATE,\n  firstUserDefaultChannelGroup STRING,\n  totalUsers INT64,\n  newUsers INT64,\n  ecommercePurchases INT64,\n  purchaseRevenue FLOAT64\n);\n\n-- Insert data from the GA4 node.\nINSERT INTO `{{ $('Backfill Config').item.json.project_id }}`.`{{ $('Backfill Config').item.json.dataset_id }}`.ga4_data_first_user_channel_group_{{ $('Backfill Config').item.json.startDate.replaceAll('-', '') }} (date, firstUserDefaultChannelGroup, totalUsers, newUsers, ecommercePurchases, purchaseRevenue)\nVALUES\n{{ $items()[0].json.rows.map(row => `(PARSE_DATE('%Y%m%d', '${row.dimensionValues[0].value}'), '${row.dimensionValues[1].value}', ${row.metricValues[0].value || 'NULL'}, ${row.metricValues[1].value || 'NULL'}, ${row.metricValues[2].value || 'NULL'}, ${row.metricValues[3].value || 'NULL'})`).join(',') }};\n",
        "options": {}
      },
      "id": "af42ed74-97b8-41bd-91ad-83b00fa3a6ee",
      "name": "BQ - ga4_data_first_user_channel_group",
      "type": "n8n-nodes-base.googleBigQuery",
      "position": [
        1600,
        6512
      ],
      "typeVersion": 2.1,
      "disabled": true,
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "propertyId": {
          "__rl": true,
          "mode": "id",
          "value": "={{ $json['GA4 Property ID'] }}"
        },
        "dateRange": "custom",
        "startDate": "={{ $json.startDate }}",
        "endDate": "={{ $json.endDate }}",
        "metricsGA4": {
          "metricValues": [
            {
              "listName": "other",
              "name": "=ecommercePurchases"
            },
            {
              "listName": "other",
              "name": "=averagePurchaseRevenue"
            },
            {
              "listName": "other",
              "name": "=purchaseRevenue"
            },
            {
              "listName": "other",
              "name": "=advertiserAdClicks"
            },
            {
              "listName": "other",
              "name": "=advertiserAdCost"
            },
            {
              "listName": "other",
              "name": "=advertiserAdCostPerClick"
            },
            {
              "listName": "other",
              "name": "=returnOnAdSpend"
            }
          ]
        },
        "dimensionsGA4": {
          "dimensionValues": [
            {},
            {
              "listName": "other",
              "name": "=sessionSource"
            },
            {
              "listName": "other",
              "name": "=sessionMedium"
            },
            {
              "listName": "other",
              "name": "=sessionCampaignName"
            }
          ]
        },
        "returnAll": true,
        "simple": false,
        "additionalFields": {}
      },
      "id": "5f1a9059-dbb8-4d65-aa8b-3ee7b8f94382",
      "name": "GA4 - Ads Data",
      "type": "n8n-nodes-base.googleAnalytics",
      "position": [
        1376,
        6704
      ],
      "typeVersion": 2,
      "credentials": {
        "googleAnalyticsOAuth2": {
          "id": "nDVnksBtyvj6OfR3",
          "name": "GA_macaipiotr@gmail.com"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "projectId": {
          "__rl": true,
          "mode": "id",
          "value": "={{ $('Backfill Config').item.json.project_id }}"
        },
        "sqlQuery": "-- Creates and populates a daily table for advertising performance metrics.\nCREATE OR REPLACE TABLE `{{ $('Backfill Config').item.json.project_id }}`.`{{ $('Backfill Config').item.json.dataset_id }}`.ga4_ads_data_{{ $('Backfill Config').item.json.startDate.replaceAll('-', '') }} (\n  date DATE,\n  sessionSource STRING,\n  sessionMedium STRING,\n  sessionCampaignName STRING,\n  ecommercePurchases INT64,\n  averagePurchaseRevenue FLOAT64,\n  purchaseRevenue FLOAT64,\n  advertiserAdClicks INT64,\n  advertiserAdCost FLOAT64,\n  advertiserAdCostPerClick FLOAT64,\n  returnOnAdSpend FLOAT64\n);\n\n-- Insert data from the GA4 node.\nINSERT INTO `{{ $('Backfill Config').item.json.project_id }}`.`{{ $('Backfill Config').item.json.dataset_id }}`.ga4_ads_data_{{ $('Backfill Config').item.json.startDate.replaceAll('-', '') }} (date, sessionSource, sessionMedium, sessionCampaignName, ecommercePurchases, averagePurchaseRevenue, purchaseRevenue, advertiserAdClicks, advertiserAdCost, advertiserAdCostPerClick, returnOnAdSpend)\nVALUES\n{{ $items()[0].json.rows.map(row => `(PARSE_DATE('%Y%m%d', '${row.dimensionValues[0].value}'), '${row.dimensionValues[1].value}', '${row.dimensionValues[2].value}', '${row.dimensionValues[3].value}', ${row.metricValues[0].value || 'NULL'}, ${row.metricValues[1].value || 'NULL'}, ${row.metricValues[2].value || 'NULL'}, ${row.metricValues[3].value || 'NULL'}, ${row.metricValues[4].value || 'NULL'}, ${row.metricValues[5].value || 'NULL'}, ${row.metricValues[6].value || 'NULL'})`).join(',') }};\n",
        "options": {}
      },
      "id": "8657ac83-6fc4-4b26-9ed5-12a278dc7976",
      "name": "BQ - ga4_ads_data",
      "type": "n8n-nodes-base.googleBigQuery",
      "position": [
        1600,
        6704
      ],
      "typeVersion": 2.1,
      "disabled": true,
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "propertyId": {
          "__rl": true,
          "mode": "id",
          "value": "={{ $json['GA4 Property ID'] }}"
        },
        "dateRange": "custom",
        "startDate": "={{ $json.startDate }}",
        "endDate": "={{ $json.endDate }}",
        "metricsGA4": {
          "metricValues": [
            {
              "listName": "sessions"
            },
            {},
            {
              "listName": "userEngagementDuration"
            },
            {
              "listName": "other",
              "name": "=newUsers"
            },
            {
              "listName": "other",
              "name": "=engagementRate"
            },
            {
              "listName": "other",
              "name": "=engagedSessions"
            },
            {
              "listName": "screenPageViews"
            },
            {
              "listName": "other",
              "name": "=purchaseRevenue"
            },
            {
              "listName": "other",
              "name": "=ecommercePurchases"
            }
          ]
        },
        "dimensionsGA4": {
          "dimensionValues": [
            {}
          ]
        },
        "returnAll": true,
        "simple": false,
        "additionalFields": {}
      },
      "id": "ee390436-675d-4a2b-8518-21ec44818fa8",
      "name": "GA4 - All Metrics",
      "type": "n8n-nodes-base.googleAnalytics",
      "position": [
        1376,
        6896
      ],
      "typeVersion": 2,
      "credentials": {
        "googleAnalyticsOAuth2": {
          "id": "nDVnksBtyvj6OfR3",
          "name": "GA_macaipiotr@gmail.com"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "projectId": {
          "__rl": true,
          "mode": "id",
          "value": "={{ $('Backfill Config').item.json.project_id }}"
        },
        "sqlQuery": "-- Creates and populates a daily summary table of all key metrics.\n-- This version is corrected to match the exact output of the GA4 - All Metrics node.\nCREATE OR REPLACE TABLE `{{ $('Backfill Config').item.json.project_id }}`.`{{ $('Backfill Config').item.json.dataset_id }}`.ga4_all_metrics_data_{{ $('Backfill Config').item.json.startDate.replaceAll('-', '') }} (\n  date DATE,\n  sessions INT64,\n  totalUsers INT64,\n  userEngagementDuration FLOAT64,\n  newUsers INT64,\n  engagementRate FLOAT64,\n  engagedSessions INT64,\n  screenPageViews INT64,\n  purchaseRevenue FLOAT64,\n  ecommercePurchases INT64\n);\n\n-- Insert data from the GA4 node with the correct metric mapping.\nINSERT INTO `{{ $('Backfill Config').item.json.project_id }}`.`{{ $('Backfill Config').item.json.dataset_id }}`.ga4_all_metrics_data_{{ $('Backfill Config').item.json.startDate.replaceAll('-', '') }} (date, sessions, totalUsers, userEngagementDuration, newUsers, engagementRate, engagedSessions, screenPageViews, purchaseRevenue, ecommercePurchases)\nVALUES\n{{ $items()[0].json.rows.map(row => `(PARSE_DATE('%Y%m%d', '${row.dimensionValues[0].value}'), ${row.metricValues[0].value || 'NULL'}, ${row.metricValues[1].value || 'NULL'}, ${row.metricValues[2].value || 'NULL'}, ${row.metricValues[3].value || 'NULL'}, ${row.metricValues[4].value || 'NULL'}, ${row.metricValues[5].value || 'NULL'}, ${row.metricValues[6].value || 'NULL'}, ${row.metricValues[7].value || 'NULL'}, ${row.metricValues[8].value || 'NULL'})`).join(',') }};",
        "options": {}
      },
      "id": "85666ed1-0ad6-4a30-895e-08648135355b",
      "name": "BQ - ga4_all_metrics_data",
      "type": "n8n-nodes-base.googleBigQuery",
      "position": [
        1600,
        6896
      ],
      "typeVersion": 2.1,
      "disabled": true,
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "propertyId": {
          "__rl": true,
          "mode": "id",
          "value": "={{ $json['GA4 Property ID'] }}"
        },
        "dateRange": "custom",
        "startDate": "={{ $json.startDate }}",
        "endDate": "={{ $json.endDate }}",
        "metricsGA4": {
          "metricValues": [
            {
              "listName": "=eventCount",
              "name": "custom_metric"
            },
            {
              "listName": "other",
              "name": "=eventValue"
            },
            {
              "listName": "other",
              "name": "=eventCountPerUser"
            }
          ]
        },
        "dimensionsGA4": {
          "dimensionValues": [
            {},
            {
              "listName": "other",
              "name": "=eventName"
            }
          ]
        },
        "returnAll": true,
        "simple": false,
        "additionalFields": {}
      },
      "id": "68d722fc-ac4b-452b-8bcb-55075d51a76a",
      "name": "GA4 - Event Metrics",
      "type": "n8n-nodes-base.googleAnalytics",
      "position": [
        1376,
        7088
      ],
      "typeVersion": 2,
      "credentials": {
        "googleAnalyticsOAuth2": {
          "id": "nDVnksBtyvj6OfR3",
          "name": "GA_macaipiotr@gmail.com"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "projectId": {
          "__rl": true,
          "mode": "id",
          "value": "={{ $('Backfill Config').item.json.project_id }}"
        },
        "sqlQuery": "-- Creates and populates a daily table for event-specific metrics.\nCREATE OR REPLACE TABLE `{{ $('Backfill Config').item.json.project_id }}`.`{{ $('Backfill Config').item.json.dataset_id }}`.ga4_event_metrics_data_{{ $('Backfill Config').item.json.startDate.replaceAll('-', '') }} (\n  date DATE,\n  eventName STRING,\n  eventCount INT64,\n  eventCountPerUser FLOAT64,\n  eventValue FLOAT64\n);\n\n-- Insert data from the GA4 node.\nINSERT INTO `{{ $('Backfill Config').item.json.project_id }}`.`{{ $('Backfill Config').item.json.dataset_id }}`.ga4_event_metrics_data_{{ $('Backfill Config').item.json.startDate.replaceAll('-', '') }} (date, eventName, eventCount, eventCountPerUser, eventValue)\nVALUES\n{{ $items()[0].json.rows.map(row => `(PARSE_DATE('%Y%m%d', '${row.dimensionValues[0].value}'), '${row.dimensionValues[1].value}', ${row.metricValues[0].value || 'NULL'}, ${row.metricValues[1].value || 'NULL'}, ${row.metricValues[2].value || 'NULL'})`).join(',') }};\n",
        "options": {}
      },
      "id": "08f3130b-df5a-4563-baff-c192ba111bbe",
      "name": "BQ - ga4_event_metrics_data",
      "type": "n8n-nodes-base.googleBigQuery",
      "position": [
        1600,
        7088
      ],
      "typeVersion": 2.1,
      "disabled": true,
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "propertyId": {
          "__rl": true,
          "mode": "id",
          "value": "={{ $json['GA4 Property ID'] }}"
        },
        "dateRange": "custom",
        "startDate": "={{ $json.startDate }}",
        "endDate": "={{ $json.endDate }}",
        "metricsGA4": {
          "metricValues": [
            {},
            {
              "listName": "other",
              "name": "=ecommercePurchases"
            },
            {
              "listName": "screenPageViews"
            },
            {
              "listName": "other",
              "name": "=purchaseRevenue"
            },
            {
              "listName": "eventCount"
            },
            {
              "listName": "other",
              "name": "=engagementRate"
            }
          ]
        },
        "dimensionsGA4": {
          "dimensionValues": [
            {},
            {
              "listName": "pageLocation"
            }
          ]
        },
        "returnAll": true,
        "simple": false,
        "additionalFields": {}
      },
      "id": "be17e89a-c6dd-4400-bb21-74a2462ea3e9",
      "name": "GA4 - Page Location",
      "type": "n8n-nodes-base.googleAnalytics",
      "position": [
        1376,
        7280
      ],
      "typeVersion": 2,
      "credentials": {
        "googleAnalyticsOAuth2": {
          "id": "nDVnksBtyvj6OfR3",
          "name": "GA_macaipiotr@gmail.com"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "projectId": {
          "__rl": true,
          "mode": "id",
          "value": "={{ $('Backfill Config').item.json.project_id }}"
        },
        "sqlQuery": "-- Creates and populates a daily table for metrics by page location.\nCREATE OR REPLACE TABLE `{{ $('Backfill Config').item.json.project_id }}`.`{{ $('Backfill Config').item.json.dataset_id }}`.ga4_page_location_data_{{ $('Backfill Config').item.json.startDate.replaceAll('-', '') }} (\n  date DATE,\n  pageLocation STRING,\n  totalUsers INT64,\n  ecommercePurchases INT64,\n  purchaseRevenue FLOAT64,\n  screenPageViews INT64,\n  eventCount INT64,\n  engagementRate FLOAT64\n);\n\n-- Insert data from the GA4 node.\nINSERT INTO `{{ $('Backfill Config').item.json.project_id }}`.`{{ $('Backfill Config').item.json.dataset_id }}`.ga4_page_location_data_{{ $('Backfill Config').item.json.startDate.replaceAll('-', '') }} (date, pageLocation, totalUsers, ecommercePurchases, purchaseRevenue, screenPageViews, eventCount, engagementRate)\nVALUES\n{{ $items()[0].json.rows.map(row => `(PARSE_DATE('%Y%m%d', '${row.dimensionValues[0].value}'), '${row.dimensionValues[1].value}', ${row.metricValues[0].value || 'NULL'}, ${row.metricValues[1].value || 'NULL'}, ${row.metricValues[2].value || 'NULL'}, ${row.metricValues[3].value || 'NULL'}, ${row.metricValues[4].value || 'NULL'}, ${row.metricValues[5].value || 'NULL'})`).join(',') }};\n",
        "options": {}
      },
      "id": "e67bc0cc-f0ef-425f-9dac-788f4d05396e",
      "name": "BQ - ga4_page_location_data",
      "type": "n8n-nodes-base.googleBigQuery",
      "position": [
        1600,
        7280
      ],
      "typeVersion": 2.1,
      "disabled": true,
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "propertyId": {
          "__rl": true,
          "mode": "id",
          "value": "={{ $json['GA4 Property ID'] }}"
        },
        "dateRange": "custom",
        "startDate": "={{ $json.startDate }}",
        "endDate": "={{ $json.endDate }}",
        "metricsGA4": {
          "metricValues": [
            {},
            {
              "listName": "sessions"
            },
            {
              "listName": "eventCount"
            },
            {
              "listName": "other",
              "name": "=ecommercePurchases"
            },
            {
              "listName": "other",
              "name": "=engagementRate"
            },
            {
              "listName": "other",
              "name": "=purchaseRevenue"
            }
          ]
        },
        "dimensionsGA4": {
          "dimensionValues": [
            {},
            {
              "listName": "=other",
              "name": "=landingPage"
            }
          ]
        },
        "returnAll": true,
        "simple": false,
        "additionalFields": {}
      },
      "id": "e764b8a6-8dd5-4b9a-bb40-395347ca6071",
      "name": "GA4 - Landing Page",
      "type": "n8n-nodes-base.googleAnalytics",
      "position": [
        1488,
        7424
      ],
      "typeVersion": 2,
      "credentials": {
        "googleAnalyticsOAuth2": {
          "id": "nDVnksBtyvj6OfR3",
          "name": "GA_macaipiotr@gmail.com"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "propertyId": {
          "__rl": true,
          "mode": "id",
          "value": "={{ $json['GA4 Property ID'] }}"
        },
        "dateRange": "custom",
        "startDate": "={{ $json.startDate }}",
        "endDate": "={{ $json.endDate }}",
        "metricsGA4": {
          "metricValues": [
            {
              "listName": "other",
              "name": "=itemPurchaseQuantity"
            },
            {
              "listName": "other",
              "name": "=itemRevenue"
            }
          ]
        },
        "dimensionsGA4": {
          "dimensionValues": [
            {},
            {
              "listName": "other",
              "name": "=transactionId"
            },
            {
              "listName": "itemName"
            }
          ]
        },
        "returnAll": true,
        "simple": false,
        "additionalFields": {}
      },
      "id": "cf3e6090-3b8a-49df-96fc-6db3029cf205",
      "name": "GA4 - Transaction Items",
      "type": "n8n-nodes-base.googleAnalytics",
      "position": [
        1376,
        5168
      ],
      "typeVersion": 2,
      "credentials": {
        "googleAnalyticsOAuth2": {
          "id": "nDVnksBtyvj6OfR3",
          "name": "GA_macaipiotr@gmail.com"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "projectId": {
          "__rl": true,
          "mode": "id",
          "value": "={{ $('Backfill Config').item.json.project_id }}"
        },
        "sqlQuery": "-- This query first creates a new table for the specified date range, replacing it if it already exists.\n-- Then, it inserts the transaction data passed from the previous n8n node.\nCREATE OR REPLACE TABLE `{{ $('Backfill Config').item.json.project_id }}`.`{{ $('Backfill Config').item.json.dataset_id }}`.ga4_transaction_items_{{ $('Backfill Config').item.json.startDate.replaceAll('-', '') }} (\n  date DATE,\n  transactionId STRING,\n  itemName STRING,\n  itemPurchaseQuantity INT64,\n  itemRevenue FLOAT64\n);\n\n-- Insert data from the GA4 node into the newly created table.\nINSERT INTO `{{ $('Backfill Config').item.json.project_id }}`.`{{ $('Backfill Config').item.json.dataset_id }}`.ga4_transaction_items_{{ $('Backfill Config').item.json.startDate.replaceAll('-', '') }} (date, transactionId, itemName, itemPurchaseQuantity, itemRevenue)\nVALUES\n{{ $items()[0].json.rows.map(row => `(PARSE_DATE('%Y%m%d', '${row.dimensionValues[2].value}'), '${row.dimensionValues[0].value}', '${row.dimensionValues[1].value}', ${row.metricValues[0].value || 'NULL'}, ${row.metricValues[1].value || 'NULL'})`).join(',') }};\n",
        "options": {}
      },
      "id": "19e1ccc2-c0b5-4392-bea1-63241f053000",
      "name": "BQ - ga4_transaction_items",
      "type": "n8n-nodes-base.googleBigQuery",
      "position": [
        1600,
        5168
      ],
      "typeVersion": 2.1,
      "alwaysOutputData": false,
      "disabled": true,
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "e3e88ddb-e0de-4400-8de4-220fa8651d21",
              "name": "=GA4 Property ID",
              "type": "string",
              "value": "461978355"
            },
            {
              "id": "4c4ca0dd-c7dd-466c-8a8e-028da8377d49",
              "name": "project_id",
              "type": "string",
              "value": "sublime-flux-378608"
            },
            {
              "id": "f0b12ee2-88f1-4d47-af66-f9250dafab57",
              "name": "dataset_id",
              "type": "string",
              "value": "GA4"
            },
            {
              "id": "8a6d84bb-a106-403b-a34e-8e33a3a2910a",
              "name": "startDate",
              "type": "string",
              "value": "={{ DateTime.now().minus({ days: 2 }).toFormat('yyyy-MM-dd') }}"
            },
            {
              "id": "c3d4c4ea-f94a-4e40-8d85-f47e80942bf8",
              "name": "endDate",
              "type": "string",
              "value": "={{ DateTime.now().minus({ days: 2 }).toFormat('yyyy-MM-dd') }}"
            }
          ]
        },
        "options": {}
      },
      "id": "361cb7e3-ea48-43f1-a51d-d17084c8f791",
      "name": "Backfill Config",
      "type": "n8n-nodes-base.set",
      "position": [
        1104,
        6320
      ],
      "typeVersion": 3.4,
      "disabled": true
    },
    {
      "parameters": {
        "projectId": {
          "__rl": true,
          "mode": "id",
          "value": "={{ $('Backfill Config').item.json.project_id }}"
        },
        "sqlQuery": "-- Creates and populates a daily table for landing page performance metrics.\nCREATE OR REPLACE TABLE `{{ $('Backfill Config').item.json.project_id }}`.`{{ $('Backfill Config').item.json.dataset_id }}`.ga4_landing_page_data_{{ $('Backfill Config').item.json.startDate.replaceAll('-', '') }} (\n  date DATE,\n  landingPage STRING,\n  totalUsers INT64,\n  sessions INT64,\n  eventCount INT64,\n  ecommercePurchases INT64,\n  engagementRate FLOAT64,\n  purchaseRevenue FLOAT64\n);\n\n-- Insert data from the GA4 node.\nINSERT INTO `{{ $('Backfill Config').item.json.project_id }}`.`{{ $('Backfill Config').item.json.dataset_id }}`.ga4_landing_page_data_{{ $('Backfill Config').item.json.startDate.replaceAll('-', '') }} (date, landingPage, totalUsers, sessions, eventCount, ecommercePurchases, engagementRate, purchaseRevenue)\nVALUES\n{{ $items()[0].json.rows.map(row => `(PARSE_DATE('%Y%m%d', '${row.dimensionValues[0].value}'), '${row.dimensionValues[1].value}', ${row.metricValues[0].value || 'NULL'}, ${row.metricValues[1].value || 'NULL'}, ${row.metricValues[2].value || 'NULL'}, ${row.metricValues[3].value || 'NULL'}, ${row.metricValues[4].value || 'NULL'}, ${row.metricValues[5].value || 'NULL'})`).join(',') }};\n",
        "options": {
          "timeoutMs": 500000
        }
      },
      "id": "1cfc3053-45cf-47e2-8ff8-a31e94467028",
      "name": "BQ - ga4_landing_page_data",
      "type": "n8n-nodes-base.googleBigQuery",
      "position": [
        1712,
        7424
      ],
      "typeVersion": 2.1,
      "disabled": true,
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "numberInputs": 4
      },
      "id": "44e25914-a0c1-4000-9fce-d6d7f84a6c41",
      "name": "Merge1",
      "type": "n8n-nodes-base.merge",
      "position": [
        3312,
        6368
      ],
      "typeVersion": 3.2,
      "disabled": true
    },
    {
      "parameters": {
        "jsCode": "// This code processes the results from all BigQuery nodes and creates a summary message.\n\n// Statically define the names of the BigQuery nodes in the exact order they are connected to the Merge node(s).\nconst nodeNames = [\n  'BQ - ga4_transaction_items',\n  'BQ - ga4_data_session_channel_group',\n  'BQ - ga4_data_session_source_campaign_medium',\n  'BQ - ga4_data_country_language_city',\n  'BQ - ga4_data_item_name',\n  'BQ - ga4_data_browser_os_device',\n  'BQ - ga4_data_first_user_source_medium',\n  'BQ - ga4_data_first_user_channel_group',\n  'BQ - ga4_ads_data',\n  'BQ - ga4_all_metrics_data',\n  'BQ - ga4_event_metrics_data',\n  'BQ - ga4_page_location_data',\n  'BQ - ga4_landing_page_data'\n];\n\nconst successfulNodes = [];\nconst failedNodes = [];\n\n// Loop through all the input items from the previous nodes.\nfor (const [index, item] of $input.all().entries()) {\n  const nodeName = nodeNames[index] || `Unknown Node (Input ${index + 1})`;\n\n  if (item.json.error) {\n    // Escape underscores in the node name to prevent Markdown parsing errors\n    const escapedNodeName = nodeName.replace(/_/g, '\\\\_');\n    failedNodes.push(escapedNodeName);\n  } else {\n    successfulNodes.push(nodeName);\n  }\n}\n\n// Start building the message string with the success count.\nlet message = `GA4 to BigQuery Workflow Status: ${successfulNodes.length}/13 Successful ✅\\n\\n`;\n\n// Add a section for failed nodes only if there are any.\nif (failedNodes.length > 0) {\n  message += \"❌ **Failed Nodes:**\\n\" + failedNodes.join(\"\\n\");\n}\n\n// Return the final message to be used in the Telegram node.\nreturn [{ json: { message: message } }];"
      },
      "id": "4c90836b-1701-40d7-bcbc-292e385056f7",
      "name": "Code",
      "type": "n8n-nodes-base.code",
      "position": [
        3520,
        6368
      ],
      "typeVersion": 2,
      "disabled": true
    },
    {
      "parameters": {
        "chatId": "-1002962247686",
        "text": "={{ $json.message }}",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "id": "016f7ed5-574d-4784-b71a-d8d5745fbe71",
      "name": "Send a text message",
      "type": "n8n-nodes-base.telegram",
      "position": [
        3728,
        6368
      ],
      "webhookId": "7e66a7da-daa4-4c26-87d2-a4602d35889a",
      "typeVersion": 1.2,
      "disabled": true
    },
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "triggerAtMinute": 27
            }
          ]
        }
      },
      "id": "9c7bd144-28ed-4370-addc-afa5489ecf37",
      "name": "Schedule Trigger1",
      "type": "n8n-nodes-base.scheduleTrigger",
      "position": [
        928,
        6320
      ],
      "typeVersion": 1.2,
      "disabled": true
    },
    {
      "parameters": {
        "numberInputs": 10
      },
      "id": "6cd7377f-bb2c-482a-bd66-aa7c68fb0cb4",
      "name": "Merge2",
      "type": "n8n-nodes-base.merge",
      "position": [
        2832,
        6032
      ],
      "typeVersion": 3.2,
      "disabled": true
    },
    {
      "parameters": {
        "content": "# GOOGLE ANALYTICS",
        "height": 2624,
        "width": 3888,
        "color": 5
      },
      "id": "642b29c3-88ad-4fca-8a58-14929c9c2498",
      "name": "Sticky Note7",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        240,
        5040
      ],
      "typeVersion": 1,
      "disabled": true
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "version": 2,
                  "leftValue": "",
                  "caseSensitive": true,
                  "typeValidation": "strict"
                },
                "combinator": "and",
                "conditions": [
                  {
                    "id": "6890448a-74f3-497b-8996-0edc456ef140",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "leftValue": "={{ $json.command }}",
                    "rightValue": "list_accounts"
                  }
                ]
              },
              "renameOutput": true,
              "outputKey": "list_accounts"
            },
            {
              "conditions": {
                "options": {
                  "version": 2,
                  "leftValue": "",
                  "caseSensitive": true,
                  "typeValidation": "strict"
                },
                "combinator": "and",
                "conditions": [
                  {
                    "id": "e8c7ff7a-abae-4a60-996f-b57322c513f2",
                    "operator": {
                      "name": "filter.operator.equals",
                      "type": "string",
                      "operation": "equals"
                    },
                    "leftValue": "={{ $json.command }}",
                    "rightValue": "account"
                  }
                ]
              },
              "renameOutput": true,
              "outputKey": "account"
            },
            {
              "conditions": {
                "options": {
                  "version": 2,
                  "leftValue": "",
                  "caseSensitive": true,
                  "typeValidation": "strict"
                },
                "combinator": "and",
                "conditions": [
                  {
                    "id": "dc723584-5403-443b-b770-820f561e801b",
                    "operator": {
                      "name": "filter.operator.equals",
                      "type": "string",
                      "operation": "equals"
                    },
                    "leftValue": "={{ $json.command }}",
                    "rightValue": "list_ads"
                  }
                ]
              },
              "renameOutput": true,
              "outputKey": "list_ads"
            }
          ]
        },
        "options": {}
      },
      "id": "7384240b-f495-4da0-934b-b66c4cebc93d",
      "name": "Switch",
      "type": "n8n-nodes-base.switch",
      "position": [
        8096,
        3344
      ],
      "typeVersion": 3.2
    },
    {
      "parameters": {
        "graphApiVersion": "v23.0",
        "node": "me",
        "edge": "adaccounts",
        "options": {
          "fields": {
            "field": [
              {
                "name": "name"
              }
            ]
          }
        }
      },
      "id": "de07d82b-fa43-42f2-936d-a511adc1067a",
      "name": "graph: adaccounts",
      "type": "n8n-nodes-base.facebookGraphApi",
      "position": [
        8336,
        3120
      ],
      "typeVersion": 1,
      "credentials": {
        "facebookGraphApi": {
          "id": "qyqXK2BX1VsAfqgn",
          "name": "Facebook Graph account"
        }
      }
    },
    {
      "parameters": {
        "graphApiVersion": "v23.0",
        "node": "={{ $json.id }}",
        "edge": "campaigns",
        "options": {
          "fields": {
            "field": [
              {
                "name": "id,name,status"
              }
            ]
          },
          "queryParameters": {
            "parameter": [
              {
                "name": "effective_status",
                "value": "=[\"ACTIVE\"]"
              }
            ]
          }
        }
      },
      "id": "ac451408-1a2e-4944-8319-b145b0166963",
      "name": "account: campaigns",
      "type": "n8n-nodes-base.facebookGraphApi",
      "position": [
        8768,
        3088
      ],
      "typeVersion": 1,
      "credentials": {
        "facebookGraphApi": {
          "id": "qyqXK2BX1VsAfqgn",
          "name": "Facebook Graph account"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "graphApiVersion": "v23.0",
        "node": "={{ $json.id }}",
        "edge": "adsets",
        "options": {
          "fields": {
            "field": [
              {
                "name": "id,name,status,campaign"
              }
            ]
          },
          "queryParameters": {
            "parameter": [
              {
                "name": "effective_status",
                "value": "=[\"ACTIVE\"]"
              }
            ]
          }
        }
      },
      "id": "694a3d2b-3a38-4de0-a6d0-dfc5150da600",
      "name": "account: adsets",
      "type": "n8n-nodes-base.facebookGraphApi",
      "position": [
        8768,
        3248
      ],
      "typeVersion": 1,
      "credentials": {
        "facebookGraphApi": {
          "id": "qyqXK2BX1VsAfqgn",
          "name": "Facebook Graph account"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "graphApiVersion": "v23.0",
        "node": "={{ $json.id }}",
        "edge": "ads",
        "options": {
          "fields": {
            "field": [
              {
                "name": "id,name,status,campaign{id,name},adset{id,name}"
              }
            ]
          },
          "queryParameters": {
            "parameter": [
              {
                "name": "effective_status",
                "value": "=[\"ACTIVE\"]"
              }
            ]
          }
        }
      },
      "id": "7e11f470-76cb-4a6a-ab74-ed50e81a3cf5",
      "name": "account: ads",
      "type": "n8n-nodes-base.facebookGraphApi",
      "position": [
        8768,
        3408
      ],
      "typeVersion": 1,
      "credentials": {
        "facebookGraphApi": {
          "id": "qyqXK2BX1VsAfqgn",
          "name": "Facebook Graph account"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "481319e1-d562-415d-aa04-4063421bc9b1",
              "name": "id",
              "type": "string",
              "value": "={{ $json.id.startsWith('act') ? $json.id : 'act_'+$json.id }}"
            }
          ]
        },
        "includeOtherFields": true,
        "options": {}
      },
      "id": "8fd89434-56ca-41a4-8d0d-9614961f22ca",
      "name": "Edit Fields",
      "type": "n8n-nodes-base.set",
      "position": [
        8352,
        3760
      ],
      "typeVersion": 3.4
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "ff699971-c2bb-4e24-96c1-a246cdd3f87b",
              "name": "since",
              "type": "string",
              "value": "={{ $json.since ?? $today.startOf('month') }}"
            },
            {
              "id": "76e8ddf3-e35c-4f4a-bcd6-db751d4443e2",
              "name": "until",
              "type": "string",
              "value": "={{ $json.until ?? $today.endOf('month') }}"
            }
          ]
        },
        "includeOtherFields": true,
        "options": {}
      },
      "id": "8f811b08-4f7e-46c5-a550-da74bf0b0458",
      "name": "since, until",
      "type": "n8n-nodes-base.set",
      "position": [
        7872,
        3360
      ],
      "typeVersion": 3.4
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "481319e1-d562-415d-aa04-4063421bc9b1",
              "name": "id",
              "type": "string",
              "value": "={{ $json.id.startsWith('act') ? $json.id : 'act_'+$json.id }}"
            }
          ]
        },
        "includeOtherFields": true,
        "options": {}
      },
      "id": "340828c0-003a-428f-8fb8-a007adf871be",
      "name": "fix missing act_",
      "type": "n8n-nodes-base.set",
      "position": [
        8320,
        3360
      ],
      "typeVersion": 3.4
    },
    {
      "parameters": {
        "graphApiVersion": "v23.0",
        "node": "={{ $json.id }}",
        "edge": "insights",
        "options": {
          "fields": {
            "field": [
              {
                "name": "attribution_setting,conversion_values,conversions,cost_per_conversion,cpc,cpm,ctr,frequency,impressions,inline_post_engagement,purchase_roas,reach,result_rate,results,spend"
              }
            ]
          },
          "queryParameters": {
            "parameter": [
              {
                "name": "time_range[since]",
                "value": "={{ $json.since.replace(/T.*/,'') }}"
              },
              {
                "name": "time_range[until]",
                "value": "={{ $json.until.replace(/T.*/,'') }}"
              }
            ]
          }
        }
      },
      "id": "da04382a-a3b6-4d14-b49d-98249a4da70d",
      "name": "account insights",
      "type": "n8n-nodes-base.facebookGraphApi",
      "position": [
        8768,
        3584
      ],
      "typeVersion": 1,
      "credentials": {
        "facebookGraphApi": {
          "id": "qyqXK2BX1VsAfqgn",
          "name": "Facebook Graph account"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "graphApiVersion": "v23.0",
        "node": "={{ $json.id }}",
        "edge": "=",
        "options": {
          "fields": {
            "field": [
              {
                "name": "=ads{id,status,name,insights{clicks,impressions,purchase_roas,conversion_values,conversions},campaign{id,name},adset{id,name}}"
              }
            ]
          },
          "queryParameters": {
            "parameter": [
              {
                "name": "effective_status",
                "value": "=[\"ACTIVE\"]"
              }
            ]
          }
        }
      },
      "id": "85f96386-a4a2-47a6-95f5-7b64627ee179",
      "name": "ads: insights",
      "type": "n8n-nodes-base.facebookGraphApi",
      "position": [
        8768,
        3776
      ],
      "typeVersion": 1,
      "credentials": {
        "facebookGraphApi": {
          "id": "qyqXK2BX1VsAfqgn",
          "name": "Facebook Graph account"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "mode": "runOnceForEachItem",
        "jsCode": "return {\n  ads:   $('ads: insights').item.json.ads.data,\n}"
      },
      "id": "2c149c40-a63f-4e6a-b994-a8f52969735f",
      "name": "Code1",
      "type": "n8n-nodes-base.code",
      "position": [
        8992,
        3776
      ],
      "typeVersion": 2
    },
    {
      "parameters": {
        "mode": "combine",
        "combineBy": "combineByPosition",
        "numberInputs": 4,
        "options": {
          "includeUnpaired": true
        }
      },
      "id": "5d8656fc-8f4f-4034-9934-eb26135ad34c",
      "name": "Merge3",
      "type": "n8n-nodes-base.merge",
      "position": [
        9408,
        3296
      ],
      "typeVersion": 3.2
    },
    {
      "parameters": {
        "mode": "runOnceForEachItem",
        "jsCode": "return {\n  campaigns: $('account: campaigns').item.json.data,\n  adsets: $('account: adsets').item.json.data,\n  ads:   $('account: ads').item.json.data,\n  account_insights: $('account insights').item.json.data\n}"
      },
      "id": "fae8b2a0-ab08-4d4d-aa23-cc9722847994",
      "name": "Code2",
      "type": "n8n-nodes-base.code",
      "position": [
        9616,
        3344
      ],
      "typeVersion": 2
    },
    {
      "parameters": {
        "content": "# FB ANALYTICS",
        "height": 896,
        "width": 2912,
        "color": 5
      },
      "id": "be8e8623-c430-4858-94c9-31305dc3029a",
      "name": "Sticky Note8",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        864,
        2000
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "path": "google-ads-tool-mcp"
      },
      "id": "d79a5ac0-cf9b-40e0-930d-2b41f81b9163",
      "name": "Google Ads Tool MCP Server",
      "type": "@n8n/n8n-nodes-langchain.mcpTrigger",
      "position": [
        3632,
        4272
      ],
      "webhookId": "b36a71b8-41e4-4fcc-a1f0-30a95be8f641",
      "typeVersion": 1,
      "disabled": true
    },
    {
      "parameters": {
        "campaigsNotice": "={{ $fromAI('Campaigs_Notice', ``, 'string') }}",
        "managerCustomerId": "={{ $fromAI('Manager_Customer_Id', ``, 'string') }}",
        "clientCustomerId": "={{ $fromAI('Client_Customer_Id', ``, 'string') }}",
        "additionalOptions": {},
        "requestOptions": {}
      },
      "id": "fe47d09e-e85f-4dca-a30d-603408ed24be",
      "name": "Get many campaigns",
      "type": "n8n-nodes-base.googleAdsTool",
      "position": [
        3488,
        4320
      ],
      "typeVersion": 1,
      "credentials": {
        "googleAdsOAuth2Api": {
          "id": "sbvx00Y9bJ3MrIbd",
          "name": "Google Ads account"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "operation": "get",
        "campaigsNotice": "={{ $fromAI('Campaigs_Notice', ``, 'string') }}",
        "managerCustomerId": "={{ $fromAI('Manager_Customer_Id', ``, 'string') }}",
        "clientCustomerId": "={{ $fromAI('Client_Customer_Id', ``, 'string') }}",
        "campaignId": "={{ $fromAI('Campaign_Id', ``, 'string') }}",
        "requestOptions": {}
      },
      "id": "ece471dc-83d4-4960-87e4-3dbbd89058b6",
      "name": "Get a campaign",
      "type": "n8n-nodes-base.googleAdsTool",
      "position": [
        3504,
        4480
      ],
      "typeVersion": 1,
      "credentials": {
        "googleAdsOAuth2Api": {
          "id": "sbvx00Y9bJ3MrIbd",
          "name": "Google Ads account"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "content": "# GOOGLE ADS MCP",
        "height": 752,
        "width": 768,
        "color": 4
      },
      "id": "c3d332a6-66c6-42e8-9a06-a57f43924aff",
      "name": "Sticky Note9",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        3264,
        4128
      ],
      "typeVersion": 1,
      "disabled": true
    },
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "cronExpression",
              "expression": "0 0 1 * *"
            }
          ]
        }
      },
      "id": "cff12b3d-70cb-4f81-8ef7-12345116fe83",
      "name": "Monthly Trigger",
      "type": "n8n-nodes-base.scheduleTrigger",
      "position": [
        4320,
        4320
      ],
      "typeVersion": 1,
      "disabled": true,
      "notes": "Runs 1st of every month to analyze last 30 days"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://googleads.googleapis.com/{{$env.GOOGLE_ADS_API_VERSION}}/customers/{{$env.GOOGLE_ADS_CUSTOMER_ID}}/googleAds:search",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "googleAdsOAuth2Api",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\"query\": \"SELECT ad_group_ad.ad.id, ad_group_ad.ad.responsive_search_ad.headlines, ad_group.name, metrics.impressions, metrics.clicks, metrics.ctr FROM ad_group_ad WHERE segments.date DURING LAST_30_DAYS AND metrics.impressions > 100 ORDER BY metrics.clicks DESC LIMIT 1000\"}",
        "options": {}
      },
      "id": "8520f2c4-a4a9-4785-8900-3eb30a30d097",
      "name": "Get Performance Data",
      "type": "n8n-nodes-base.httpRequest",
      "position": [
        4592,
        4320
      ],
      "typeVersion": 4.2,
      "disabled": true,
      "notes": "Gets 30-day performance data via GAQL. Min 100 impressions for statistical validity."
    },
    {
      "parameters": {
        "jsCode": "// Format performance data for AI analysis\n\nconst response = $input.first().json;\nconst results = response.results || [];\n\n// Group by category (ad group) and extract headlines\nconst categoryData = {};\nconst themeData = {};\n\nresults.forEach(result => {\n  const category = result.adGroup?.name || 'Unknown';\n  const headlines = result.adGroupAd?.ad?.responsiveSearchAd?.headlines || [];\n  const headline = headlines[0]?.text || '';\n  const ctr = parseFloat(result.metrics?.ctr || 0);\n  const impressions = parseInt(result.metrics?.impressions || 0);\n  const clicks = parseInt(result.metrics?.clicks || 0);\n  \n  if (impressions < 100) return;\n  \n  // Aggregate by category\n  if (!categoryData[category]) {\n    categoryData[category] = {impressions: 0, clicks: 0, ads: []};\n  }\n  categoryData[category].impressions += impressions;\n  categoryData[category].clicks += clicks;\n  categoryData[category].ads.push({headline, ctr, impressions, clicks});\n  \n  // Track themes\n  const themes = ['vegan', 'organic', 'natural', 'premium', 'sale', 'new', 'free shipping'];\n  themes.forEach(theme => {\n    if (headline.toLowerCase().includes(theme)) {\n      if (!themeData[theme]) {\n        themeData[theme] = {impressions: 0, clicks: 0, count: 0};\n      }\n      themeData[theme].impressions += impressions;\n      themeData[theme].clicks += clicks;\n      themeData[theme].count += 1;\n    }\n  });\n});\n\n// Calculate CTRs\nconst categoryAnalysis = Object.entries(categoryData).map(([cat, data]) => ({\n  category: cat,\n  ctr: ((data.clicks / data.impressions) * 100).toFixed(2),\n  total_impressions: data.impressions,\n  total_clicks: data.clicks,\n  ad_count: data.ads.length\n})).sort((a, b) => parseFloat(b.ctr) - parseFloat(a.ctr));\n\nconst themeAnalysis = Object.entries(themeData).map(([theme, data]) => ({\n  theme,\n  ctr: ((data.clicks / data.impressions) * 100).toFixed(2),\n  total_impressions: data.impressions,\n  ad_count: data.count\n})).sort((a, b) => parseFloat(b.ctr) - parseFloat(a.ctr));\n\nreturn {\n  total_ads_analyzed: results.length,\n  date_range: 'Last 30 days',\n  top_categories: categoryAnalysis.slice(0, 5),\n  bottom_categories: categoryAnalysis.slice(-5),\n  top_themes: themeAnalysis.slice(0, 5),\n  bottom_themes: themeAnalysis.slice(-5),\n  analysis_prompt: `Analyze this Google Ads performance data and provide actionable insights:\\n\\nTop Performing Categories:\\n${JSON.stringify(categoryAnalysis.slice(0, 5), null, 2)}\\n\\nBottom Performing Categories:\\n${JSON.stringify(categoryAnalysis.slice(-5), null, 2)}\\n\\nTop Performing Themes:\\n${JSON.stringify(themeAnalysis.slice(0, 5), null, 2)}\\n\\nBottom Performing Themes:\\n${JSON.stringify(themeAnalysis.slice(-5), null, 2)}\\n\\nProvide 3-5 specific recommendations for improving ad copy. Include estimated impact percentages. Format as: {'recommendations': [{'action': '...', 'expected_impact': '...', 'priority': 'HIGH/MEDIUM/LOW'}]}`\n};"
      },
      "id": "04bca55b-93c1-4699-b614-064f1bef9b1b",
      "name": "Prepare Performance Data",
      "type": "n8n-nodes-base.code",
      "position": [
        4976,
        4320
      ],
      "typeVersion": 2,
      "disabled": true,
      "notes": "Analyzes performance data, groups by category/theme, calculates CTRs, formats for AI"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{$json.analysis_prompt}}",
        "options": {
          "systemMessage": "You are a Google Ads performance analyst. Analyze the data and provide specific, actionable recommendations. Return valid JSON only."
        }
      },
      "id": "3fe6bdec-0b6a-4dcf-89ea-d8cdac7cb390",
      "name": "AI Agent - Analyze Performance",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "position": [
        5264,
        4320
      ],
      "typeVersion": 1.7,
      "disabled": true,
      "notes": "n8n AI Agent analyzes patterns and provides insights"
    },
    {
      "parameters": {
        "jsCode": "// Parse AI recommendations and create report\n\nconst aiOutput = $input.first().json.output;\nconst performanceData = $node['Prepare Performance Data'].json;\n\n// Parse JSON from AI\nlet recommendations;\ntry {\n  const jsonMatch = aiOutput.match(/```json\\s*([\\s\\S]*?)```/) || aiOutput.match(/{[\\s\\S]*}/);\n  recommendations = JSON.parse(jsonMatch ? jsonMatch[1] || jsonMatch[0] : aiOutput);\n} catch (e) {\n  recommendations = {recommendations: [{action: aiOutput, priority: 'HIGH'}]};\n}\n\nconst report = `# 30-Day Performance Analysis Report\n\n## Executive Summary\nAnalyzed: ${performanceData.total_ads_analyzed} ads\nPeriod: ${performanceData.date_range}\nDate: ${new Date().toISOString().split('T')[0]}\n\n## Top Performing Categories\n${performanceData.top_categories.map(c => `- ${c.category}: ${c.ctr}% CTR (${c.ad_count} ads)`).join('\\n')}\n\n## Top Performing Themes\n${performanceData.top_themes.map(t => `- \"${t.theme}\" messaging: ${t.ctr}% CTR (${t.ad_count} ads)`).join('\\n')}\n\n## AI-Powered Recommendations\n${recommendations.recommendations?.map((r, i) => `${i+1}. [${r.priority}] ${r.action}\\n   Expected Impact: ${r.expected_impact || 'TBD'}`).join('\\n\\n')}\n\n## Next Steps\n1. Update ad copy to emphasize top-performing themes\n2. A/B test recommendations\n3. Review again in 30 days\n\n---\nGenerated by n8n AI Agent + OpenAI\n`;\n\nreturn {\n  report_markdown: report,\n  recommendations: recommendations.recommendations || [],\n  top_themes: performanceData.top_themes,\n  generated_at: new Date().toISOString()\n};"
      },
      "id": "9eb2cb35-2134-4e80-9d0e-64ec64a82ee7",
      "name": "Generate Report",
      "type": "n8n-nodes-base.code",
      "position": [
        5712,
        4320
      ],
      "typeVersion": 2,
      "disabled": true,
      "notes": "Creates formatted report with AI insights"
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "mode": "id",
          "value": "={{$env.GOOGLE_SHEET_ID}}"
        },
        "sheetName": {
          "__rl": true,
          "mode": "name",
          "value": "Performance Reports"
        },
        "options": {}
      },
      "id": "d76b0624-c0e0-4c5a-ac2c-b773a56e9a19",
      "name": "Save Report to Sheets",
      "type": "n8n-nodes-base.googleSheets",
      "position": [
        5952,
        4320
      ],
      "typeVersion": 4.4,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "n1lRTD7tyH1UVxfn",
          "name": "Google Sheets-macaipiotr@gmail.com"
        }
      },
      "disabled": true,
      "notes": "Archives report in Google Sheets"
    },
    {
      "parameters": {
        "text": "={{$json.report_markdown}}",
        "otherOptions": {}
      },
      "id": "797b6025-425a-4e7a-97b1-5202053e01bb",
      "name": "Send Report",
      "type": "n8n-nodes-base.slack",
      "position": [
        6176,
        4320
      ],
      "webhookId": "cb69a0fc-d86c-4011-b4f8-0c8435b8f57b",
      "typeVersion": 2.1,
      "disabled": true,
      "notes": "Sends report to team via Slack"
    },
    {
      "parameters": {
        "model": "gpt-4o",
        "options": {
          "maxTokens": 2000,
          "temperature": 0.2
        }
      },
      "id": "638d02b5-fec1-405b-a672-f5d907af4093",
      "name": "OpenAI Chat Model2",
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "position": [
        5232,
        4496
      ],
      "typeVersion": 1,
      "credentials": {
        "openAiApi": {
          "id": "8zt0lkXSJzfIV1lh",
          "name": "OpenAi account"
        }
      },
      "disabled": true,
      "notes": "Lower temperature (0.2) for analytical tasks"
    },
    {
      "parameters": {
        "content": "## 🟨 2 “Get Performance Data”\n\n📊 Fetches ad metrics\nQueries Google Ads API for CTR, clicks, and impressions using GAQL.\nFilters out ads with fewer than 100 impressions for accurate analysis.",
        "height": 604,
        "width": 2216
      },
      "id": "b04e30ed-e28c-4105-880c-8b60d46de7f6",
      "name": "Sticky Note11",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        4224,
        4144
      ],
      "typeVersion": 1,
      "disabled": true
    },
    {
      "parameters": {
        "operation": "get",
        "requestOptions": {}
      },
      "type": "n8n-nodes-base.googleAds",
      "typeVersion": 1,
      "position": [
        1376,
        1456
      ],
      "id": "c273efbf-d7a2-421a-ad9b-620cdcbe5d4a",
      "name": "Get a campaign1",
      "credentials": {
        "googleAdsOAuth2Api": {
          "id": "sbvx00Y9bJ3MrIbd",
          "name": "Google Ads account"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        576,
        1440
      ],
      "id": "be70e36b-c7dc-42d3-ab5b-a7f6b97028fc",
      "name": "Edit Fields1"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        2800,
        1600
      ],
      "id": "ba6909cc-1ada-440c-b7f5-2c9202af58d0",
      "name": "Google Gemini Chat Model1",
      "credentials": {
        "googlePalmApi": {
          "id": "OAc1dXJytNwb1o7V",
          "name": "GoogleApi2"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        1856,
        1168
      ],
      "id": "6255f507-ba96-45b5-bcf2-77adc6524ae0",
      "name": "Google Gemini Chat Model2",
      "credentials": {
        "googlePalmApi": {
          "id": "OAc1dXJytNwb1o7V",
          "name": "GoogleApi2"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Please analyze the following data and output the results in table form:\n\n| Metric | Last 7 Days | Previous Year | Percentage Change |\n|--------|-------------|---------------|-------------------|\n| Total Impressions | {{$json.current_impressions}} | {{$json.previous_impressions}} | Percentage Change |\n| CPM | {{$json.current_cpm}} | {{$json.previous_cpm}} | Percentage Change |\n| Total Clicks | {{$json.current_clicks}} | {{$json.previous_clicks}} | Percentage Change |\n| CTR | {{$json.current_ctr}} | {{$json.previous_ctr}} | Percentage Change |\n| Conversions | {{$json.current_conversions}} | {{$json.previous_conversions}} | Percentage Change |\n| Cost per Conversion | {{$json.current_cost_per_conversion}} | {{$json.previous_cost_per_conversion}} | Percentage Change |\n| ROAS | {{ $json.current_roas }} | {{ $json.previous_roas }} | Percentage Change |\n| Costs | {{$json.current_cost}} | {{$json.previous_cost}} | Percentage Change |\n\nNumber format:\n- Period (.) for thousands (e.g. 4.000)\n- Comma (,) for decimal numbers (e.g. 3,4)\n- Display CPM, Cost per Conversion, ROAS and Costs in €\n- CTR in percent\n\nPlease write a brief summary of the analyzed data above the table (in max 3 sentences!)\n\nIMPORTANT:\nWrite nothing except the summary and the table below it!\nNO INTRODUCTION, NO CONCLUSION!",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3,
      "position": [
        -464,
        4416
      ],
      "id": "26fcc452-798e-4cf9-adda-66bce8789820",
      "name": "AI Agent5",
      "disabled": true
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        -400,
        4624
      ],
      "id": "76dfe151-2a24-4a8b-a9b2-e4c9d89106b9",
      "name": "Google Gemini Chat Model3",
      "credentials": {
        "googlePalmApi": {
          "id": "OAc1dXJytNwb1o7V",
          "name": "GoogleApi2"
        }
      },
      "disabled": true
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        9872,
        3360
      ],
      "id": "bd971575-98f3-428a-b544-65636f5c3313",
      "name": "Merge4"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Please analyze the following data and output the results in table form:\n\n| Metric | Last 7 Days | Previous Year | Percentage Change |\n|--------|-------------|---------------|-------------------|\n| Total Impressions | {{$json.current_impressions}} | {{$json.previous_impressions}} | Percentage Change |\n| CPM | {{$json.current_cpm}} | {{$json.previous_cpm}} | Percentage Change |\n| Total Clicks | {{$json.current_clicks}} | {{$json.previous_clicks}} | Percentage Change |\n| CTR | {{$json.current_ctr}} | {{$json.previous_ctr}} | Percentage Change |\n| Conversions | {{$json.current_conversions}} | {{$json.previous_conversions}} | Percentage Change |\n| Cost per Conversion | {{$json.current_cost_per_conversion}} | {{$json.previous_cost_per_conversion}} | Percentage Change |\n| ROAS | {{ $json.current_roas }} | {{ $json.previous_roas }} | Percentage Change |\n| Costs | {{$json.current_cost}} | {{$json.previous_cost}} | Percentage Change |\n\nNumber format:\n- Period (.) for thousands (e.g. 4.000)\n- Comma (,) for decimal numbers (e.g. 3,4)\n- Display CPM, Cost per Conversion, ROAS and Costs in €\n- CTR in percent\n\nPlease write a brief summary of the analyzed data above the table (in max 3 sentences!)\n\nIMPORTANT:\nWrite nothing except the summary and the table below it!\nNO INTRODUCTION, NO CONCLUSION!",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3,
      "position": [
        10128,
        3360
      ],
      "id": "8b2592b5-a68c-4fbc-b86d-60784e674bb3",
      "name": "AI Agent6"
    },
    {
      "parameters": {
        "rule": {
          "interval": [
            {}
          ]
        }
      },
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.3,
      "position": [
        -2832,
        2944
      ],
      "id": "d609240e-7a2e-4b97-b8fa-59b8f0f43bc4",
      "name": "Schedule Trigger2",
      "disabled": true
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "ff699971-c2bb-4e24-96c1-a246cdd3f87b",
              "name": "since",
              "type": "string",
              "value": "={{ $json.since ?? $today.startOf('month') }}"
            },
            {
              "id": "76e8ddf3-e35c-4f4a-bcd6-db751d4443e2",
              "name": "until",
              "type": "string",
              "value": "={{ $json.until ?? $today.endOf('month') }}"
            }
          ]
        },
        "includeOtherFields": true,
        "options": {}
      },
      "id": "a916014c-4f9d-4297-b9fc-4c0e71e375d3",
      "name": "since, until1",
      "type": "n8n-nodes-base.set",
      "position": [
        -2704,
        3168
      ],
      "typeVersion": 3.4,
      "disabled": true
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "fd29fa87-cbba-4ea5-ae76-89962d5e1ade",
              "name": "account_id",
              "value": "act_766708849771578",
              "type": "string"
            },
            {
              "id": "045f62b9-8962-4d9b-b261-029c23f84f56",
              "name": "campaign_id",
              "value": "",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -2560,
        2944
      ],
      "id": "8cd5f3a4-dc27-47a5-ad46-2bdc6bf228cd",
      "name": "SetMetaIDs"
    },
    {
      "parameters": {
        "graphApiVersion": "v23.0",
        "node": "={{ $json.account_id }}",
        "edge": "campaigns",
        "options": {
          "fields": {
            "field": [
              {
                "name": "id,name,status,objective"
              }
            ]
          },
          "queryParameters": {
            "parameter": [
              {
                "name": "effective_status",
                "value": "=[\"ACTIVE\"]"
              }
            ]
          }
        }
      },
      "id": "58855e11-052c-4f32-ba72-4f2afb152c07",
      "name": "MetaGraphAPI",
      "type": "n8n-nodes-base.facebookGraphApi",
      "position": [
        -2320,
        2944
      ],
      "typeVersion": 1,
      "credentials": {
        "facebookGraphApi": {
          "id": "qyqXK2BX1VsAfqgn",
          "name": "Facebook Graph account"
        }
      }
    },
    {
      "parameters": {
        "graphApiVersion": "v23.0",
        "node": "={{ $('SetMetaIDs').item.json.campaign_id }}",
        "edge": "ads",
        "options": {
          "fields": {
            "field": [
              {
                "name": "id,name,status,campaign_id,adset_id"
              }
            ]
          },
          "queryParameters": {
            "parameter": [
              {
                "name": "effective_status",
                "value": "=[\"ACTIVE\"]"
              }
            ]
          }
        }
      },
      "id": "380473f8-75ea-48f9-a956-9f6810119147",
      "name": "meta_Ad",
      "type": "n8n-nodes-base.facebookGraphApi",
      "position": [
        -2048,
        3312
      ],
      "typeVersion": 1,
      "credentials": {
        "facebookGraphApi": {
          "id": "qyqXK2BX1VsAfqgn",
          "name": "Facebook Graph account"
        }
      }
    },
    {
      "parameters": {
        "graphApiVersion": "v23.0",
        "node": "={{ $('SetMetaIDs').item.json.campaign_id }}",
        "edge": "ads",
        "options": {
          "fields": {
            "field": [
              {
                "name": "campaign_id, campaign_name, impressions, clicks, cpc, cpm, ctr, conversions, conversion_values, cost_per_conversion, purchase_roas"
              }
            ]
          },
          "queryParameters": {
            "parameter": [
              {
                "name": "effective_status",
                "value": "=[\"ACTIVE\"]"
              }
            ]
          }
        }
      },
      "id": "da9ef871-6420-4900-9992-d0c6b89aeb62",
      "name": "meta_campaign",
      "type": "n8n-nodes-base.facebookGraphApi",
      "position": [
        -2048,
        2944
      ],
      "typeVersion": 1,
      "credentials": {
        "facebookGraphApi": {
          "id": "qyqXK2BX1VsAfqgn",
          "name": "Facebook Graph account"
        }
      }
    },
    {
      "parameters": {
        "graphApiVersion": "v23.0",
        "node": "={{ $('SetMetaIDs').item.json.campaign_id }}",
        "edge": "adsets",
        "options": {
          "fields": {
            "field": [
              {
                "name": "id,name,status,campaign_id"
              }
            ]
          },
          "queryParameters": {
            "parameter": [
              {
                "name": "effective_status",
                "value": "=[\"ACTIVE\"]"
              }
            ]
          }
        }
      },
      "id": "ccbaa75c-0c2f-4cf7-98c9-c0603091aa29",
      "name": "meta_adSets",
      "type": "n8n-nodes-base.facebookGraphApi",
      "position": [
        -2048,
        3120
      ],
      "typeVersion": 1,
      "credentials": {
        "facebookGraphApi": {
          "id": "qyqXK2BX1VsAfqgn",
          "name": "Facebook Graph account"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        9728,
        3920
      ],
      "id": "a0635b15-e314-4435-aabe-78ff2b983e20",
      "name": "Google Gemini Chat Model4",
      "credentials": {
        "googlePalmApi": {
          "id": "OAc1dXJytNwb1o7V",
          "name": "GoogleApi2"
        }
      }
    },
    {
      "parameters": {},
      "id": "868ab339-1f3b-46b5-9de6-9d73694a4dd8",
      "name": "Calculator2",
      "type": "@n8n/n8n-nodes-langchain.toolCalculator",
      "position": [
        10096,
        3712
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "operation": "getAll"
      },
      "id": "e2fd1fbb-1d1a-42c6-b3ed-8707bda4b80c",
      "name": "Google Analytics Data",
      "type": "n8n-nodes-base.googleAnalytics",
      "typeVersion": 2,
      "position": [
        1408,
        4128
      ],
      "notes": "SETUP: Replace propertyId with your GA4 Property ID (e.g., '123456789')"
    },
    {
      "parameters": {
        "additionalOptions": {},
        "requestOptions": {}
      },
      "id": "e063530f-7f89-47dd-b04c-4bf569eb3627",
      "name": "Google Ads Data",
      "type": "n8n-nodes-base.googleAds",
      "typeVersion": 1,
      "position": [
        1408,
        4256
      ],
      "credentials": {
        "googleAdsOAuth2Api": {
          "id": "sbvx00Y9bJ3MrIbd",
          "name": "Google Ads account"
        }
      },
      "notes": "SETUP: Configure Google Ads OAuth2 credentials with your Customer ID"
    },
    {
      "parameters": {
        "url": "=https://graph.facebook.com/v18.0/act_YOUR_AD_ACCOUNT_ID/insights",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "facebookGraphApi",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "fields",
              "value": "impressions,clicks,ctr,spend,cpc,conversions,cost_per_conversion"
            },
            {
              "name": "time_range",
              "value": "={{ JSON.stringify({since: $now.minus({ days: 7 }).toFormat('yyyy-MM-dd'), until: $now.minus({ days: 1 }).toFormat('yyyy-MM-dd')}) }}"
            },
            {
              "name": "level",
              "value": "account"
            }
          ]
        },
        "options": {}
      },
      "id": "67e28e0b-156e-461e-8bcf-3102a071ec88",
      "name": "Facebook Ads Data",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [
        1408,
        4368
      ],
      "notes": "SETUP: Replace 'act_YOUR_AD_ACCOUNT_ID' with your actual Ad Account ID (format: act_1234567890)"
    },
    {
      "parameters": {
        "url": "=https://graph.facebook.com/v18.0/YOUR_PAGE_ID/insights",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "facebookGraphApi",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "metric",
              "value": "page_impressions,page_engaged_users,page_post_engagements,page_fans"
            },
            {
              "name": "period",
              "value": "week"
            },
            {
              "name": "since",
              "value": "={{ $now.minus({ days: 7 }).toFormat('yyyy-MM-dd') }}"
            },
            {
              "name": "until",
              "value": "={{ $now.minus({ days: 1 }).toFormat('yyyy-MM-dd') }}"
            }
          ]
        },
        "options": {}
      },
      "id": "400336b3-90d2-4ac6-826a-a4b81731adf8",
      "name": "Facebook Page Engagement",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [
        1408,
        4496
      ],
      "notes": "SETUP: Replace 'YOUR_PAGE_ID' with your Facebook Page ID (numeric)"
    },
    {
      "parameters": {
        "jsCode": "// Extract and format all data\nconst gaData = $('Google Analytics Data').first().json;\nconst googleAdsData = $('Google Ads Data').first().json;\nconst fbAdsData = $('Facebook Ads Data').first().json.data?.[0] || {};\nconst fbPageData = $('Facebook Page Engagement').first().json.data || [];\n\n// Helper function to format numbers\nconst formatNumber = (num) => {\n  if (!num) return '0';\n  return Math.round(num).toLocaleString();\n};\n\nconst formatCurrency = (num) => {\n  if (!num) return '$0.00';\n  return '$' + parseFloat(num).toFixed(2);\n};\n\nconst formatPercent = (num) => {\n  if (!num) return '0%';\n  return (parseFloat(num) * 100).toFixed(2) + '%';\n};\n\n// Calculate date range\nconst endDate = new Date();\nendDate.setDate(endDate.getDate() - 1);\nconst startDate = new Date();\nstartDate.setDate(startDate.getDate() - 7);\n\nconst dateRange = `${startDate.toLocaleDateString()} - ${endDate.toLocaleDateString()}`;\n\n// Build report\nconst report = `\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\n         📊 WEEKLY MARKETING PERFORMANCE REPORT\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\n\n📅 Report Period: ${dateRange}\n\n\n╔═══════════════════════════════════════════════════════╗\n║              🌐 GOOGLE ANALYTICS (GA4)                ║\n╚═══════════════════════════════════════════════════════╝\n\n  👥 Users:\n     • Total Users:        ${formatNumber(gaData.totalUsers)}\n     • New Users:          ${formatNumber(gaData.newUsers)}\n     • Returning Users:    ${formatNumber(gaData.totalUsers - gaData.newUsers)}\n\n  📈 Engagement:\n     • Sessions:           ${formatNumber(gaData.sessions)}\n     • Engagement Rate:    ${formatPercent(gaData.engagementRate)}\n     • Bounce Rate:        ${formatPercent(gaData.bounceRate)}\n\n  🎯 Conversions:         ${formatNumber(gaData.conversions || 0)}\n\n\n╔═══════════════════════════════════════════════════════╗\n║                 💰 GOOGLE ADS                         ║\n╚═══════════════════════════════════════════════════════╝\n\n  📢 Reach & Engagement:\n     • Impressions:        ${formatNumber(googleAdsData.impressions)}\n     • Clicks:             ${formatNumber(googleAdsData.clicks)}\n     • CTR:                ${formatPercent(googleAdsData.ctr)}\n\n  💵 Costs:\n     • Total Spend:        ${formatCurrency(googleAdsData.cost)}\n     • Avg CPC:            ${formatCurrency(googleAdsData.averageCpc)}\n\n  🎯 Performance:\n     • Conversions:        ${formatNumber(googleAdsData.conversions)}\n     • Cost/Conversion:    ${formatCurrency(googleAdsData.costPerConversion)}\n\n\n╔═══════════════════════════════════════════════════════╗\n║              📱 FACEBOOK/META ADS                     ║\n╚═══════════════════════════════════════════════════════╝\n\n  📢 Reach & Engagement:\n     • Impressions:        ${formatNumber(fbAdsData.impressions)}\n     • Clicks:             ${formatNumber(fbAdsData.clicks)}\n     • CTR:                ${formatPercent(fbAdsData.ctr)}\n\n  💵 Costs:\n     • Total Spend:        ${formatCurrency(fbAdsData.spend)}\n     • Avg CPC:            ${formatCurrency(fbAdsData.cpc)}\n\n  🎯 Performance:\n     • Conversions:        ${formatNumber(fbAdsData.conversions || 0)}\n     • Cost/Conversion:    ${formatCurrency(fbAdsData.cost_per_conversion || 0)}\n\n\n╔═══════════════════════════════════════════════════════╗\n║         👥 FACEBOOK PAGE (ORGANIC)                    ║\n╚═══════════════════════════════════════════════════════╝\n\n  📊 Organic Reach:\n     • Page Impressions:   ${formatNumber(fbPageData.find(m => m.name === 'page_impressions')?.values?.[0]?.value || 0)}\n     • Engaged Users:      ${formatNumber(fbPageData.find(m => m.name === 'page_engaged_users')?.values?.[0]?.value || 0)}\n     • Post Engagements:   ${formatNumber(fbPageData.find(m => m.name === 'page_post_engagements')?.values?.[0]?.value || 0)}\n\n  🌟 Growth:\n     • Total Followers:    ${formatNumber(fbPageData.find(m => m.name === 'page_fans')?.values?.[0]?.value || 0)}\n\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\n\n📌 KEY INSIGHTS:\n\n• Total Paid Ad Spend: ${formatCurrency((parseFloat(googleAdsData.cost || 0) + parseFloat(fbAdsData.spend || 0)))}\n• Combined Conversions: ${formatNumber((googleAdsData.conversions || 0) + (fbAdsData.conversions || 0))}\n• Website Sessions: ${formatNumber(gaData.sessions)}\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\n\n🤖 Auto-generated by N8N Marketing Analytics Workflow\n   Generated on: ${new Date().toLocaleString()}\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\n`;\n\nreturn {\n  json: {\n    report: report,\n    dateRange: dateRange,\n    summary: {\n      totalAdSpend: (parseFloat(googleAdsData.cost || 0) + parseFloat(fbAdsData.spend || 0)).toFixed(2),\n      totalConversions: (googleAdsData.conversions || 0) + (fbAdsData.conversions || 0),\n      websiteSessions: gaData.sessions,\n      totalUsers: gaData.totalUsers\n    }\n  }\n};"
      },
      "id": "ad4c97e0-76ca-4679-95a8-a8335a901fe8",
      "name": "Format Report",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1632,
        4256
      ],
      "notes": "Combines all data into formatted report"
    },
    {
      "parameters": {
        "operation": "create"
      },
      "id": "4c801235-8811-4baa-b697-0b086f8e286d",
      "name": "Save Report to Google Drive",
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        1856,
        4176
      ],
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "IYt9e9Ocdig5ushn",
          "name": "Drive-macaipiotr@gmail.com"
        }
      },
      "notes": "SETUP: Select your target folder in Google Drive or replace YOUR_FOLDER_ID"
    },
    {
      "parameters": {
        "subject": "=📊 Weekly Marketing Report - {{ $now.toFormat('MMM dd, yyyy') }}",
        "emailType": "text",
        "message": "={{ $json.report }}",
        "options": {}
      },
      "id": "480ee127-94d0-4b47-86e4-884367c740b0",
      "name": "Send Email via Gmail",
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.1,
      "position": [
        1856,
        4336
      ],
      "webhookId": "48968f97-00e5-47f0-b63b-bcc403b4b513",
      "credentials": {
        "gmailOAuth2": {
          "id": "hWqbyZCsj2P1YGwf",
          "name": "Gmail_macai"
        }
      },
      "notes": "SETUP: Replace fromEmail and toEmail with actual addresses"
    },
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "cronExpression",
              "expression": "0 9 * * 1"
            }
          ]
        }
      },
      "id": "dbd23093-6811-4cba-8e94-dbc42969e7ab",
      "name": "Schedule Trigger3",
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.1,
      "position": [
        1200,
        4256
      ],
      "disabled": true,
      "notes": "Runs every Monday at 9:00 AM - Customize: Change cronExpression"
    },
    {
      "parameters": {
        "height": 832,
        "width": 1088
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        1056,
        3984
      ],
      "typeVersion": 1,
      "id": "e9ab1508-8f6b-495b-9ba6-685cfeddae0c",
      "name": "Sticky Note6"
    },
    {
      "parameters": {
        "jsCode": "// Loop over input items and add a new field called 'myNewField' to the JSON of each one\nfor (const item of $input.all()) {\n  item.json.myNewField = 1;\n}\n\nreturn $input.all();"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1808,
        2944
      ],
      "id": "ff6adcfd-50d7-47a6-8592-b0bc970b7753",
      "name": "Code in JavaScript"
    },
    {
      "parameters": {
        "operation": "appendOrUpdate",
        "documentId": {
          "__rl": true,
          "mode": "list",
          "value": ""
        },
        "sheetName": {
          "__rl": true,
          "mode": "list",
          "value": ""
        }
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -1568,
        2944
      ],
      "id": "b6675b1d-1801-4e78-bc62-4cbccf359b26",
      "name": "Append or update row in sheet",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "n1lRTD7tyH1UVxfn",
          "name": "Google Sheets-macaipiotr@gmail.com"
        }
      },
      "disabled": true
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        -1264,
        3088
      ],
      "id": "ba5819e6-369a-47fb-beae-c4b0e035a5f3",
      "name": "Merge5"
    },
    {
      "parameters": {
        "operation": "create",
        "documentId": {
          "__rl": true,
          "mode": "list",
          "value": ""
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        3760,
        2624
      ],
      "id": "d37c741d-198f-4200-990a-05b95e14e531",
      "name": "Create sheet",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "n1lRTD7tyH1UVxfn",
          "name": "Google Sheets-macaipiotr@gmail.com"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        3296,
        2544
      ],
      "id": "19e108ca-929d-4eb0-b729-95aba2d823db",
      "name": "Google Gemini Chat Model5",
      "credentials": {
        "googlePalmApi": {
          "id": "OAc1dXJytNwb1o7V",
          "name": "GoogleApi2"
        }
      }
    },
    {
      "parameters": {
        "graphApiVersion": "v23.0",
        "node": "={{ $json.account_id }}",
        "edge": "=adaccounts",
        "options": {}
      },
      "id": "ef14479e-1cff-4485-acac-125c0256eadb",
      "name": "graph: adaccounts1",
      "type": "n8n-nodes-base.facebookGraphApi",
      "position": [
        -2368,
        3152
      ],
      "typeVersion": 1,
      "credentials": {
        "facebookGraphApi": {
          "id": "qyqXK2BX1VsAfqgn",
          "name": "Facebook Graph account"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=\nAnalyze the following Google Analytics data from the last 7 days and create a comprehensive performance report.\n\n## DATA TO ANALYZE:\n{{$json.date}} - Analysis Period\n{{$json.screenPageViews}} - Screen/Page Views\n{{$json.totalUsers}} - Total Users\n{{$json.sessions}} - Sessions\n{{$json.sessionsPerUser}} - Sessions Per User\n{{$json.eventCount}} - Event Count\n{{$json.active7DayUsers}} - Active 7-Day Users\n\n## YOUR TASK:\nCreate a professional analytics report following your system instructions. Focus on delivering actionable insights that help the client understand their digital performance and make informed marketing decisions.\n\nIMPORTANT:\n- Write the complete report in Polish language\n- Include all required sections from your framework\n- Provide specific, data-driven recommendations\n- Maintain professional tone throughout\n- NO INTRODUCTION, NO CONCLUSION outside the report structure!",
        "options": {
          "systemMessage": "You are a professional Marketing Analytics Consultant working for a digital marketing agency. Your role is to analyze Google Analytics data and create comprehensive, actionable reports for clients.\n\n## YOUR CORE RESPONSIBILITIES:\n1. Analyze GA4 metrics with business context and marketing expertise\n2. Identify trends, patterns, and anomalies in the data\n3. Provide actionable insights and strategic recommendations\n4. Present data in a clear, professional manner suitable for business decision-makers\n5. Focus on ROI and business impact, not just vanity metrics\n\n## ANALYSIS FRAMEWORK:\nWhen analyzing data, always consider:\n- **Performance Trends**: Are metrics improving or declining? By how much?\n- **User Behavior**: What do session and engagement patterns reveal?\n- **Traffic Quality**: Evaluate sessions per user and engagement depth\n- **Retention Signals**: Active 7-day users indicate audience loyalty\n- **Business Context**: Relate metrics to business goals and KPIs\n\n## REPORT STRUCTURE REQUIREMENTS:\nYour report MUST include these sections:\n\n### 1. EXECUTIVE SUMMARY (2-3 sentences)\n- High-level overview of performance\n- Key takeaway or most important finding\n- Overall sentiment: positive, neutral, or needs attention\n\n### 2. KEY METRICS OVERVIEW\nPresent each metric with:\n- Current value\n- Context (what it means for the business)\n- Performance indicator (good/concerning/neutral)\n\n### 3. TRAFFIC & ENGAGEMENT ANALYSIS\n- Total reach and user acquisition effectiveness\n- Engagement depth (sessions per user, events per session)\n- User behavior patterns and quality signals\n\n### 4. CRITICAL INSIGHTS (3-5 bullet points)\n- Most important findings that require attention\n- Trends or patterns discovered in the data\n- Potential opportunities or risks identified\n\n### 5. STRATEGIC RECOMMENDATIONS (3-5 actionable items)\n- Specific actions to improve performance\n- Prioritized by potential impact\n- Realistic and implementable suggestions\n- Tied directly to the data analyzed\n\n### 6. NEXT STEPS\n- What to monitor in the coming period\n- Suggested follow-up analyses or tests\n\n## WRITING STYLE GUIDELINES:\n- Professional but accessible language\n- Avoid jargon unless necessary (explain when used)\n- Use active voice and confident statements\n- Be specific with numbers and percentages\n- Balance positive framing with honest assessment\n- Write as an expert advisor, not just a data reporter\n\n## IMPORTANT CONSTRAINTS:\n- Write ONLY the report content - no introductions or conclusions outside the structure\n- NO meta-commentary about the report itself\n- Base ALL statements on the provided data\n- If data seems unusual or limited, note it professionally within the analysis\n- Use Polish language for the entire report\n- Format in clean, readable Markdown\n\n## METRIC DEFINITIONS FOR CONTEXT:\n- **screenPageViews**: Total page/screen views - indicates content consumption\n- **totalUsers**: Unique visitors - measures audience reach\n- **sessions**: Total visit sessions - shows engagement frequency\n- **sessionsPerUser**: Average visits per user - loyalty/return rate indicator\n- **eventCount**: Total interactions tracked - engagement depth measure\n- **active7DayUsers**: Users active in last 7 days - retention indicator"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3,
      "position": [
        1888,
        1008
      ],
      "id": "ac8a68a8-e3c0-4acf-b86c-68d83ca0ffd2",
      "name": "GA_Agent"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Przeanalizuj poniższe dane z kampanii Google Ads z ostatnich 7 dni i stwórz profesjonalny raport wydajnościowy.\n\n## DANE DO ANALIZY:\n**Okres analizy**: {{$json.date}} lub ostatnie 7 dni\n\n**Metryki kampanii:**\n- **Wyświetlenia (Impressions)**: {{$json.impressions}}\n- **Kliknięcia (Clicks)**: {{$json.clicks}}\n- **CTR (Click-Through Rate)**: {{$json.ctr}}%\n- **Koszt całkowity (Cost)**: {{$json.cost}} PLN\n- **Konwersje (Conversions)**: {{$json.conversions}}\n- **CPA (Cost Per Acquisition)**: {{$json.cost_per_conversion}} PLN\n- **ROAS (Return on Ad Spend)**: {{$json.roas}} (jeśli dostępny)\n\n**Dodatkowe metryki (jeśli dostępne):**\n- CPC (Cost Per Click): {{$json.average_cpc}} PLN\n- Conversion Rate: {{$json.conversion_rate}}%\n- Conversion Value: {{$json.conversion_value}} PLN\n\n## TWOJE ZADANIE:\nStwórz kompletny raport analityczny według struktury z Twoich instrukcji systemowych. Skup się na dostarczeniu wartościowych insightów, które pomogą klientowi zrozumieć wydajność kampanii i podjąć świadome decyzje marketingowe.\n\n**WAŻNE:**\n- Napisz cały raport w języku polskim\n- Uwzględnij wszystkie wymagane sekcje\n- Dostarcz konkretne, wykonalne rekomendacje\n- Zachowaj profesjonalny ton przez cały raport\n- ŻADNYCH wstępów ani podsumowań poza strukturą raportu!",
        "options": {
          "systemMessage": "You are a Senior Google Ads Performance Specialist working for a digital marketing agency. Your role is to analyze Google Ads campaign data and create comprehensive, strategic performance reports for clients that drive actionable insights and ROI optimization.\n\n## YOUR CORE EXPERTISE:\n1. Deep understanding of paid advertising metrics and their business implications\n2. Ability to identify performance patterns, anomalies, and optimization opportunities\n3. Strategic thinking about campaign optimization and budget allocation\n4. Clear communication of complex advertising data to non-technical stakeholders\n5. Focus on ROAS, profitability, and business outcomes over vanity metrics\n\n## ANALYSIS FRAMEWORK:\nWhen analyzing Google Ads data, systematically evaluate:\n\n### Performance Efficiency:\n- **Click-Through Rate (CTR)**: Ad relevance and targeting quality\n- **Cost Per Click (CPC)**: Budget efficiency and competitive positioning\n- **Cost Per Acquisition (CPA)**: Conversion efficiency and profitability\n- **Return on Ad Spend (ROAS)**: Overall campaign profitability\n\n### Traffic & Reach:\n- **Impressions**: Audience reach and visibility\n- **Clicks**: Actual user interest and engagement\n- **Impression Share**: Market coverage and lost opportunity analysis\n\n### Conversion Performance:\n- **Conversions**: Goal completion and business impact\n- **Conversion Rate**: Landing page and offer effectiveness\n- **Conversion Value**: Revenue generation and business value\n\n### Budget Efficiency:\n- **Cost**: Spending patterns and budget utilization\n- **Cost Per Conversion**: Acquisition efficiency\n- **ROAS**: Return on investment and profitability\n\n## REPORT STRUCTURE REQUIREMENTS:\nYour report MUST include these sections in Polish:\n\n### 1. PODSUMOWANIE WYKONAWCZE (2-3 zdania)\n- Ogólna ocena wydajności kampanii\n- Najważniejsze osiągnięcie lub problem wymagający uwagi\n- Rekomendacja kluczowego działania\n\n### 2. ANALIZA KLUCZOWYCH METRYK\nDla każdej metryki przedstaw:\n- Wartość liczbową z kontekstem biznesowym\n- Ocenę wydajności (dobra/wymaga poprawy/krytyczna)\n- Co oznacza dla biznesu klienta\n\n**Metryki do analizy:**\n- Wyświetlenia (Impressions) - zasięg i widoczność\n- Kliknięcia (Clicks) - zainteresowanie użytkowników\n- CTR - efektywność kreacji i targetowania\n- Koszt (Cost) - wykorzystanie budżetu\n- Konwersje (Conversions) - realizacja celów biznesowych\n- CPA - efektywność akwizycji\n- ROAS - zwrot z inwestycji reklamowej\n\n### 3. ANALIZA WYDAJNOŚCI KAMPANII\nSzczegółowa ocena:\n- **Efektywność ruchu**: Jakość i ilość wygenerowanego ruchu\n- **Jakość konwersji**: Analiza współczynnika konwersji i wartości\n- **Efektywność kosztowa**: CPA, ROAS, wykorzystanie budżetu\n- **Konkurencyjność**: CPC i pozycjonowanie w kontekście rynku\n\n### 4. KLUCZOWE WNIOSKI (3-5 punktów)\n- Największe sukcesy i osiągnięcia\n- Obszary wymagające natychmiastowej uwagi\n- Wykryte trendy i wzorce\n- Potencjalne zagrożenia lub szanse\n\n### 5. REKOMENDACJE STRATEGICZNE (3-5 działań)\nKonkretne, wykonalne rekomendacje:\n- Priorytetyzowane według wpływu na ROI\n- Związane bezpośrednio z przeanalizowanymi danymi\n- Z oszacowanym potencjalnym wpływem\n- Realistyczne i możliwe do wdrożenia\n\n### 6. NASTĘPNE KROKI\n- Co monitorować w nadchodzącym okresie\n- Sugerowane testy i optymalizacje\n- Proponowane zmiany w strategii\n\n## BENCHMARKI WYDAJNOŚCI (Kontekst dla oceny):\nUżywaj tych referencyjnych wartości do oceny (mogą się różnić w zależności od branży):\n\n- **CTR**: \n  - Wysoki: >5% (Search), >1% (Display)\n  - Dobry: 3-5% (Search), 0.5-1% (Display)\n  - Wymaga poprawy: <3% (Search), <0.5% (Display)\n\n- **Conversion Rate**:\n  - Wysoki: >10%\n  - Dobry: 5-10%\n  - Wymaga poprawy: <5%\n\n- **ROAS**:\n  - Wysoki: >400% (4:1)\n  - Dobry: 200-400% (2:1 - 4:1)\n  - Wymaga poprawy: <200% (2:1)\n\n**UWAGA**: Te benchmarki to ogólne wskaźniki. Zawsze uwzględniaj kontekst biznesowy klienta, branżę, cele kampanii i marże produktowe.\n\n## STYL PISANIA:\n- Profesjonalny, ale przystępny język\n- Unikaj żargonu - jeśli musisz użyć terminów technicznych, wyjaśnij je\n- Używaj aktywnego trybu i pewnych stwierdzeń\n- Bądź konkretny z liczbami i procentami\n- Balansuj pozytywne przedstawienie z uczciwą oceną\n- Pisz jako doradca ekspercki, nie tylko reporter danych\n- Używaj formatowania Markdown dla czytelności\n\n## WAŻNE OGRANICZENIA:\n- Pisz TYLKO treść raportu - bez meta-komentarzy o samym raporcie\n- Opieraj WSZYSTKIE stwierdzenia na dostarczonych danych\n- Jeśli dane są ograniczone (np. brak ROAS), odnotuj to profesjonalnie\n- Używaj języka polskiego dla całego raportu\n- Formatuj w czystym, czytelnym Markdown\n- Jeśli brakuje kluczowych metryk (np. ROAS, CPA), wspomnij o tym jako ograniczeniu analizy\n\n## DEFINICJE METRYK (do kontekstu):\n- **Impressions**: Liczba wyświetleń reklam - mierzy zasięg\n- **Clicks**: Liczba kliknięć w reklamy - pokazuje zainteresowanie\n- **CTR (Click-Through Rate)**: Współczynnik klikalności (Clicks/Impressions × 100%) - efektywność reklam\n- **Cost**: Całkowity koszt kampanii - wydatki na reklamę\n- **CPC (Cost Per Click)**: Koszt za kliknięcie (Cost/Clicks) - efektywność budżetu\n- **Conversions**: Liczba konwersji - realizacja celów biznesowych\n- **Conversion Rate**: Współczynnik konwersji (Conversions/Clicks × 100%) - efektywność ścieżki konwersji\n- **CPA (Cost Per Acquisition)**: Koszt pozyskania klienta (Cost/Conversions) - efektywność akwizycji\n- **ROAS (Return on Ad Spend)**: Zwrot z wydatków na reklamę - rentowność kampanii\n\n## ANALIZA KONTEKSTOWA:\nZawsze bierz pod uwagę:\n- Typ kampanii (Search/Display/Shopping/Video/Performance Max)\n- Cel kampanii (brand awareness vs. conversions)\n- Etap lejka marketingowego (TOP/MOFU/BOFU)\n- Sezonowość i trendy rynkowe\n- Konkurencyjność branży"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3,
      "position": [
        2928,
        1536
      ],
      "id": "9c1d6669-094d-4975-a3d8-a39c2a797eea",
      "name": "GoogleAds_Agent"
    },
    {
      "parameters": {
        "graphApiVersion": "v23.0",
        "node": "={{ $json.account_id }}",
        "edge": "insights",
        "options": {
          "fields": {
            "field": [
              {
                "name": "attribution_setting,conversion_values,conversions,cost_per_conversion,cpc,cpm,ctr,frequency,impressions,inline_post_engagement,purchase_roas,reach,result_rate,results,spend"
              }
            ]
          },
          "queryParameters": {
            "parameter": [
              {
                "name": "time_range[since]",
                "value": "={{ $json.since.replace(/T.*/,'') }}"
              },
              {
                "name": "time_range[until]",
                "value": "={{ $json.until.replace(/T.*/,'') }}"
              }
            ]
          }
        }
      },
      "id": "2399b655-a909-4dde-a6b8-fc25e105ae16",
      "name": "account insights1",
      "type": "n8n-nodes-base.facebookGraphApi",
      "position": [
        -2048,
        3488
      ],
      "typeVersion": 1,
      "credentials": {
        "facebookGraphApi": {
          "id": "qyqXK2BX1VsAfqgn",
          "name": "Facebook Graph account"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Przeanalizuj poniższe dane z Facebook Ads i/lub Facebook Insights i stwórz profesjonalny raport wydajnościowy kampanii społecznościowych.\n\n## DANE DO ANALIZY:\n\n**Informacje podstawowe:**\n- **Nazwa konta/kampanii**: {{$json.account_name}} / {{$json.campaign_name}}\n- **ID konta/kampanii**: {{$json.account_id}} / {{$json.campaign_id}}\n- **Nazwa reklamy**: {{$json.ad_name}} (jeśli na poziomie ad)\n- **Okres analizy**: {{$json.date_start}} - {{$json.date_stop}}\n\n**Metryki zasięgu i widoczności:**\n- **Wyświetlenia (Impressions)**: {{$json.impressions}}\n- **Zasięg (Reach)**: {{$json.reach}}\n- **Częstotliwość (Frequency)**: {{$json.frequency}}\n\n**Metryki zaangażowania:**\n- **Kliknięcia (Clicks)**: {{$json.clicks}}\n- **Kliknięcia w link (Link Clicks)**: {{$json.link_clicks}}\n- **CTR (Click-Through Rate)**: {{$json.ctr}}%\n- **Post Engagement**: {{$json.post_engagement}}\n- **Reactions**: {{$json.reactions}}\n- **Comments**: {{$json.comments}}\n- **Shares**: {{$json.shares}}\n\n**Metryki wideo (jeśli dostępne):**\n- **Video Views**: {{$json.video_views}}\n- **Video Average Watch Time**: {{$json.video_avg_time_watched_actions}}\n- **ThruPlays**: {{$json.video_play_actions}}\n\n**Metryki kosztowe:**\n- **Całkowity koszt (Spend)**: {{$json.spend}} PLN/USD\n- **CPC (Cost Per Click)**: {{$json.cpc}} PLN/USD\n- **CPM (Cost Per Mille)**: {{$json.cpm}} PLN/USD\n- **Budżet dzienny**: {{$json.daily_budget}} (jeśli dostępny)\n- **Budżet całkowity**: {{$json.lifetime_budget}} (jeśli dostępny)\n\n**Metryki konwersji (jeśli dostępne):**\n- **Conversions**: {{$json.conversions}}\n- **Conversion Rate**: {{$json.conversion_rate}}%\n- **Actions**: {{$json.actions}} (różne typy akcji)\n- **Cost Per Action**: {{$json.cost_per_action_type}}\n- **ROAS**: {{$json.purchase_roas}}\n- **Revenue/Value**: {{$json.action_values}}\n\n**Dodatkowe informacje:**\n- **Campaign Objective**: {{$json.objective}} (jeśli dostępny)\n- **Status**: {{$json.effective_status}}\n- **Buying Type**: {{$json.buying_type}}\n\n## TWOJE ZADANIE:\nStwórz kompletny raport analityczny według struktury z Twoich instrukcji systemowych.\n\n**KRYTYCZNE WYMAGANIA:**\n1. Przeanalizuj wszystkie dostępne metryki w kontekście benchmarków branżowych\n2. Zidentyfikuj wskaźniki ad fatigue (frequency, declining CTR)\n3. Oceń efektywność kosztową (CPC, CPM, CPA względem branży)\n4. Sprawdź balans frequency vs reach\n5. Oceń jakość kreacji na podstawie CTR i engagement\n6. Jeśli brak danych o konwersjach - wskaż to jako kluczowy obszar do wdrożenia\n7. Dostarcz rekomendacje priorytetyzowane według potencjalnego wpływu\n8. Wskaż konkretne liczby i metryki w rekomendacjach\n\n**WAŻNE:**\n- Napisz cały raport w języku polskim\n- Uwzględnij wszystkie wymagane sekcje ze struktury\n- Dostarcz konkretne, wykonalne rekomendacje\n- Zachowaj profesjonalny ton przez cały raport\n- ŻADNYCH wstępów ani podsumowań poza strukturą raportu!\n- Jeśli któraś metryka nie jest dostępna, nie spekuluj - wskaż to jako lukę w danych",
        "options": {
          "systemMessage": "You are a Senior Facebook Ads & Social Media Analytics Specialist working for a digital marketing agency. Your role is to analyze Facebook Ads campaign performance and Facebook Page Insights data to create comprehensive, strategic reports for clients that drive actionable insights and maximize ROI.\n\n## YOUR CORE EXPERTISE:\n1. Deep understanding of Facebook/Meta advertising metrics and social media analytics\n2. Ability to identify performance patterns, audience behavior, and optimization opportunities\n3. Strategic thinking about campaign optimization, creative refresh, and budget allocation\n4. Clear communication of complex social media data to non-technical stakeholders\n5. Focus on ROAS, engagement quality, and business outcomes over vanity metrics\n6. Understanding of Facebook's auction system, ad fatigue, and frequency management\n\n## ANALYSIS FRAMEWORK:\nWhen analyzing Facebook Ads and Insights data, systematically evaluate:\n\n### Campaign Performance Efficiency:\n- **Click-Through Rate (CTR)**: Ad relevance, creative quality, and targeting effectiveness\n- **Cost Per Click (CPC)**: Budget efficiency and auction competitiveness\n- **Cost Per Mille (CPM)**: Cost efficiency of reaching target audience\n- **Frequency**: Ad exposure management and fatigue prevention\n- **Engagement Rate**: Quality of audience interaction with content\n\n### Audience Reach & Visibility:\n- **Impressions**: Total ad views and content exposure\n- **Reach**: Unique users reached by campaigns\n- **Frequency vs Reach Balance**: Optimal exposure without saturation\n\n### Conversion & Business Impact:\n- **Conversions**: Goal completion (purchases, leads, sign-ups, etc.)\n- **Conversion Rate**: Funnel effectiveness\n- **Cost Per Action (CPA)**: Acquisition efficiency\n- **ROAS (Return on Ad Spend)**: Overall campaign profitability\n- **Actions**: Various conversion events tracked\n\n### Social Engagement Quality:\n- **Post Engagement**: Likes, comments, shares, reactions\n- **Video Performance**: Video views, completion rate, watch time\n- **Link Clicks**: Traffic generation effectiveness\n- **Page Engagement**: Overall page interaction metrics\n\n### Budget & Spend Efficiency:\n- **Total Spend**: Budget utilization\n- **Daily/Lifetime Budget**: Budget pacing and allocation\n- **Cost Efficiency by Objective**: Performance relative to campaign goals\n\n## REPORT STRUCTURE REQUIREMENTS:\nYour report MUST include these sections in Polish:\n\n### 1. PODSUMOWANIE WYKONAWCZE (2-3 zdania)\n- Ogólna ocena wydajności kampanii i zaangażowania społeczności\n- Najważniejsze osiągnięcie lub problem wymagający uwagi\n- Kluczowa rekomendacja działania\n\n### 2. PRZEGLĄD KAMPANII I KONTA\n- Nazwa kampanii/konta i typ kampanii\n- Status kampanii i okres analizy\n- Cele biznesowe i kampanii (jeśli znane)\n- Całkowity budżet i wydatki w okresie\n\n### 3. ANALIZA KLUCZOWYCH METRYK\n\n**A. ZASIĘG I WIDOCZNOŚĆ:**\n- **Impressions (Wyświetlenia)**: Całkowita liczba wyświetleń reklam\n- **Reach (Zasięg)**: Liczba unikalnych użytkowników, którzy widzieli reklamy\n- **Frequency (Częstotliwość)**: Średnia liczba wyświetleń na użytkownika\n  - Oceń czy frequency jest w zdrowym zakresie (1-3 = optymalne, >5 = ryzyko zmęczenia reklamą)\n\n**B. ZAANGAŻOWANIE I INTERAKCJE:**\n- **CTR (Click-Through Rate)**: Współczynnik klikalności\n  - Benchmark: >1% = dobry, 0.5-1% = średni, <0.5% = wymaga poprawy\n- **Link Clicks (Kliknięcia w link)**: Faktyczne kliknięcia w CTA\n- **Post Engagement**: Łączne zaangażowanie (likes, comments, shares)\n- **Engagement Rate**: Procent zaangażowania względem zasięgu\n- **Actions**: Różne typy akcji konwersyjnych\n\n**C. WYDAJNOŚĆ WIDEO (jeśli dotyczy):**\n- **Video Views**: Liczba obejrzeń wideo\n- **Video Completion Rate**: Procent użytkowników kończących oglądanie\n- **ThruPlays**: Kompletne obejrzenia wideo (15s+ lub do końca)\n- **Average Watch Time**: Średni czas oglądania\n\n**D. EFEKTYWNOŚĆ KOSZTOWA:**\n- **Total Spend (Całkowity koszt)**: Wydatki na kampanię\n- **CPC (Cost Per Click)**: Koszt za kliknięcie\n  - Benchmark: <$0.50 = bardzo dobry, $0.50-$1 = dobry, >$1 = wysoki\n- **CPM (Cost Per Mille)**: Koszt za 1000 wyświetleń\n  - Benchmark: <$10 = dobry, $10-$20 = średni, >$20 = wysoki\n- **CPA (Cost Per Action)**: Koszt za akcję/konwersję\n- **Daily/Lifetime Budget**: Budżet dzienny lub całkowity\n\n**E. KONWERSJE I ROI (jeśli dostępne):**\n- **Conversions**: Liczba konwersji\n- **Conversion Rate**: Współczynnik konwersji\n- **ROAS**: Zwrot z wydatków na reklamę\n  - Benchmark: >300% = doskonały, 200-300% = dobry, <200% = wymaga poprawy\n- **Revenue/Value**: Wartość wygenerowana przez kampanię\n\n### 4. ANALIZA WYDAJNOŚCI KAMPANII\nSzczegółowa ocena w kontekście celów:\n\n- **Efektywność Targetowania**: \n  - Czy frequency wskazuje na optymalne dotarcie?\n  - Czy CTR sugeruje trafne dopasowanie do grupy docelowej?\n  - Czy CPM jest konkurencyjny w Twojej branży?\n\n- **Jakość Kreacji Reklamowych**:\n  - Czy CTR i engagement rate wskazują na skuteczne kreacje?\n  - Czy video completion rate jest wysoki (dla kampanii wideo)?\n  - Czy potrzebna jest rotacja kreacji (high frequency + declining CTR)?\n\n- **Efektywność Konwersji**:\n  - Czy conversion rate jest satysfakcjonujący?\n  - Czy CPA jest w akceptowalnym zakresie?\n  - Czy ROAS uzasadnia wydatki reklamowe?\n\n- **Budżet i Wydajność**:\n  - Czy budżet jest optymalnie wykorzystywany?\n  - Czy CPM i CPC są efektywne kosztowo?\n  - Czy są możliwości realokacji budżetu?\n\n### 5. KLUCZOWE WNIOSKI (3-5 punktów)\n- Największe sukcesy i osiągnięcia\n- Obszary wymagające natychmiastowej uwagi\n- Wykryte trendy i wzorce (ad fatigue, audience saturation, creative performance)\n- Potencjalne zagrożenia (wysokie frequency, rosnące koszty)\n- Możliwości do wykorzystania (niedostatecznie wykorzystane formaty, nowe segmenty)\n\n### 6. REKOMENDACJE STRATEGICZNE (3-5 działań)\nKonkretne, wykonalne rekomendacje priorytetyzowane według wpływu:\n\n**Możliwe obszary rekomendacji:**\n- Refresh kreacji reklamowych (jeśli frequency >5 lub spadający CTR)\n- Rozszerzenie lub zawężenie grupy docelowej\n- Optymalizacja stawek i strategii bidowania\n- Testowanie nowych formatów reklamowych\n- Realokacja budżetu między kampaniami/ad setami\n- Implementacja lub optymalizacja trackingu konwersji\n- Testy A/B kreacji, copy, lub CTA\n- Wdrożenie retargetingu dla ciepłej publiczności\n- Wykorzystanie Lookalike Audiences\n\n### 7. NASTĘPNE KROKI I MONITORING\n- Co monitorować w nadchodzącym okresie (kluczowe metryki)\n- Sugerowane testy i eksperymenty\n- Proponowane zmiany w strategii lub budżecie\n- Timeline dla wdrożenia rekomendacji\n- Metryki sukcesu dla proponowanych zmian\n\n## BENCHMARKI WYDAJNOŚCI (Kontekst dla oceny):\n\n### General Facebook Ads Benchmarks:\n- **CTR**: \n  - Wysoki: >2%\n  - Dobry: 1-2%\n  - Średni: 0.5-1%\n  - Wymaga poprawy: <0.5%\n\n- **CPC**:\n  - Bardzo dobry: <$0.30\n  - Dobry: $0.30-$0.50\n  - Średni: $0.50-$1.00\n  - Wysoki: >$1.00\n\n- **CPM**:\n  - Niski: <$5\n  - Dobry: $5-$10\n  - Średni: $10-$20\n  - Wysoki: >$20\n\n- **Frequency**:\n  - Optymalna: 1-3\n  - Akceptowalna: 3-5\n  - Ryzyko ad fatigue: >5\n  - Krytyczna: >10\n\n- **Conversion Rate**:\n  - Wysoki: >10%\n  - Dobry: 5-10%\n  - Średni: 2-5%\n  - Wymaga poprawy: <2%\n\n- **ROAS**:\n  - Doskonały: >400% (4:1)\n  - Bardzo dobry: 300-400% (3:1 - 4:1)\n  - Dobry: 200-300% (2:1 - 3:1)\n  - Minimalny: 100-200% (1:1 - 2:1)\n  - Nierentowny: <100%\n\n- **Engagement Rate**:\n  - Wysoki: >3%\n  - Dobry: 1-3%\n  - Średni: 0.5-1%\n  - Niski: <0.5%\n\n**UWAGA**: Te benchmarki to ogólne wskaźniki. Rzeczywiste wartości docelowe różnią się w zależności od:\n- Branży i konkurencji\n- Typu kampanii (awareness vs. conversion)\n- Etapu lejka marketingowego\n- Lokalizacji geograficznej\n- Sezonowości\n- Wartości życiowej klienta (LTV)\n\n## STYL PISANIA:\n- Profesjonalny, ale przystępny język\n- Unikaj żargonu - wyjaśniaj terminy techniczne gdy są niezbędne\n- Używaj aktywnego trybu i pewnych stwierdzeń\n- Bądź konkretny z liczbami i procentami\n- Balansuj pozytywne przedstawienie z uczciwą oceną problemów\n- Pisz jako doradca ekspercki, nie tylko reporter danych\n- Używaj formatowania Markdown dla czytelności\n- Dostosuj ton do poziomu wiedzy odbiorcy\n\n## WAŻNE OGRANICZENIA:\n- Pisz TYLKO treść raportu - bez meta-komentarzy\n- Opieraj WSZYSTKIE stwierdzenia na dostarczonych danych\n- Jeśli brakuje kluczowych metryk (np. konwersje, ROAS), wspomnij to jako ograniczenie analizy\n- Używaj języka polskiego dla całego raportu\n- Formatuj w czystym, czytelnym Markdown\n- Nie wymyślaj danych - jeśli metryka nie jest dostępna, nie spekuluj o jej wartości\n\n## DEFINICJE METRYK (do kontekstu):\n\n### Podstawowe Metryki Facebook Ads:\n- **account_id / account_name**: Identyfikator i nazwa konta reklamowego\n- **campaign_id / campaign_name**: Identyfikator i nazwa kampanii\n- **ad_id / ad_name**: Identyfikator i nazwa reklamy\n- **date_start / date_stop**: Zakres dat analizy\n\n### Metryki Zasięgu:\n- **impressions**: Całkowita liczba wyświetleń reklam (ta sama osoba może być liczona wielokrotnie)\n- **reach**: Liczba unikalnych osób, które widziały reklamy\n- **frequency**: Średnia liczba wyświetleń na osobę (impressions / reach)\n\n### Metryki Zaangażowania:\n- **clicks**: Całkowita liczba kliknięć na reklamę (wszystkie typy)\n- **link_clicks**: Kliknięcia w linki prowadzące poza Facebook\n- **ctr**: Click-through rate - procent wyświetleń skutkujących kliknięciem\n- **post_engagement**: Łączne zaangażowanie (likes, comments, shares, clicks)\n- **reactions**: Reakcje na post (like, love, wow, etc.)\n- **comments**: Liczba komentarzy\n- **shares**: Liczba udostępnień\n\n### Metryki Wideo:\n- **video_views**: Liczba obejrzeń wideo (minimum 3 sekundy)\n- **video_30_sec_watched_actions**: Obejrzenia minimum 30 sekund\n- **video_p25/p50/p75/p100_watched_actions**: Procent obejrzenia wideo\n- **video_avg_time_watched_actions**: Średni czas oglądania\n\n### Metryki Kosztowe:\n- **spend**: Całkowity koszt kampanii\n- **cpc**: Cost per click - koszt za kliknięcie\n- **cpm**: Cost per mille - koszt za 1000 wyświetleń\n- **cpp**: Cost per post engagement - koszt za zaangażowanie\n\n### Metryki Konwersji:\n- **actions**: Tablica różnych akcji konwersyjnych\n  - purchase: zakupy\n  - lead: leady\n  - add_to_cart: dodanie do koszyka\n  - complete_registration: rejestracje\n  - etc.\n- **conversions**: Całkowita liczba konwersji\n- **conversion_rate**: Procent kliknięć skutkujących konwersją\n- **cost_per_action_type**: Koszt za różne typy akcji\n- **purchase_roas**: Return on ad spend dla zakupów\n\n### Metryki Budżetu:\n- **budget_remaining**: Pozostały budżet\n- **daily_budget**: Budżet dzienny\n- **lifetime_budget**: Budżet całkowity kampanii\n\n## ANALIZA KONTEKSTOWA:\nZawsze bierz pod uwagę:\n- Cele kampanii (awareness, consideration, conversion)\n- Typ kampanii i format reklamowy\n- Etap lejka marketingowego (TOFU/MOFU/BOFU)\n- Branżę i konkurencyjność rynku\n- Ad fatigue indicators (frequency >5, declining CTR)\n- Audience saturation signals\n- Sezonowość i trendy rynkowe\n- Device and placement performance (jeśli dostępne w breakdowns)\n\n## ROZPOZNAWANIE PROBLEMÓW:\n\n**Red Flags wymagające natychmiastowej uwagi:**\n- Frequency >7 + spadający CTR = Ad fatigue\n- Wysoki CTR + niski conversion rate = Problem z landing page lub ofertą\n- Rosnący CPM + spadający reach = Saturacja publiczności\n- Niski CTR (<0.5%) = Słabe targetowanie lub kreacja\n- Wysoki CPA bez odpowiedniego ROAS = Nierentowna kampania\n- Frequency >10 = Krytyczne przesycenie reklamami\n\n**Możliwości do wykorzystania:**\n- Dobry CTR + niski CPC = Skalowanie budżetu\n- Wysoki engagement rate = Content performing well - consider boosting\n- Niski frequency + dobry reach = Przestrzeń do zwiększenia budżetu\n- Wysoki ROAS = Kampania do skalowania"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3,
      "position": [
        3248,
        2288
      ],
      "id": "840ad1d7-1f30-457b-8ef8-cddb03b9f4fd",
      "name": "Meta_Agent"
    },
    {
      "parameters": {
        "operation": "appendOrUpdate",
        "documentId": {
          "__rl": true,
          "mode": "list",
          "value": ""
        },
        "sheetName": {
          "__rl": true,
          "mode": "list",
          "value": ""
        }
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        1952,
        1456
      ],
      "id": "4b1138c0-3420-49bf-96bf-923eb02a2781",
      "name": "Append or update row in sheet2",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "n1lRTD7tyH1UVxfn",
          "name": "Google Sheets-macaipiotr@gmail.com"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "graphApiVersion": "v23.0",
        "node": "={{ $('Set Campaign Config').item.json.campaign_id }}",
        "edge": "insights",
        "options": {
          "fields": {
            "field": [
              {
                "name": "campaign_id,campaign_name,impressions,clicks,spend,cpc,cpm,ctr,reach,frequency,conversions,conversion_values,cost_per_conversion"
              }
            ]
          }
        }
      },
      "type": "n8n-nodes-base.facebookGraphApi",
      "typeVersion": 1,
      "position": [
        1712,
        2064
      ],
      "id": "31a68caf-ddbb-4d8f-b0e8-63b16ba170f0",
      "name": "Campaign",
      "credentials": {
        "facebookGraphApi": {
          "id": "qyqXK2BX1VsAfqgn",
          "name": "Facebook Graph account"
        }
      }
    },
    {
      "parameters": {
        "graphApiVersion": "v23.0",
        "node": "={{ $json.account_id }}",
        "edge": "campaigns",
        "options": {
          "fields": {
            "field": [
              {
                "name": "id,name,status,objective"
              }
            ]
          }
        }
      },
      "type": "n8n-nodes-base.facebookGraphApi",
      "typeVersion": 1,
      "position": [
        1376,
        2320
      ],
      "id": "389a523b-2706-44c5-8925-c851f41a7cf0",
      "name": "Facebook",
      "credentials": {
        "facebookGraphApi": {
          "id": "qyqXK2BX1VsAfqgn",
          "name": "Facebook Graph account"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "c5761593-547d-4417-aa3b-f7f6c71be1fc",
              "name": "account_id",
              "value": "act_766708849771578",
              "type": "string"
            },
            {
              "id": "a8f18205-7ae3-42cf-b11f-bcc27525c777",
              "name": "campaign_id",
              "value": "120238855441650198",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        1152,
        2320
      ],
      "id": "eccb893a-ae69-4588-9505-d5c29ead62cb",
      "name": "Set Campaign Config"
    },
    {
      "parameters": {
        "mode": "runOnceForEachItem",
        "jsCode": "const campaignData = $input.item.json.data[0] || {};\nconst timestamp = $('Set Campaign Config').item.json.timestamp;\nconst date = $('Set Campaign Config').item.json.date;\n\nreturn {\n  campaign_id: campaignData.campaign_id,\n  campaign_name: campaignData.campaign_name,\n  status: \"ACTIVE\",\n  objective: \"CONVERSIONS\",\n  impressions: parseFloat(campaignData.impressions || 0),\n  clicks: parseFloat(campaignData.clicks || 0),\n  spend: parseFloat(campaignData.spend || 0),\n  cpc: parseFloat(campaignData.cpc || 0),\n  cpm: parseFloat(campaignData.cpm || 0),\n  ctr: parseFloat(campaignData.ctr || 0),\n  reach: parseFloat(campaignData.reach || 0),\n  frequency: parseFloat(campaignData.frequency || 0),\n  conversions: parseFloat(campaignData.conversions || 0),\n  conversion_value: parseFloat(campaignData.conversion_values || 0),\n  cost_per_conversion: parseFloat(campaignData.cost_per_conversion || 0),\n  roas: parseFloat(campaignData.purchase_roas?.[0]?.value || 0),\n  last_updated: timestamp,\n  date: date\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1920,
        2064
      ],
      "id": "f169e033-25b3-4476-baf5-0b9ed326c7ba",
      "name": "Format Campaign data"
    },
    {
      "parameters": {
        "mode": "runOnceForEachItem",
        "jsCode": "const adsetData = $json.data?.[0] || {};\nconst adsetDetails = $('Split Ad Sets').item.json;\nconst timestamp = $('Set Campaign Config').item.json.timestamp;\nconst date = $('Set Campaign Config').item.json.date;\n\nreturn {\n  campaign_id: adsetData.campaign_id || adsetDetails.campaign_id,\n  campaign_name: adsetData.campaign_name || '',\n  adset_id: adsetData.adset_id || adsetDetails.id,\n  adset_name: adsetData.adset_name || adsetDetails.name,\n  status: adsetDetails.status,\n  impressions: parseFloat(adsetData.impressions || 0),\n  clicks: parseFloat(adsetData.clicks || 0),\n  spend: parseFloat(adsetData.spend || 0),\n  cpc: parseFloat(adsetData.cpc || 0),\n  cpm: parseFloat(adsetData.cpm || 0),\n  ctr: parseFloat(adsetData.ctr || 0),\n  reach: parseFloat(adsetData.reach || 0),\n  frequency: parseFloat(adsetData.frequency || 0),\n  conversions: parseFloat(adsetData.conversions || 0),\n  conversion_value: parseFloat(adsetData.conversion_values || 0),\n  cost_per_conversion: parseFloat(adsetData.cost_per_conversion || 0),\n  roas: parseFloat(adsetData.purchase_roas?.[0]?.value || 0),\n  last_updated: timestamp,\n  date: date\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2720,
        2320
      ],
      "id": "2da830e6-a3bc-4be9-b34a-5d83928224da",
      "name": "Format Ad Set Data"
    },
    {
      "parameters": {
        "operation": "appendOrUpdate",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/11goRNwLFTj7D2LbEEPfbjmSBfqr3c-6y_7QuzMMPZZU/edit?gid=0#gid=0",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "Arkusz1",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11goRNwLFTj7D2LbEEPfbjmSBfqr3c-6y_7QuzMMPZZU/edit#gid=0"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {},
          "matchingColumns": [],
          "schema": [
            {
              "id": "account_id",
              "displayName": "account_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "account_name",
              "displayName": "account_name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "campaign_id",
              "displayName": "campaign_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "campaign_name",
              "displayName": "campaign_name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "ad_id",
              "displayName": "ad_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "ad_name",
              "displayName": "ad_name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "date_start",
              "displayName": "date_start",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "date_stop",
              "displayName": "date_stop",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "impressions",
              "displayName": "impressions",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "reach",
              "displayName": "reach",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "frequency",
              "displayName": "frequency",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "clicks",
              "displayName": "clicks",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "link_clicks",
              "displayName": "link_clicks",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "ctr",
              "displayName": "ctr",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "post_engagement",
              "displayName": "post_engagement",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "reactions",
              "displayName": "reactions",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "comments",
              "displayName": "comments",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "shares",
              "displayName": "shares",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "video_views",
              "displayName": "video_views",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "video_avg_time_watched_actions",
              "displayName": "video_avg_time_watched_actions",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "video_play_actions",
              "displayName": "video_play_actions",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "spend",
              "displayName": "spend",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "cpc",
              "displayName": "cpc",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "cpm",
              "displayName": "cpm",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "daily_budget",
              "displayName": "daily_budget",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "lifetime_budget",
              "displayName": "lifetime_budget",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "conversions",
              "displayName": "conversions",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "conversion_rate",
              "displayName": "conversion_rate",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "actions",
              "displayName": "actions",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "cost_per_action_type",
              "displayName": "cost_per_action_type",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "purchase_roas",
              "displayName": "purchase_roas",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "action_values",
              "displayName": "action_values",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        2144,
        2064
      ],
      "id": "b0cdb2f5-fe05-4cf1-8497-1f9b1ce2e494",
      "name": "Update Campaign Data",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "n1lRTD7tyH1UVxfn",
          "name": "Google Sheets-macaipiotr@gmail.com"
        }
      }
    },
    {
      "parameters": {
        "operation": "appendOrUpdate",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/11goRNwLFTj7D2LbEEPfbjmSBfqr3c-6y_7QuzMMPZZU/edit?gid=0#gid=0",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "Arkusz1",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11goRNwLFTj7D2LbEEPfbjmSBfqr3c-6y_7QuzMMPZZU/edit#gid=0"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {},
          "matchingColumns": [],
          "schema": [
            {
              "id": "account_id",
              "displayName": "account_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "account_name",
              "displayName": "account_name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "campaign_id",
              "displayName": "campaign_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "campaign_name",
              "displayName": "campaign_name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "ad_id",
              "displayName": "ad_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "ad_name",
              "displayName": "ad_name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "date_start",
              "displayName": "date_start",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "date_stop",
              "displayName": "date_stop",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "impressions",
              "displayName": "impressions",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "reach",
              "displayName": "reach",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "frequency",
              "displayName": "frequency",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "clicks",
              "displayName": "clicks",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "link_clicks",
              "displayName": "link_clicks",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "ctr",
              "displayName": "ctr",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "post_engagement",
              "displayName": "post_engagement",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "reactions",
              "displayName": "reactions",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "comments",
              "displayName": "comments",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "shares",
              "displayName": "shares",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "video_views",
              "displayName": "video_views",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "video_avg_time_watched_actions",
              "displayName": "video_avg_time_watched_actions",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "video_play_actions",
              "displayName": "video_play_actions",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "spend",
              "displayName": "spend",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "cpc",
              "displayName": "cpc",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "cpm",
              "displayName": "cpm",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "daily_budget",
              "displayName": "daily_budget",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "lifetime_budget",
              "displayName": "lifetime_budget",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "conversions",
              "displayName": "conversions",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "conversion_rate",
              "displayName": "conversion_rate",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "actions",
              "displayName": "actions",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "cost_per_action_type",
              "displayName": "cost_per_action_type",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "purchase_roas",
              "displayName": "purchase_roas",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "action_values",
              "displayName": "action_values",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        2944,
        2320
      ],
      "id": "6d9d5ab6-eb2a-4663-b5ac-fc3931381d39",
      "name": "Update AdSet Data",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "n1lRTD7tyH1UVxfn",
          "name": "Google Sheets-macaipiotr@gmail.com"
        }
      }
    },
    {
      "parameters": {
        "graphApiVersion": "v23.0",
        "node": "={{ $('Set Campaign Config').item.json.campaign_id }}",
        "edge": "adsets",
        "options": {
          "fields": {
            "field": [
              {
                "name": "id,name,status,campaign_id"
              }
            ]
          }
        }
      },
      "type": "n8n-nodes-base.facebookGraphApi",
      "typeVersion": 1,
      "position": [
        1728,
        2320
      ],
      "id": "180dc184-9dce-4e24-a527-3f5d66ebcbba",
      "name": "Get Ad Sets",
      "credentials": {
        "facebookGraphApi": {
          "id": "qyqXK2BX1VsAfqgn",
          "name": "Facebook Graph account"
        }
      }
    },
    {
      "parameters": {
        "graphApiVersion": "v23.0",
        "node": "={{ $('Set Campaign Config').item.json.campaign_id }}",
        "edge": "ads",
        "options": {
          "fields": {
            "field": [
              {
                "name": "id,name,status,adset_id,campaign_id"
              }
            ]
          }
        }
      },
      "type": "n8n-nodes-base.facebookGraphApi",
      "typeVersion": 1,
      "position": [
        1744,
        2704
      ],
      "id": "4a11cd2e-0b04-4cb8-a598-2f0b0c6adc99",
      "name": "Get Ads",
      "credentials": {
        "facebookGraphApi": {
          "id": "qyqXK2BX1VsAfqgn",
          "name": "Facebook Graph account"
        }
      }
    },
    {
      "parameters": {
        "graphApiVersion": "v23.0",
        "node": "={{ $json.data[0].id }}",
        "edge": "insights",
        "options": {
          "fields": {
            "field": [
              {
                "name": "adset_id,adset_name,campaign_id,campaign_name,impressions,clicks,spend,cpc,cpm,ctr,reach,frequency,conversions,conversion_values,cost_per_conversion,purchase_roas"
              }
            ]
          }
        }
      },
      "type": "n8n-nodes-base.facebookGraphApi",
      "typeVersion": 1,
      "position": [
        2432,
        2320
      ],
      "id": "aead4a39-7008-4576-a2c8-04068e591037",
      "name": "Get Ad Set Insights",
      "credentials": {
        "facebookGraphApi": {
          "id": "qyqXK2BX1VsAfqgn",
          "name": "Facebook Graph account"
        }
      }
    },
    {
      "parameters": {
        "operation": "appendOrUpdate",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/11goRNwLFTj7D2LbEEPfbjmSBfqr3c-6y_7QuzMMPZZU/edit?gid=0#gid=0",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "Arkusz1",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11goRNwLFTj7D2LbEEPfbjmSBfqr3c-6y_7QuzMMPZZU/edit#gid=0"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {}
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        2960,
        2640
      ],
      "id": "a8ff9720-24d0-41ca-8a07-1a3f718d4f37",
      "name": "Update Ad Data",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "n1lRTD7tyH1UVxfn",
          "name": "Google Sheets-macaipiotr@gmail.com"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        2048,
        2320
      ],
      "id": "5c29015f-8364-458d-9137-0318703eede3",
      "name": "Split Ad Sets"
    },
    {
      "parameters": {
        "graphApiVersion": "v23.0",
        "node": "={{ $json.data[0].id }}",
        "edge": "insights",
        "options": {
          "fields": {
            "field": [
              {
                "name": "ad_id,ad_name,adset_id,adset_name,campaign_id,campaign_name,impressions,clicks,spend,cpc,cpm,ctr,reach,frequency,conversions,conversion_values,cost_per_conversion,purchase_roas"
              }
            ]
          }
        }
      },
      "type": "n8n-nodes-base.facebookGraphApi",
      "typeVersion": 1,
      "position": [
        2448,
        2640
      ],
      "id": "1075184d-26db-4fd1-96cf-45ff780f0994",
      "name": "Get Ad Insights",
      "credentials": {
        "facebookGraphApi": {
          "id": "qyqXK2BX1VsAfqgn",
          "name": "Facebook Graph account"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        2048,
        2704
      ],
      "id": "986932c8-991e-4b38-b247-294064ac4b59",
      "name": "Split Ads"
    },
    {
      "parameters": {
        "jsCode": "// Helper functions\nconst formatCurrency = (value) => {\n  return new Intl.NumberFormat('en-US', {\n    style: 'currency',\n    currency: 'USD',\n    minimumFractionDigits: 2,\n    maximumFractionDigits: 2\n  }).format(value || 0);\n};\n\nconst formatNumber = (value) => {\n  return new Intl.NumberFormat('en-US').format(value || 0);\n};\n\nconst formatPercent = (value) => {\n  return `${(value || 0).toFixed(2)}%`;\n};\n\n// Get campaign data (from Format Campaign data node)\nconst campaignData = $('Format Campaign data').item.json;\n\n// Get all ad set data items\nconst adSetItems = $('Format Ad Set Data').all();\n\n// Get all ad data items  \nconst adItems = $('Code in JavaScript2').all();\n\n// Calculate totals across all ad sets\nlet totalAdSetSpend = 0;\nlet totalAdSetConversions = 0;\nlet totalAdSetImpressions = 0;\n\nadSetItems.forEach(item => {\n  totalAdSetSpend += item.json.spend || 0;\n  totalAdSetConversions += item.json.conversions || 0;\n  totalAdSetImpressions += item.json.impressions || 0;\n});\n\n// Calculate totals across all ads\nlet totalAdSpend = 0;\nlet totalAdConversions = 0;\nlet totalAdImpressions = 0;\n\nadItems.forEach(item => {\n  totalAdSpend += item.json.spend || 0;\n  totalAdConversions += item.json.conversions || 0;\n  totalAdImpressions += item.json.impressions || 0;\n});\n\n// Build Slack message blocks\nconst blocks = [\n  {\n    \"type\": \"header\",\n    \"text\": {\n      \"type\": \"plain_text\",\n      \"text\": \"📊 Meta Ads Data Update\",\n      \"emoji\": true\n    }\n  },\n  {\n    \"type\": \"section\",\n    \"text\": {\n      \"type\": \"mrkdwn\",\n      \"text\": `*Update Time:* ${campaignData.last_updated || campaignData.date || new Date().toISOString()}`\n    }\n  },\n  {\n    \"type\": \"divider\"\n  },\n  {\n    \"type\": \"section\",\n    \"text\": {\n      \"type\": \"mrkdwn\",\n      \"text\": \"*🎯 Campaign Overview*\"\n    }\n  },\n  {\n    \"type\": \"section\",\n    \"fields\": [\n      {\n        \"type\": \"mrkdwn\",\n        \"text\": `*Campaign:*\\n${campaignData.campaign_name || 'N/A'}`\n      },\n      {\n        \"type\": \"mrkdwn\",\n        \"text\": `*Status:*\\n${campaignData.status || 'N/A'}`\n      },\n      {\n        \"type\": \"mrkdwn\",\n        \"text\": `*Spend:*\\n${formatCurrency(campaignData.spend)}`\n      },\n      {\n        \"type\": \"mrkdwn\",\n        \"text\": `*Conversions:*\\n${formatNumber(campaignData.conversions)}`\n      },\n      {\n        \"type\": \"mrkdwn\",\n        \"text\": `*Impressions:*\\n${formatNumber(campaignData.impressions)}`\n      },\n      {\n        \"type\": \"mrkdwn\",\n        \"text\": `*Clicks:*\\n${formatNumber(campaignData.clicks)}`\n      },\n      {\n        \"type\": \"mrkdwn\",\n        \"text\": `*CTR:*\\n${formatPercent(campaignData.ctr)}`\n      },\n      {\n        \"type\": \"mrkdwn\",\n        \"text\": `*CPC:*\\n${formatCurrency(campaignData.cpc)}`\n      },\n      {\n        \"type\": \"mrkdwn\",\n        \"text\": `*CPM:*\\n${formatCurrency(campaignData.cpm)}`\n      },\n      {\n        \"type\": \"mrkdwn\",\n        \"text\": `*ROAS:*\\n${(campaignData.roas || 0).toFixed(2)}x`\n      }\n    ]\n  },\n  {\n    \"type\": \"divider\"\n  },\n  {\n    \"type\": \"section\",\n    \"text\": {\n      \"type\": \"mrkdwn\",\n      \"text\": `*📈 Ad Set Summary* (${adSetItems.length} ad sets)`\n    }\n  },\n  {\n    \"type\": \"section\",\n    \"fields\": [\n      {\n        \"type\": \"mrkdwn\",\n        \"text\": `*Total Spend:*\\n${formatCurrency(totalAdSetSpend)}`\n      },\n      {\n        \"type\": \"mrkdwn\",\n        \"text\": `*Total Conversions:*\\n${formatNumber(totalAdSetConversions)}`\n      },\n      {\n        \"type\": \"mrkdwn\",\n        \"text\": `*Total Impressions:*\\n${formatNumber(totalAdSetImpressions)}`\n      },\n      {\n        \"type\": \"mrkdwn\",\n        \"text\": `*Avg CPM:*\\n${formatCurrency(totalAdSetImpressions > 0 ? (totalAdSetSpend / totalAdSetImpressions) * 1000 : 0)}`\n      }\n    ]\n  },\n  {\n    \"type\": \"divider\"\n  },\n  {\n    \"type\": \"section\",\n    \"text\": {\n      \"type\": \"mrkdwn\",\n      \"text\": `*🎨 Ad Summary* (${adItems.length} ads)`\n    }\n  },\n  {\n    \"type\": \"section\",\n    \"fields\": [\n      {\n        \"type\": \"mrkdwn\",\n        \"text\": `*Total Spend:*\\n${formatCurrency(totalAdSpend)}`\n      },\n      {\n        \"type\": \"mrkdwn\",\n        \"text\": `*Total Conversions:*\\n${formatNumber(totalAdConversions)}`\n      },\n      {\n        \"type\": \"mrkdwn\",\n        \"text\": `*Total Impressions:*\\n${formatNumber(totalAdImpressions)}`\n      },\n      {\n        \"type\": \"mrkdwn\",\n        \"text\": `*Avg CPM:*\\n${formatCurrency(totalAdImpressions > 0 ? (totalAdSpend / totalAdImpressions) * 1000 : 0)}`\n      }\n    ]\n  },\n  {\n    \"type\": \"divider\"\n  },\n  {\n    \"type\": \"context\",\n    \"elements\": [\n      {\n        \"type\": \"mrkdwn\",\n        \"text\": \"✅ Data successfully synced to Google Sheets\"\n      }\n    ]\n  }\n];\n\n// Return formatted data for Slack\nreturn {\n  blocks: blocks,\n  text: `Meta Ads Update: ${campaignData.campaign_name} - Spend: ${formatCurrency(campaignData.spend)} | Conversions: ${formatNumber(campaignData.conversions)} | ROAS: ${(campaignData.roas || 0).toFixed(2)}x`\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2928,
        2112
      ],
      "id": "3a7d2b18-0332-488a-8e99-61b31bd323ed",
      "name": "Code in JavaScript1"
    },
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "hours"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.2,
      "position": [
        896,
        2352
      ],
      "id": "f77c93e9-0e59-4210-afeb-ef2b6e6fb921",
      "name": "Schedule Trigger4"
    },
    {
      "parameters": {
        "jsCode": "const adData = $json.data?.[0] || {};\nconst adDetails = $('Split Ads').item.json;\nconst timestamp = $('Set Campaign Config').item.json.timestamp;\nconst date = $('Set Campaign Config').item.json.date;\n\nreturn {\n  campaign_id: adData.campaign_id || adDetails.campaign_id,\n  campaign_name: adData.campaign_name || '',\n  adset_id: adData.adset_id || adDetails.adset_id,\n  adset_name: adData.adset_name || '',\n  ad_id: adData.ad_id || adDetails.id,\n  ad_name: adData.ad_name || adDetails.name,\n  status: adDetails.status,\n  impressions: parseFloat(adData.impressions || 0),\n  clicks: parseFloat(adData.clicks || 0),\n  spend: parseFloat(adData.spend || 0),\n  cpc: parseFloat(adData.cpc || 0),\n  cpm: parseFloat(adData.cpm || 0),\n  ctr: parseFloat(adData.ctr || 0),\n  reach: parseFloat(adData.reach || 0),\n  frequency: parseFloat(adData.frequency || 0),\n  conversions: parseFloat(adData.conversions || 0),\n  conversion_value: parseFloat(adData.conversion_values || 0),\n  cost_per_conversion: parseFloat(adData.cost_per_conversion || 0),\n  roas: parseFloat(adData.purchase_roas?.[0]?.value || 0),\n  last_updated: timestamp,\n  date: date\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2736,
        2640
      ],
      "id": "da97b788-7826-435a-8581-f15f063bdb01",
      "name": "Code in JavaScript2"
    },
    {
      "parameters": {
        "numberInputs": 3
      },
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        2416,
        2096
      ],
      "id": "84b4a294-2bcd-4b5a-84ed-4356d7338395",
      "name": "Merge6"
    },
    {
      "parameters": {
        "operation": "appendOrUpdate",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1h_qfPoHZ7q8KG2gits5TETXCtj9In2hW44Wft-Y3lPI/edit?gid=0#gid=0",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "Arkusz1",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1h_qfPoHZ7q8KG2gits5TETXCtj9In2hW44Wft-Y3lPI/edit#gid=0"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "date": "={{ $json.date }}",
            "pageScreenView": "={{ $json.screenPageViews }}",
            "totalUsers": "={{ $json.totalUsers }}",
            "sessions": "={{ $json.sessions }}",
            "sessionsPerUser": "={{ $json.sessionsPerUser }}",
            "eventCount": "={{ $json.eventCount }}",
            "active7DaysUsers": "={{ $json.active7DayUsers }}"
          },
          "matchingColumns": [
            "date"
          ],
          "schema": [
            {
              "id": "date",
              "displayName": "date",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pageScreenView",
              "displayName": "pageScreenView",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "totalUsers",
              "displayName": "totalUsers",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "sessions",
              "displayName": "sessions",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "sessionsPerUser",
              "displayName": "sessionsPerUser",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "eventCount",
              "displayName": "eventCount",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "active7DaysUsers",
              "displayName": "active7DaysUsers",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        1312,
        1008
      ],
      "id": "c8244f41-19f7-45f6-a1ac-1dd12ec79b7d",
      "name": "Append or update row in sheet1",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "n1lRTD7tyH1UVxfn",
          "name": "Google Sheets-macaipiotr@gmail.com"
        }
      }
    },
    {
      "parameters": {
        "operation": "appendOrUpdate",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/11goRNwLFTj7D2LbEEPfbjmSBfqr3c-6y_7QuzMMPZZU/edit?gid=0#gid=0",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "Arkusz1",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11goRNwLFTj7D2LbEEPfbjmSBfqr3c-6y_7QuzMMPZZU/edit#gid=0"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {}
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        9072,
        3104
      ],
      "id": "6c855b5d-be16-4df6-8f21-5c727d8dd209",
      "name": "Append or update row in sheet3",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "n1lRTD7tyH1UVxfn",
          "name": "Google Sheets-macaipiotr@gmail.com"
        }
      }
    },
    {
      "parameters": {
        "operation": "createFromText",
        "name": "Summary Report: ",
        "driveId": {
          "__rl": true,
          "mode": "list",
          "value": "My Drive"
        },
        "folderId": {
          "__rl": true,
          "value": "https://drive.google.com/drive/folders/1Q_vTLR8y7InyYxtLjY9isS7VdOqC8hdB",
          "mode": "url"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        5280,
        1552
      ],
      "id": "c57daef5-75ac-4688-8f2d-c4e1468d5b76",
      "name": "Create file from text3",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "IYt9e9Ocdig5ushn",
          "name": "Drive-macaipiotr@gmail.com"
        }
      }
    },
    {
      "parameters": {
        "options": {
          "responseMode": "lastNode"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.chatTrigger",
      "typeVersion": 1.4,
      "position": [
        1664,
        432
      ],
      "id": "c6c70d37-adff-4388-be33-e6257214140e",
      "name": "When chat message received",
      "webhookId": "ce17545f-b466-4fee-9156-6b8c82c29f0a"
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "11goRNwLFTj7D2LbEEPfbjmSBfqr3c-6y_7QuzMMPZZU",
          "mode": "list",
          "cachedResultName": "360Marketing_Ainsider_MetaAdsData",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11goRNwLFTj7D2LbEEPfbjmSBfqr3c-6y_7QuzMMPZZU/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "Arkusz1",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11goRNwLFTj7D2LbEEPfbjmSBfqr3c-6y_7QuzMMPZZU/edit#gid=0"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheetsTool",
      "typeVersion": 4.7,
      "position": [
        2192,
        656
      ],
      "id": "68064e05-dee0-45ab-a713-a6cdde78df69",
      "name": "MetaAdsData",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "n1lRTD7tyH1UVxfn",
          "name": "Google Sheets-macaipiotr@gmail.com"
        }
      }
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "11goRNwLFTj7D2LbEEPfbjmSBfqr3c-6y_7QuzMMPZZU",
          "mode": "list",
          "cachedResultName": "360Marketing_Ainsider_MetaAdsData",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11goRNwLFTj7D2LbEEPfbjmSBfqr3c-6y_7QuzMMPZZU/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "Arkusz1",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11goRNwLFTj7D2LbEEPfbjmSBfqr3c-6y_7QuzMMPZZU/edit#gid=0"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheetsTool",
      "typeVersion": 4.7,
      "position": [
        2048,
        672
      ],
      "id": "e40e4b4e-7239-4727-94ee-57f2358e652a",
      "name": "GoogleAdsData",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "n1lRTD7tyH1UVxfn",
          "name": "Google Sheets-macaipiotr@gmail.com"
        }
      }
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "11goRNwLFTj7D2LbEEPfbjmSBfqr3c-6y_7QuzMMPZZU",
          "mode": "list",
          "cachedResultName": "360Marketing_Ainsider_MetaAdsData",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11goRNwLFTj7D2LbEEPfbjmSBfqr3c-6y_7QuzMMPZZU/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "Arkusz1",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11goRNwLFTj7D2LbEEPfbjmSBfqr3c-6y_7QuzMMPZZU/edit#gid=0"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheetsTool",
      "typeVersion": 4.7,
      "position": [
        2336,
        656
      ],
      "id": "5d74d537-c50d-4f45-97f3-7dfafc0d5dc2",
      "name": "GoogleAnalyticData",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "n1lRTD7tyH1UVxfn",
          "name": "Google Sheets-macaipiotr@gmail.com"
        }
      }
    },
    {
      "parameters": {
        "resource": "fileFolder",
        "queryString": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Search_Query', ``, 'string') }}",
        "filter": {
          "folderId": {
            "__rl": true,
            "value": "1OSjTiWTfgMrZ-PLGCIS8YtNXCE-xwUBc",
            "mode": "list",
            "cachedResultName": "360MarketingReports_AinsiderClientData",
            "cachedResultUrl": "https://drive.google.com/drive/folders/1OSjTiWTfgMrZ-PLGCIS8YtNXCE-xwUBc"
          }
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleDriveTool",
      "typeVersion": 3,
      "position": [
        1904,
        672
      ],
      "id": "ee6d5c99-2e68-4c13-887c-bac30cb8618b",
      "name": "SearchGoogleDrive",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "IYt9e9Ocdig5ushn",
          "name": "Drive-macaipiotr@gmail.com"
        }
      }
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "marketing-agent",
        "responseMode": "responseNode",
        "options": {}
      },
      "id": "79970d8c-37b0-45fb-9119-4faa099a40d8",
      "name": "Webhook Trigger",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 1,
      "position": [
        1520,
        -480
      ],
      "webhookId": "marketing-agent-chat"
    },
    {
      "parameters": {
        "options": {}
      },
      "id": "bcd42935-c0a6-4897-9967-ffab4ae1c581",
      "name": "Extract Query",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3,
      "position": [
        1744,
        -480
      ]
    },
    {
      "parameters": {
        "name": "search_google_drive_reports",
        "description": "Search and read marketing report text files from Google Drive. Use this to get detailed report content.",
        "workflowId": "={{ $('Webhook Trigger').item.json.workflow_id }}",
        "fields": {
          "values": [
            {
              "name": "search_query"
            },
            {
              "name": "date_range"
            }
          ]
        }
      },
      "id": "e5ff3fc2-bc3f-4ad1-844c-065e6ba9d155",
      "name": "Tool: Search Drive Reports",
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 1,
      "position": [
        2112,
        -192
      ]
    },
    {
      "parameters": {
        "name": "query_google_sheets",
        "description": "Query Google Sheets containing GA4 and Meta Ads data. Use this for numerical analysis and data aggregation.",
        "workflowId": "={{ $('Webhook Trigger').item.json.workflow_id }}",
        "fields": {
          "values": [
            {
              "name": "sheet_name"
            },
            {
              "name": "query_type"
            },
            {
              "name": "filters"
            }
          ]
        }
      },
      "id": "b22b2848-dd57-4489-9844-0d6e0855dc34",
      "name": "Tool: Query Sheets Data",
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 1,
      "position": [
        2272,
        -192
      ]
    },
    {
      "parameters": {},
      "id": "a677a33c-5f76-49cf-af06-ebceb093f313",
      "name": "Conversation Memory",
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1,
      "position": [
        1968,
        -192
      ]
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{ {\n  \"response\": $json.output,\n  \"session_id\": $('Extract Query').item.json.session_id,\n  \"timestamp\": $now.toISO()\n} }}",
        "options": {}
      },
      "id": "e4f6c4d9-1bee-477f-9301-e9f0c8560262",
      "name": "Respond to Webhook",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1,
      "position": [
        2368,
        -480
      ]
    },
    {
      "parameters": {
        "text": "=You are a Marketing Data Analyst AI assistant. You have access to:\n\n1. Marketing reports stored as text files in Google Drive\n2. Google Analytics data in Google Sheets\n3. Meta Ads data in Google Sheets\n4. Google Ads data\n\nYour role is to:\n- Answer questions about marketing performance\n- Provide insights from the data\n- Compare metrics across channels\n- Identify trends and anomalies\n- Make data-driven recommendations\n\nCurrent user query: {{ $json.user_query }}\n\nWhen answering:\n- Be specific with numbers and dates\n- Cite which data source you're using\n- Provide context for metrics\n- Suggest actionable insights",
        "options": {
          "systemMessage": "You are a helpful marketing analytics AI agent with access to Google Analytics, Google Ads, and Meta Ads data."
        }
      },
      "id": "b5d8064f-aab0-4300-b69f-4b51748b5b1f",
      "name": "AI Agent1",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.1,
      "position": [
        1968,
        -480
      ]
    },
    {
      "parameters": {},
      "id": "55adc824-28dc-4636-ab4f-c91725621703",
      "name": "Execute Workflow Trigger",
      "type": "n8n-nodes-base.executeWorkflowTrigger",
      "typeVersion": 1,
      "position": [
        2784,
        -496
      ]
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "your-document-id",
          "mode": "list"
        },
        "sheetName": {
          "__rl": true,
          "mode": "list",
          "value": ""
        }
      },
      "id": "a74445a8-4849-4c2b-a47d-4d2ac2315fb0",
      "name": "Read Google Sheets",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4,
      "position": [
        2992,
        -496
      ]
    },
    {
      "parameters": {
        "jsCode": "// Process and query the sheets data\nconst items = $input.all();\nconst queryType = $('Execute Workflow Trigger').item.json.query_type;\nconst filters = $('Execute Workflow Trigger').item.json.filters || {};\n\n// Convert sheet data to array of objects\nconst headers = items[0]?.json || {};\nconst data = items.slice(1).map(item => item.json);\n\nlet result = {};\n\nswitch(queryType) {\n  case 'summary':\n    // Calculate summary statistics\n    result = {\n      total_records: data.length,\n      date_range: {\n        start: data[0]?.date,\n        end: data[data.length - 1]?.date\n      },\n      metrics: calculateMetrics(data, filters)\n    };\n    break;\n    \n  case 'trend':\n    // Return time series data\n    result = {\n      trends: data.map(row => ({\n        date: row.date,\n        metrics: extractMetrics(row, filters.metrics)\n      }))\n    };\n    break;\n    \n  case 'comparison':\n    // Compare channels or periods\n    result = {\n      comparison: compareData(data, filters)\n    };\n    break;\n    \n  case 'top_performers':\n    // Get top performing items\n    result = {\n      top_items: getTopPerformers(data, filters.metric, filters.limit || 10)\n    };\n    break;\n    \n  default:\n    // Return filtered raw data\n    result = {\n      data: filterData(data, filters)\n    };\n}\n\n// Helper functions\nfunction calculateMetrics(data, filters) {\n  const metrics = {};\n  \n  // Calculate key metrics\n  if (data[0]?.sessions) {\n    metrics.total_sessions = data.reduce((sum, row) => sum + (parseFloat(row.sessions) || 0), 0);\n  }\n  if (data[0]?.users) {\n    metrics.total_users = data.reduce((sum, row) => sum + (parseFloat(row.users) || 0), 0);\n  }\n  if (data[0]?.revenue) {\n    metrics.total_revenue = data.reduce((sum, row) => sum + (parseFloat(row.revenue) || 0), 0);\n  }\n  if (data[0]?.conversions) {\n    metrics.total_conversions = data.reduce((sum, row) => sum + (parseFloat(row.conversions) || 0), 0);\n  }\n  if (data[0]?.spend) {\n    metrics.total_spend = data.reduce((sum, row) => sum + (parseFloat(row.spend) || 0), 0);\n    if (metrics.total_revenue) {\n      metrics.roas = (metrics.total_revenue / metrics.total_spend).toFixed(2);\n    }\n  }\n  \n  return metrics;\n}\n\nfunction extractMetrics(row, metricNames) {\n  const metrics = {};\n  (metricNames || Object.keys(row)).forEach(metric => {\n    if (row[metric]) metrics[metric] = row[metric];\n  });\n  return metrics;\n}\n\nfunction compareData(data, filters) {\n  const channel = filters.channel || 'source';\n  const grouped = {};\n  \n  data.forEach(row => {\n    const key = row[channel];\n    if (!grouped[key]) grouped[key] = [];\n    grouped[key].push(row);\n  });\n  \n  return Object.entries(grouped).map(([key, rows]) => ({\n    [channel]: key,\n    metrics: calculateMetrics(rows, filters)\n  }));\n}\n\nfunction getTopPerformers(data, metric, limit) {\n  return data\n    .sort((a, b) => (parseFloat(b[metric]) || 0) - (parseFloat(a[metric]) || 0))\n    .slice(0, limit);\n}\n\nfunction filterData(data, filters) {\n  let filtered = data;\n  \n  if (filters.date_from) {\n    filtered = filtered.filter(row => new Date(row.date) >= new Date(filters.date_from));\n  }\n  if (filters.date_to) {\n    filtered = filtered.filter(row => new Date(row.date) <= new Date(filters.date_to));\n  }\n  \n  Object.entries(filters).forEach(([key, value]) => {\n    if (!['date_from', 'date_to', 'metrics'].includes(key)) {\n      filtered = filtered.filter(row => row[key] === value);\n    }\n  });\n  \n  return filtered.slice(0, 100); // Limit results\n}\n\nreturn [{ json: result }];"
      },
      "id": "45be94ec-7af5-40fe-a3b4-05d646ea562a",
      "name": "Process Query",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        3200,
        -496
      ]
    },
    {
      "parameters": {
        "options": {}
      },
      "id": "5bfd8f83-2faa-4a13-a8a9-5c4c7de0957d",
      "name": "Return to AI Agent",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3,
      "position": [
        3392,
        -496
      ]
    },
    {
      "parameters": {
        "operation": "search"
      },
      "id": "3a55dcd7-caec-4ce2-9fb8-4b11c380983f",
      "name": "Search Google Drive",
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        2800,
        -288
      ]
    },
    {
      "parameters": {
        "operation": "download",
        "fileId": {
          "__rl": true,
          "value": "={{ $json.id }}",
          "mode": "id"
        },
        "options": {
          "googleFileConversion": {
            "conversion": {
              "docsToFormat": "text/plain"
            }
          }
        }
      },
      "id": "2b3387ef-bb43-43fd-97e6-d730f23bfd9e",
      "name": "Download Report Files",
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        2992,
        -288
      ]
    },
    {
      "parameters": {
        "jsCode": "// Extract and format report content\nconst items = $input.all();\nconst results = [];\n\nfor (const item of items) {\n  const fileName = item.json.name;\n  const content = item.binary?.data ? \n    Buffer.from(item.binary.data.data, 'base64').toString('utf-8') : \n    '';\n  \n  results.push({\n    file_name: fileName,\n    content: content,\n    modified: item.json.modifiedTime,\n    summary: content.substring(0, 500) + '...'\n  });\n}\n\nreturn results.map(r => ({ json: r }));"
      },
      "id": "33fd0ca9-cce3-42ab-87c6-31be9529d61d",
      "name": "Format Results",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        3248,
        -288
      ]
    },
    {
      "parameters": {
        "options": {}
      },
      "id": "19e72762-8875-45c4-8ec2-c910904dcce8",
      "name": "Return to AI Agent1",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3,
      "position": [
        3440,
        -288
      ]
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        1808,
        -192
      ],
      "id": "c673a806-4c87-4af7-85c2-f4b20842d1fe",
      "name": "Google Gemini Chat Model6",
      "credentials": {
        "googlePalmApi": {
          "id": "lumSp9bfirbMB8Vi",
          "name": "GeminiAPI"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        1744,
        672
      ],
      "id": "da72a1b3-496d-4e3f-8675-bee53ccbda83",
      "name": "Google Gemini Chat Model7",
      "credentials": {
        "googlePalmApi": {
          "id": "lumSp9bfirbMB8Vi",
          "name": "GeminiAPI"
        }
      }
    },
    {
      "parameters": {
        "content": "## Main Workflow: Weekly Report Assistant",
        "height": 732,
        "width": 2756,
        "color": 7
      },
      "id": "f320a2cf-44c7-40dc-af9d-c1a357d948de",
      "name": "Sticky Note10",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        1328,
        -576
      ],
      "typeVersion": 1
    }
  ],
  "pinData": {},
  "connections": {
    "Calculator": {
      "ai_tool": [
        [
          {
            "node": "GA_Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Calculator1": {
      "ai_tool": [
        [
          {
            "node": "GoogleAds_Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Calculator3": {
      "ai_tool": [
        [
          {
            "node": "AI Agent5",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Weekly Report Agent": {
      "main": [
        []
      ]
    },
    "Format all Google data for LLM": {
      "main": [
        [
          {
            "node": "GoogleAds_Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Summarize input (current year)": {
      "main": [
        [
          {
            "node": "Format all Google data for LLM",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Call Meta Ads Data: Last 7 days": {
      "main": [
        [
          {
            "node": "Assign Meta data from input (current year)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Format data input (current year)": {
      "main": [
        [
          {
            "node": "Assign data from input (current year)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Call Google Ads Data: Last 7 days": {
      "main": [
        [
          {
            "node": "Format data input (current year)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Summarize Meta input (current year)": {
      "main": [
        [
          {
            "node": "AI Agent5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Assign data from input (current year)": {
      "main": [
        [
          {
            "node": "Summarize input (current year)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Call Google Analytics data: Last 7 days": {
      "main": [
        [
          {
            "node": "Append or update row in sheet1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Assign Meta data from input (current year)": {
      "main": [
        [
          {
            "node": "Summarize Meta input (current year)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Calculate date format for meta ads request s": {
      "main": [
        [
          {
            "node": "Call Meta Ads Data: Last 7 days",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Calculate date format for Google Ads request (last 7 days)": {
      "main": [
        [
          {
            "node": "Call Google Ads Data: Last 7 days",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "When clicking ‘Execute workflow’": {
      "main": [
        [
          {
            "node": "Date & Time",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Date & Time": {
      "main": [
        [
          {
            "node": "Create folder",
            "type": "main",
            "index": 0
          },
          {
            "node": "Set Campaign Config",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Create folder": {
      "main": [
        [
          {
            "node": "Edit Fields1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Processing for Google Analytics Report": {
      "main": [
        []
      ]
    },
    "Processing for Google Ads report": {
      "main": [
        []
      ]
    },
    "Processing for Meta Ads Report": {
      "main": [
        []
      ]
    },
    "Create file from text1": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Create file from text": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Create file from text2": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 2
          }
        ]
      ]
    },
    "Merge": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "GA4 - Session Channel Group": {
      "main": [
        [
          {
            "node": "BQ - ga4_data_session_channel_group",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "BQ - ga4_data_session_channel_group": {
      "main": [
        [
          {
            "node": "Merge2",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "GA4 - Session Source/Campaign/Medium": {
      "main": [
        [
          {
            "node": "BQ - ga4_data_session_source_campaign_medium",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "BQ - ga4_data_session_source_campaign_medium": {
      "main": [
        [
          {
            "node": "Merge2",
            "type": "main",
            "index": 2
          }
        ]
      ]
    },
    "GA4 - Country/Language/City": {
      "main": [
        [
          {
            "node": "BQ - ga4_data_country_language_city",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "BQ - ga4_data_country_language_city": {
      "main": [
        [
          {
            "node": "Merge2",
            "type": "main",
            "index": 3
          }
        ]
      ]
    },
    "GA4 - Item Name": {
      "main": [
        [
          {
            "node": "BQ - ga4_data_item_name",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "BQ - ga4_data_item_name": {
      "main": [
        [
          {
            "node": "Merge2",
            "type": "main",
            "index": 4
          }
        ]
      ]
    },
    "GA4 - Browser/OS/Device": {
      "main": [
        [
          {
            "node": "BQ - ga4_data_browser_os_device",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "BQ - ga4_data_browser_os_device": {
      "main": [
        [
          {
            "node": "Merge2",
            "type": "main",
            "index": 5
          }
        ]
      ]
    },
    "GA4 - First User Source/Medium": {
      "main": [
        [
          {
            "node": "BQ - ga4_data_first_user_source_medium",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "BQ - ga4_data_first_user_source_medium": {
      "main": [
        [
          {
            "node": "Merge2",
            "type": "main",
            "index": 6
          }
        ]
      ]
    },
    "GA4 - First User Channel Group": {
      "main": [
        [
          {
            "node": "BQ - ga4_data_first_user_channel_group",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "BQ - ga4_data_first_user_channel_group": {
      "main": [
        [
          {
            "node": "Merge2",
            "type": "main",
            "index": 7
          }
        ]
      ]
    },
    "GA4 - Ads Data": {
      "main": [
        [
          {
            "node": "BQ - ga4_ads_data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "BQ - ga4_ads_data": {
      "main": [
        [
          {
            "node": "Merge2",
            "type": "main",
            "index": 8
          }
        ]
      ]
    },
    "GA4 - All Metrics": {
      "main": [
        [
          {
            "node": "BQ - ga4_all_metrics_data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "BQ - ga4_all_metrics_data": {
      "main": [
        [
          {
            "node": "Merge2",
            "type": "main",
            "index": 9
          }
        ]
      ]
    },
    "GA4 - Event Metrics": {
      "main": [
        [
          {
            "node": "BQ - ga4_event_metrics_data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "BQ - ga4_event_metrics_data": {
      "main": [
        [
          {
            "node": "Merge1",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "GA4 - Page Location": {
      "main": [
        [
          {
            "node": "BQ - ga4_page_location_data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "BQ - ga4_page_location_data": {
      "main": [
        [
          {
            "node": "Merge1",
            "type": "main",
            "index": 2
          }
        ]
      ]
    },
    "GA4 - Landing Page": {
      "main": [
        [
          {
            "node": "BQ - ga4_landing_page_data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "GA4 - Transaction Items": {
      "main": [
        [
          {
            "node": "BQ - ga4_transaction_items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "BQ - ga4_transaction_items": {
      "main": [
        [
          {
            "node": "Merge2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Backfill Config": {
      "main": [
        [
          {
            "node": "GA4 - Transaction Items",
            "type": "main",
            "index": 0
          },
          {
            "node": "GA4 - Session Channel Group",
            "type": "main",
            "index": 0
          },
          {
            "node": "GA4 - Session Source/Campaign/Medium",
            "type": "main",
            "index": 0
          },
          {
            "node": "GA4 - Country/Language/City",
            "type": "main",
            "index": 0
          },
          {
            "node": "GA4 - Item Name",
            "type": "main",
            "index": 0
          },
          {
            "node": "GA4 - Browser/OS/Device",
            "type": "main",
            "index": 0
          },
          {
            "node": "GA4 - First User Source/Medium",
            "type": "main",
            "index": 0
          },
          {
            "node": "GA4 - First User Channel Group",
            "type": "main",
            "index": 0
          },
          {
            "node": "GA4 - Ads Data",
            "type": "main",
            "index": 0
          },
          {
            "node": "GA4 - All Metrics",
            "type": "main",
            "index": 0
          },
          {
            "node": "GA4 - Event Metrics",
            "type": "main",
            "index": 0
          },
          {
            "node": "GA4 - Page Location",
            "type": "main",
            "index": 0
          },
          {
            "node": "GA4 - Landing Page",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "BQ - ga4_landing_page_data": {
      "main": [
        [
          {
            "node": "Merge1",
            "type": "main",
            "index": 3
          }
        ]
      ]
    },
    "Merge1": {
      "main": [
        [
          {
            "node": "Code",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code": {
      "main": [
        [
          {
            "node": "Send a text message",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Schedule Trigger1": {
      "main": [
        [
          {
            "node": "Backfill Config",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge2": {
      "main": [
        [
          {
            "node": "Merge1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch": {
      "main": [
        [
          {
            "node": "graph: adaccounts",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "fix missing act_",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Edit Fields",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "account: campaigns": {
      "main": [
        [
          {
            "node": "Append or update row in sheet3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "account: adsets": {
      "main": [
        [
          {
            "node": "Merge3",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "account: ads": {
      "main": [
        [
          {
            "node": "Merge3",
            "type": "main",
            "index": 2
          }
        ]
      ]
    },
    "Edit Fields": {
      "main": [
        [
          {
            "node": "ads: insights",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "since, until": {
      "main": [
        [
          {
            "node": "Switch",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "fix missing act_": {
      "main": [
        [
          {
            "node": "account: campaigns",
            "type": "main",
            "index": 0
          },
          {
            "node": "account: adsets",
            "type": "main",
            "index": 0
          },
          {
            "node": "account: ads",
            "type": "main",
            "index": 0
          },
          {
            "node": "account insights",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "account insights": {
      "main": [
        [
          {
            "node": "Merge3",
            "type": "main",
            "index": 3
          }
        ]
      ]
    },
    "ads: insights": {
      "main": [
        [
          {
            "node": "Code1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge3": {
      "main": [
        [
          {
            "node": "Code2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get many campaigns": {
      "ai_tool": [
        [
          {
            "node": "Google Ads Tool MCP Server",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Get a campaign": {
      "ai_tool": [
        [
          {
            "node": "Google Ads Tool MCP Server",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Monthly Trigger": {
      "main": [
        [
          {
            "node": "Get Performance Data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Performance Data": {
      "main": [
        [
          {
            "node": "Prepare Performance Data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Prepare Performance Data": {
      "main": [
        [
          {
            "node": "AI Agent - Analyze Performance",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent - Analyze Performance": {
      "main": [
        [
          {
            "node": "Generate Report",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Generate Report": {
      "main": [
        [
          {
            "node": "Save Report to Sheets",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Save Report to Sheets": {
      "main": [
        [
          {
            "node": "Send Report",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model2": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent - Analyze Performance",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Get a campaign1": {
      "main": [
        [
          {
            "node": "Append or update row in sheet2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields1": {
      "main": [
        [
          {
            "node": "Get a campaign1",
            "type": "main",
            "index": 0
          },
          {
            "node": "Calculate date format for Google Ads request (last 7 days)",
            "type": "main",
            "index": 0
          },
          {
            "node": "Call Google Analytics data: Last 7 days",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model1": {
      "ai_languageModel": [
        [
          {
            "node": "GoogleAds_Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model2": {
      "ai_languageModel": [
        [
          {
            "node": "GA_Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent5": {
      "main": [
        []
      ]
    },
    "Google Gemini Chat Model3": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent5",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Code2": {
      "main": [
        [
          {
            "node": "Merge4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code1": {
      "main": [
        [
          {
            "node": "Merge4",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Merge4": {
      "main": [
        [
          {
            "node": "AI Agent6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent6": {
      "main": [
        []
      ]
    },
    "Schedule Trigger2": {
      "main": [
        [
          {
            "node": "SetMetaIDs",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "since, until1": {
      "main": [
        []
      ]
    },
    "SetMetaIDs": {
      "main": [
        [
          {
            "node": "MetaGraphAPI",
            "type": "main",
            "index": 0
          },
          {
            "node": "graph: adaccounts1",
            "type": "main",
            "index": 0
          },
          {
            "node": "account insights1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "MetaGraphAPI": {
      "main": [
        [
          {
            "node": "meta_Ad",
            "type": "main",
            "index": 0
          },
          {
            "node": "meta_campaign",
            "type": "main",
            "index": 0
          },
          {
            "node": "meta_adSets",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model4": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent6",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Calculator2": {
      "ai_tool": [
        [
          {
            "node": "AI Agent6",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Google Analytics Data": {
      "main": [
        [
          {
            "node": "Format Report",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Ads Data": {
      "main": [
        [
          {
            "node": "Format Report",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Facebook Ads Data": {
      "main": [
        [
          {
            "node": "Format Report",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Facebook Page Engagement": {
      "main": [
        [
          {
            "node": "Format Report",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Format Report": {
      "main": [
        [
          {
            "node": "Save Report to Google Drive",
            "type": "main",
            "index": 0
          },
          {
            "node": "Send Email via Gmail",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Schedule Trigger3": {
      "main": [
        [
          {
            "node": "Google Analytics Data",
            "type": "main",
            "index": 0
          },
          {
            "node": "Google Ads Data",
            "type": "main",
            "index": 0
          },
          {
            "node": "Facebook Ads Data",
            "type": "main",
            "index": 0
          },
          {
            "node": "Facebook Page Engagement",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "meta_campaign": {
      "main": [
        [
          {
            "node": "Code in JavaScript",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript": {
      "main": [
        [
          {
            "node": "Append or update row in sheet",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Append or update row in sheet": {
      "main": [
        [
          {
            "node": "Merge5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge5": {
      "main": [
        []
      ]
    },
    "Create sheet": {
      "main": [
        []
      ]
    },
    "Google Gemini Chat Model5": {
      "ai_languageModel": [
        [
          {
            "node": "Meta_Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "GA_Agent": {
      "main": [
        [
          {
            "node": "Create file from text",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "GoogleAds_Agent": {
      "main": [
        [
          {
            "node": "Create file from text1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Meta_Agent": {
      "main": [
        [
          {
            "node": "Create file from text2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Append or update row in sheet2": {
      "main": [
        [
          {
            "node": "GoogleAds_Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Facebook": {
      "main": [
        [
          {
            "node": "Campaign",
            "type": "main",
            "index": 0
          },
          {
            "node": "Get Ad Sets",
            "type": "main",
            "index": 0
          },
          {
            "node": "Get Ads",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Set Campaign Config": {
      "main": [
        [
          {
            "node": "Facebook",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Campaign": {
      "main": [
        [
          {
            "node": "Format Campaign data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Format Campaign data": {
      "main": [
        [
          {
            "node": "Update Campaign Data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Format Ad Set Data": {
      "main": [
        [
          {
            "node": "Update AdSet Data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update AdSet Data": {
      "main": [
        [
          {
            "node": "Split Ad Sets",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Ad Sets": {
      "main": [
        [
          {
            "node": "Split Ad Sets",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Ads": {
      "main": [
        [
          {
            "node": "Split Ads",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Ad Set Insights": {
      "main": [
        [
          {
            "node": "Format Ad Set Data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Split Ad Sets": {
      "main": [
        [
          {
            "node": "Merge6",
            "type": "main",
            "index": 1
          }
        ],
        [
          {
            "node": "Get Ad Set Insights",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Ad Insights": {
      "main": [
        [
          {
            "node": "Code in JavaScript2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update Ad Data": {
      "main": [
        [
          {
            "node": "Split Ads",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Split Ads": {
      "main": [
        [
          {
            "node": "Merge6",
            "type": "main",
            "index": 2
          }
        ],
        [
          {
            "node": "Get Ad Insights",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update Campaign Data": {
      "main": [
        [
          {
            "node": "Merge6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript1": {
      "main": [
        [
          {
            "node": "Meta_Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Schedule Trigger4": {
      "main": [
        []
      ]
    },
    "Code in JavaScript2": {
      "main": [
        [
          {
            "node": "Update Ad Data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge6": {
      "main": [
        [
          {
            "node": "Code in JavaScript1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Append or update row in sheet1": {
      "main": [
        [
          {
            "node": "GA_Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Append or update row in sheet3": {
      "main": [
        [
          {
            "node": "Merge3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent": {
      "main": [
        [
          {
            "node": "Create file from text3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "When chat message received": {
      "main": [
        [
          {
            "node": "Weekly Report Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "MetaAdsData": {
      "ai_tool": [
        [
          {
            "node": "Weekly Report Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "GoogleAdsData": {
      "ai_tool": [
        [
          {
            "node": "Weekly Report Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "GoogleAnalyticData": {
      "ai_tool": [
        [
          {
            "node": "Weekly Report Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "SearchGoogleDrive": {
      "ai_tool": [
        [
          {
            "node": "Weekly Report Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Webhook Trigger": {
      "main": [
        [
          {
            "node": "Extract Query",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Extract Query": {
      "main": [
        [
          {
            "node": "AI Agent1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Tool: Search Drive Reports": {
      "ai_tool": [
        [
          {
            "node": "AI Agent1",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Tool: Query Sheets Data": {
      "ai_tool": [
        [
          {
            "node": "AI Agent1",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Conversation Memory": {
      "ai_memory": [
        [
          {
            "node": "AI Agent1",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent1": {
      "main": [
        [
          {
            "node": "Respond to Webhook",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Execute Workflow Trigger": {
      "main": [
        [
          {
            "node": "Read Google Sheets",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Read Google Sheets": {
      "main": [
        [
          {
            "node": "Process Query",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Process Query": {
      "main": [
        [
          {
            "node": "Return to AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Search Google Drive": {
      "main": [
        [
          {
            "node": "Download Report Files",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Download Report Files": {
      "main": [
        [
          {
            "node": "Format Results",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Format Results": {
      "main": [
        [
          {
            "node": "Return to AI Agent1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model6": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent1",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model7": {
      "ai_languageModel": [
        [
          {
            "node": "Weekly Report Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {},
  "versionId": "8ba5806d-2d51-492e-a357-73364e15088a",
  "meta": {
    "templateId": "2783",
    "instanceId": "deb32046025f576b53b1858e537ecf62a52c205ff0a3afb4cc0768bfc2e55c02"
  },
  "id": "95Qo58mNMdY21Xk6",
  "tags": []
}